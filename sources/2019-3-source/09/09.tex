%
{\footnotesize \noindent$\issueyear$\mbox{~~~~~~~~~~}
ВЕСТНИК\,САНКТ-ПЕТЕРБУРГСКОГО\,УНИВЕРСИТЕТА
Т.\,15.\,\,Вып.\,$\issuenum$\linebreak %
\mbox{~~~~~~~~~~}ПРИКЛАДНАЯ МАТЕМАТИКА. ИНФОРМАТИКА. ПРОЦЕССЫ
УПРАВЛЕНИЯ %
}

%\ \\ \vskip 0.8mm\hrule \\ \hrule \\ \ \\

\vskip 0.5mm

\hline\vskip .5mm

\hline

\vspace{1.8cm} \noindent {\large ПРОЦЕССЫ
УПРАВЛЕНИЯ} \vspace{1.6cm}%1.8cm}

\noindent{\small УДК 517.977.1\\ %  \hfill {\footnotesize Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~14.~Вып.~\issuenum}\\ %
MSC 93C85

}

\vskip3mm

\noindent{\bf Синтез цифрового управления с~прогнозом для удержания \\
контролируемых переменных в~заданном диапазоне$^{*}$%
 }

\vskip3mm

\noindent{\it М.~В.~Сотникова%$\,^1$%
%, И.~О. Фамилия%$\,^2$%

 }

\efootnote{
%%
\vspace{-3mm}\parindent=7mm
%%
\vskip 0.1mm $^{*}$ Работа выполнена при финансовой поддержке
Российского фонда фундаментальных исследований (проект
№~17-07-00361a).\par
%%
%%\vskip 2.0mm
%%
\indent{\copyright} Санкт-Петербургский государственный
университет, \issueyear%
%%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
\fancyfoot[LO]{{\footnotesize\rm{\doivyp/spbu10.\issueyear.\issuenum09 } }\hfill\thepage}%
\fancyfoot[RE]{\thepage\hfill{\footnotesize\rm{\doivyp/spbu10.\issueyear.\issuenum09}}}%
% для оформления нижнего колонтитула
\cfoot{} %

\vskip2.0mm

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{\footnotesize

\noindent%
%$^1$~%
Санкт-Петербургский государственный университет,
Российская Федерация,

\noindent%
%\hskip2.45mm%
199034, Санкт-Петербург, Университетская~наб., 7--9

%\noindent%
%$^2$~%
%Санкт-Петербургский государственный университет,
%Российская Федерация,


%\noindent%
%\hskip2.45mm%
%1199034, Санкт-Петербург,
%Университетская~наб., 7--9

}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\vskip3mm

{\small \noindent \textbf{Для цитирования:}
\textit{Сотникова~М.~В.} Синтез цифрового управления с~прогнозом
для удержания контролируемых переменных в~заданном диапазоне~//
Вестник Санкт-Пе\-тер\-бург\-ского университета. Прикладная
математика. Информатика. Процессы управления. \issueyear. Т.~15.
Вып.~\issuenum. С.~\pageref{p9}--\pageref{p9e}. \doivyp/\enskip%
\!\!\!spbu10.\issueyear.\issuenum09

\vskip3mm

{\leftskip=7mm\noindentРассматривается проблема синтеза цифрового
управления контролируемыми переменными динамического объекта
с~удержанием их в~заданном диапазоне с~учетом ограничений
на~управляющие переменные. При этом изменение переменных внутри
диапазона может быть произвольным. Такая постановка задачи
обуслoвливает необходимость разработки специальных методов синтеза
законов управления, отличных от классических подходов, в~которых
цель управления задается командным сигналом. Предлагается подход
к~синтезу цифрового закона управления, в~основу которого положено
использование прогнозирующих моделей. В~рамках этого подхода цель
управления достигается посредством введения специального
квадратичного функционала качества, включающего штрафное слагаемое
за выход контролируемых переменных из~требуемого диапазона.
Минимизация такого функционала на~горизонте прогноза с~учетом
имеющихся ограничений на~управляющие переменные обеспечивает
введение контролируемых переменных внутрь диапазона. Показано, что
реализация закона управления в~режиме реального времени сводится
к~решению задачи квадратичного программирования на~каждом такте
дискретного времени. Эффективность разработанного алгоритма
управления иллюстрируется примерами моделирования процессов
переработки нефти в~ректификационной колонне.\\[1mm]
\textit{Ключевые слова}: цифровое управление, прогнозирующая
модель, оптимизация, управление переменными в~диапазоне,
ректификационная колонна.

}

}

\vskip 4mm

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\textbf{Введение.} В~настоящее время значительное внимание
уделяется разработке и~внедрению цифровых систем автоматического
управления технологическими процессами с~целью повышения
эффективности, качества и~надежности функционирования промышленных
установок~[1]. При этом возможности для развития
и~совершенствования таких систем управления определяются постоянно
возрастающими вычислительными мощностями цифровых устройств,
на~базе которых осуществляется реализация алгоритмов управления
в~режиме реального времени.

Множество прикладных задач управления технологическими процессами
состоит в~том, чтобы обеспечить нахождение некоторых
контролируемых переменных управляемых процессов внутри заданных
диапазонов, допуская возможность произвольного изменения этих
переменных внутри диапазонов. Такая постановка задачи управления
обусловливает необходимость разработки специальных методов
синтеза, отличных от классических подходов, в~которых цель
управления задается командным сигналом. В~частности, такие задачи
актуальны в~области нефтепереработки~[2].

В данной статье исследуется проблема синтеза цифровой системы
управления контролируемыми переменными динамического объекта
с~удержанием их в~заданном диапазоне с~учетом ограничений
на~управляющие переменные, высокой размерности входов и~выходов,
а~также наличия внешних возмущений. В~качестве исходной
математической модели принята система линейных уравнений
с~запаздыванием.

К~возможным подходам к~построению законов управления
в~рассматриваемой задаче относится многоцелевой синтез~[3,~4],
обеспечивающий требуемое качество процессов управления в~различных
режимах, в~том числе в~условиях действия внешних возмущений.
Однако данный подход не позволяет учесть в~явном виде ограничения
на контролируемые переменные и~неудобен для выполнения адаптивной
перенастройки алгоритма управления при изменении границ заданного
диапазона в~процессе функционирования.

В связи с~этим в~качестве основы для синтеза цифровых законов
управления принят подход, базирующийся на~использовании
прогнозирующих моделей (Model Predictive Control, MPC)~[5]. Этот
подход является оптимизационным и~обладает рядом важных свойств.
В~частности, он применим для задач с~высокой размерностью входов
и~выходов, с~ограничениями на~переменные и~при наличии
запаздывания, что определяет его широкое использование
в~прикладных задачах~[6].

Ключевая особенность предлагаемого в~работе подхода к~синтезу
управления состоит во~введении специализированного функционала
качества, отражающего специфику рассматриваемой задачи,~---
функционала ошибки. Данный функционал играет роль штрафа за~выход
контролируемых переменных за~пределы заданного диапазона.
Выполнена формализованная постановка задачи оптимизации
прогнозируемого движения объекта управления на~горизонте прогноза
и показано, что она сводится к~задаче квадратичного
программирования.

Полученные результаты иллюстрируются примерами имитационного
моделирования процессов переработки нефти в~ректификационной
колонне.


\textbf{Математические модели контролируемых процессов.} Будем
считать, что исходная математическая модель объекта управления
представляется системой линейных уравнений с~запаздыванием,
заданных в~форме передаточных функций:
\begin{equation}
y_i = \sum_{j=1}^{n} \frac{k_{ij}}{T_{ij}s+1}e^{-\tau_{ij}s}u_j +
\sum_{r=1}^{l} \frac{\tilde{k}_{ir}}{\tilde{T}_{ir}s+1}f_r, \ ~
i=\overline{1,m},
\end{equation}
где $s$~--- переменная Лапласа; $y_i, i=\overline{1,m},$~---
контролируемые переменные;  $u_j, j=\overline{1,n},$~---
управления; $f_r, r = \overline{1,l},$~--- возмущения;
$k_{ij}$~--- коэффициенты усиления; $T_{ij}$~--- постоянные
времени; ${\tau_{ij}}$~--- транспортное запаздывание.  Измеряемыми
переменными являются контролируемые выходы $y_i,
i=\overline{1,m}$, и~возмущения $f_r, r = \overline{1,l}$.
Начальные условия для модели (1) нулевые: $y_i(0) = 0,
i=\overline{1,m}$.

Введение уравнений (1) в качестве исходной математической модели
обус\-лов\-ли\-вает\-ся тем, что апериодические звенья первого
порядка, умноженные на соответст\-вую\-щие экспоненты, которые
представляют запаздывания, используются инженерами при
эмпирическом подборе закономерностей, представляющих динамику
про\-цессов.

Каждое отдельное слагаемое первой суммы в~уравнении (1) может быть
представлено в~пространстве состояний следующим образом:
\begin{equation}
%\begin{aligned}
\dot {x} = -\frac{1}{T_{ij}}x+\frac{k_{ij}}{T_{ij}}
u_j(t-\tau_{ij}), \ ~ y_{ij} = x.
%\end{aligned}
\end{equation}
Аналогичные уравнения справедливы  для слагаемых второй суммы.

Выполним дискретизацию модели (1) без учета запаздывания. Отметим,
что данный упрощенный вариант может применяться при синтезе
законов управления в~тех случаях, когда запаздывания в~модели
существенно меньше, чем постоянные времени переходных процессов.
Дополнительным обоснованием использования упрощенного подхода
служит то, что учет запаздывания при дискретизации уравнений~(1)
требует введения дополнительных компонент вектора состояния,
а~следовательно, повышает размерность системы и приводит к большим
вычислительным затратам при формировании управляющего сигнала.
В~связи с этим в дальнейшем запаздывание не учитывается при
дискретизации уравнений~(1), однако используется для оценки
качества функционирования при моделировании процессов в~замкнутой
системе.

С~целью дискретизации перейдем от представления (1) математической
модели в~виде передаточных функций к~форме пространства состояний.
Для начала, преобразуя каждое из~ненулевых слагаемых первой суммы
уравнений (1) к~виду (2), получим систему дифференциальных
уравнений

\begin{equation}
\begin{aligned}
&\dot {\bf x}_s = {\bf{A}}_s{\bf{x}}_s+{\bf{B}}_s{\bf{u}}, \\
&{\bf y} = {\bf{C}}_s{\bf{x}}_s.
\end{aligned}
\end{equation}
Здесь ${\bf x}_s \in E^{n_e}$, ${\bf u} = \left( u_1, ...,
u_n\right)^T \in E^n$, ${\bf y} = \left(y_1,...,y_m \right)^T \in
E^m$~--- векторы состояния, управления и~контролируемых переменных
соответственно, $n_e$~--- количество ненулевых слагаемых первой
суммы в~уравнениях (1). Постоянные матрицы
${\mathbf{A}}_s,{\mathbf{B}}_s,{\mathbf{C}}_s$ имеют
соответствующие размерности. При этом матрица ${\mathbf{A}}_s$
является диагональной с~элементами вида $-1/T_{ij}$ по~главной
диагонали, а~в~матрице ${\mathbf{B}}_s$, согласно уравнению~(2),
в~$j$-м столбце и~в~соответствующей строке находится ненулевой
коэф\-фи\-циент~$k_{ij}/T_{ij}$. Матрица ${\mathbf{C}}_s$ содержит
$m$ строк, причем все ее элементы нулевые, кроме тех, которые
отвечают позициям ненулевых слагаемых в уравнениях (1). Для этих
позиций значения равны 1.

При отсутствии возмущений и~запаздывания модель (3) эквивалентна
модели (1). При наличии возмущений необходимо дополнить модель
(3), включив в~нее уравнения вида (2) для каждого ненулевого
слагаемого второй суммы в~уравнениях (1). Будем считать, что
возмущения являются постоянными, т. е. справедливы равенства
\begin{equation}
\dot{f}_r = 0, \,\, r=\overline{1,l}.
\end{equation}
Объединяя системы уравнений (3) и~(4), получаем расширенную
математическую модель в~пространстве состояний, включающую
возмущения:
\begin{equation}
\begin{aligned}
&\dot {\bf x} = {\bf{A}}_c{\bf{x}}+{\bf{B}}_c{\bf{u}}, \\
&{\bf y} = {\bf{C}}_c{\bf{x}}.
\end{aligned}
\end{equation}
Здесь ${\bf x}=\left( {\bf x}_s,\, {\bf x}_e,\, {\bf f} \right)^T
\in E^{n_e+n_{ed}+l}$~--- вектор состояния, причем ${\bf x}_e \in
E^{n_{ed}}$~--- часть вектора состояния, представляющая
передаточные функции возмущений, $n_{ed}$~--- число ненулевых
слагаемых второй суммы в~уравнениях (1), ${\bf f} = \left( f_1,
..., f_l\right)^T \in E^l$~--- вектор внешних возмущений,
постоянные матрицы ${\mathbf{A}}_c,{\mathbf{B}}_c,{\mathbf{C}}_c$
имеют соответствующие размерности и~равны
\begin{equation}
{\bf A}_c = \left (
\begin{array}{ccc}
{\bf A}_s & {\bf 0} & {\bf 0} \\
{\bf 0} & {\bf A}_{xe} & {\bf B}_{xe} \\
{\bf 0} & {\bf 0} & {\bf 0}
\end{array}
\right ), \,\, {\bf B}_c = \left (
\begin{array}{c}
{\bf B}_s  \\
{\bf 0}  \\
{\bf 0}
\end{array}
\right ), \,\, {\bf C}_c = \left (
\begin{array}{ccc}
{\bf C}_s  & {\bf C}_{xe} & {\bf 0}
\end{array}
\right ),
\end{equation}
где ${\bf A}_{xe}, {\bf B}_{xe}$~--- матрицы коэффициентов,
определяющие динамику по~внешним возмущениям, а~матрица ${\bf
C}_{xe}$ задает влияние возмущений на~выход системы в~соответствии
с моделью (1). Выполним дискретизацию уравнений (5) с~шагом
дискретности $T_s$. Тог\-да, применяя формулу Коши, получим
следующую модель в~дискретном времени:
\begin{equation}
\begin{aligned}
&{\bf x}[k+1] = {\bf{A}}{\bf{x}}[k]+{\bf{B}}{\bf{u}}[k], \\
&{\bf y}[k] = {\bf{C}}{\bf{x}}[k],
\end{aligned}
\end{equation}
в которой ${\bf A}=e^{{\bf A}_c T_s}$, ${\bf B} = \left( \int
\limits_{0}^{T_s}  e^{{\bf A}_c(T_s-\tau)} d\tau  \right){\bf
B}_c$, ${\bf C} = {\bf C}_c$~--- постоянные матрицы. В~итоге
дискретная модель (7) приближенно представляет исходную модель
(1), заданную в~непрерывном времени. При этом, чем меньше величина
запаздывания по отношению к~постоянной времени процессов, тем
точнее это представление. Если запаздывание равно нулю, то модели
(1) и~(7) эквивалентны.

\textbf{Постановка задачи удержания контролируемых переменных
в~заданном диапазоне.} Пусть в~начальный момент времени значения
управляющих и~контролируемых переменных объекта равны ${\bf u}_s$
и ${\bf y}_s$  соответственно. В~дальнейшем будем считать, что
математическая модель (1) приближенно описывает динамику объекта
в~отклонениях (в приращениях) от начального положения ${\bf y}_s$,
${\bf u}_s$. Таким образом, фактически указанные переменные
в~текущий момент времени $t$ равны
\begin{equation}
\tilde{\bf {y}}(t) = {\bf y}_s + {\bf y}(t), \ ~ \tilde{\bf
{u}}(t) = {\bf u}_s + {\bf u}(t).
\end{equation}
Будем называть векторы $\tilde{\bf y} =
\left(\tilde{y}_1,...,\tilde{y}_m \right)^T$  и~$\tilde{\bf u} =
\left(\tilde{u}_1,...,\tilde{u}_m \right)^T$  абсолютными
значениями контролируемых и~управляющих переменных соответственно,
а векторы ${\bf y}(t)$ и~${\bf u}(t)$~--- значениями в~приращениях
относительно начального положения ${\bf y}_s$, ${\bf u}_s$.

Введем ограничения на~контролируемые переменные
\begin{equation}
\tilde{\bf y}_{\rm min} \le \tilde{\bf y}(t) \le \tilde{\bf
y}_{\rm max},
\end{equation}
где $\tilde{\bf y}_{\rm min}, \tilde{\bf y}_{\rm max}$~---
заданные векторы. Отметим, что исходно ограничения (9) вводятся
для абсолютных значений контролируемых переменных, и в~процессе
функционирования системы управления эти ограничения могут
нарушаться.

Цель управления объектом (1) состоит в~выполнении ограничений (9),
т. е. необходимо обеспечить нахождение контролируемых переменных
процесса внутри заданного диапазона (9), в котором управляющие
воздействия должны автоматически прекращаться. Таким образом,
поставим задачу синтеза цифровой системы управления с~обратной
связью, обеспечивающей достижение цели управления (9) для объекта,
заданного математической моделью (1).

\textbf{Синтез алгоритма управления на~основе прогнозирующей
модели.} В~качестве основы для синтеза законов управления примем
дискретную модель (7). Важная особенность этой модели состоит
в~том, что количество ее измеряемых переменных не превышает числа
компонент вектора состояния, т. е. ${\rm dim}({\bf y}) \le {\rm
dim}({\bf x})$. При этом для реализации законов управления
необходимо иметь оценку всего вектора состояния ${\bf x}$. Такую
оценку можно получить при помощи асимптотического наблюдателя. Для
построения наблюдателя представим модель (7) с~учетом формул (6)
следующим образом:
\begin{equation}
\begin{aligned}
&{\bf x}_s[k+1] = {\bf{A}}_{sd}{\bf{x}}_s[k]+{\bf{B}}_{sd}{\bf{u}}[k], \\
&{\bf x}_e[k+1] = {\bf{A}}_{ed}{\bf{x}}_e[k]+{\bf{B}}_{ed}{\bf{f}}[k], \\
&{\bf y}[k] =
{\bf{C}}_{sd}{\bf{x}}_s[k]+{\bf{C}}_{ed}{\bf{x}}_e[k],
\end{aligned}
\end{equation}
т. е. вынесем возмущения из~состава компонент вектора состояния.
Матрицы ${\bf{A}}_{sd}$, ${\bf{B}}_{sd}$, ${\bf{C}}_{sd}$,
${\bf{A}}_{ed}$, ${\bf{B}}_{ed}$, ${\bf{C}}_{ed}$ модели (10)
получим извлечением соответствующих строк и~столбцов из~исходных
матриц ${\bf{A}}$, ${\bf{B}}$ и~${\bf{C}}$ модели (7). Сформируем
асимптотический наблюдатель для оценивания вектора состояния ${\bf
x}_s$ в~модели (10):
\begin{equation}
%\begin{aligned}
\begin{array}
\, {\bf{z}} [k+1] =
{\bf{A}}_{sd}{\bf{z}}[k]+{\bf{B}}_{sd}{\bf{u}}[k]+{\bf
G}\left({\bf y}[k]-{\bf C}_{sd}{\bf z}[k]-{\bf C}_{ed}{\bf
x}_e[k]\right),
\\[0.2cm]
{\bf x}_e[k+1] =
{\bf{A}}_{ed}{\bf{x}}_e[k]+{\bf{B}}_{ed}{\bf{f}}[k],
%\end{aligned}
\end{array}
\end{equation}
где ${\bf z} \in E^{n_e}$~--- вектор состояния асимптотического
наблюдателя. Настраиваемым элементом системы (11), подлежащим
поиску, является матрица ${\bf G}$ при невязках.  Ее необходимо
выбрать так, чтобы выполнялось равенство $\lim \limits_{k \to
+\infty} ({\bf z}[k]-{\bf x}_s[k]) = {\bf 0}$, т. е. оценки
наблюдателя должны сходиться к~истинному значению вектора
состояния ${\bf x}_s$.

Запишем уравнение для ошибки оценивания ${\bf e} = {\bf x}_s -{\bf
z}$. С учетом уравнений (10) и~(11) получаем, что
\begin{equation}
{\bf e}[k+1] = \left( {\bf A}_{sd}-{\bf G}{\bf C}_{sd} \right){\bf
e}[k].
\end{equation}
Отсюда следует, что для сходимости ошибки оценивания ${\bf e}$
к~нулевому вектору необходимо и~достаточно, чтобы собственные
числа матрицы ${\bf A}_{sd}-{\bf G}{\bf C}_{sd}$ находились внутри
единичного круга. Если пара $({\bf A}_{sd}, {\bf C}_{sd})$ ---
наблюдаемая, то это всегда можно сделать с~использованием,
например, модального синтеза [1]. При этом матрица ${\bf G}$
вы\-би\-рает\-ся так, чтобы совпадали характеристический полином
системы (12) и~некоторый же\-лае\-мый характеристический полином,
отвечающий заданному распределению корней внутри единичного круга.

Отметим, что скорость сходимости оценок тем выше, чем ближе
к~центру единичного круга расположены корни характеристического
полинома наблюдателя, но при этом существенно возрастает влияние
шума на~точность получаемых оценок. Поэтому при назначении
желаемых корней характеристического полинома обычно принимаются
некоторые компромиссные значения.

Перейдем к~задаче синтеза системы управления. В~основу
предлагаемого подхода к~синтезу положена теория управления MPC
[5,~6]. Такой подход позволяет явно ввести ограничения
на~контролируемые переменные в~процессе поиска оптимальной
стратегии управления на~горизонте прогноза. Кроме того, учитывая
особенность цели управления~--- попадание в~диапазон (9),
функционал качества в~данной задаче удобно задать в~виде штрафа
за~выход из~диапазона и формировать управление таким образом,
чтобы минимизировать этот функционал. Отмеченные обстоятельства
обосновывают применение метода MPC, реализующего управление
по~принципу обратной связи и~оптимизирующего движение замкнутой
системы на~каждом такте дискретного времени с~учетом текущих
условий функционирования.

Используя в~качестве исходной модели разностные уравнения (7),
введем линейную прогнозирующую модель, представляя еe следующей
системой уравнений:
\begin{equation}
\begin{aligned}
&\bar{{\bf x}}[i+1] = {\bf{A}}\bar{{\bf{x}}}[i]+{\bf{B}}\bar{{\bf{u}}}[i],\,\, i=k+j,\,\, j  = 0,1,2,...,\,\, \bar{{\bf x}}[k] = \tilde{{\bf x}}[k], \\
&\bar{{\bf y}}[i] = {\bf{C}}\bar{{\bf{x}}}[i].
\end{aligned}
\end{equation}
Размерности векторов состояния $\bar{{\bf{x}}}$, управления
$\bar{{\bf{u}}}$ и~измерения $\bar{{\bf{y}}}$ здесь такие же, как
и в~системе (7). Матрицы ${\bf A}$, ${\bf B}$ и~${\bf C}$ систем
(7) и~(13) совпадают. Заметим, что прогнозирующая модель (13)
на~начальном такте $j=0$ инициируется оценкой $\tilde {\bf x}[k]$
текущего состояния реального объекта, полученной с~помощью
асимптотического наблюдателя (11), и~позволяет приближенно
спрогнозировать его динамику.

Зададим программное управление $\hat{\bf u} = \left( \bar{\bf
u}[k], \bar{\bf u}[k+1],...,\bar{\bf u}[k+P-1]   \right)^T \in
E^{nP}$ на~горизонте прогноза $P$ и~вычислим соответствующее ему
программное движение $\hat{\bf y} = \hat{\bf y}(\hat{\bf u}) =
\left( \bar{\bf y}[k+1], \bar{\bf y}[k+2],...,\bar{\bf y}[k+P]
\right)^T \in E^{mP}$. В~силу уравнений прогнозирующей модели (13)
имеем уравнение
\begin{equation}
\hat{{\bf y}} = {\bf L}\bar{\bf x}[k]+{\bf M}\hat{\bf u},
\end{equation}
в котором
$$
{\bf L} = \left (
\begin{array}{c}
{\bf CA}^{\,\,}  \\
{\bf CA}^2  \\
\vdots \\
{\bf CA}^P
\end{array}
\right ), \ ~ {\bf M} = \left (
\begin{array}{cccc}
{\bf CB}  & {\bf 0} & \cdots & {\bf 0}  \\
{\bf CAB}  & {\bf CB} & \cdots & {\bf 0}  \\
\cdots  & \cdots & \ddots & \cdots  \\
{\bf CA}^{P-1}{\bf B}  & {\bf CA}^{P-2}{\bf B} & \cdots & {\bf CB}
\end{array}
\right ).
$$
В дальнейшем для задания программного управления на~горизонте
прогноза $P$ будем использовать вектор $\Delta\hat{\bf u} = \left(
\Delta\bar{\bf u}[k], \Delta\bar{\bf u}[k+1],...,\Delta\bar{\bf
u}[k+P-1]   \right)^T \in E^{nP}$ приращений (изменений)
управляющих воздействий, где $\Delta\bar{\bf u}[i] = \bar{\bf
u}[i]-\bar{\bf u}[i-1]$, $i=\overline{k,k+P-1}$.

Между векторами $\hat{\bf u}$ и~$\Delta\hat{\bf u}$ существует
взаимно однозначное соответствие. Действительно, для управления
на~$k$-м шаге справедливо равенство $\bar{\bf u}[k] = {\bf
u}[k-1]+\Delta\bar{\bf u}[k]$. Аналогично получаем, что
$$
\bar{\bf u}[k+1] = {\bf u}[k-1]+\Delta\bar{\bf
u}[k]+\Delta\bar{\bf u}[k+1],..., \bar{\bf u}[k+P-1] ={\bf
u}[k-1]+\sum \limits_{i=0}^{P-1} \Delta \bar{\bf u}[k+i],
$$
или в~матричной форме:
\begin{equation}
\hat{\bf u} = {\bf M}_0 {\bf u}[k-1]+{\bf M}_1 \Delta \hat{\bf u},
\end{equation}
здесь
$$
{\bf M}_0 = \left (
\begin{array}{c}
{\bf E}_{n\times n}  \\
{\bf E}_{n\times n}  \\
\vdots \\
{\bf E}_{n\times n}
\end{array}
\right ), \ ~ {\bf M}_1 = \left (
\begin{array}{cccc}
{\bf E}_{n\times n}  & {\bf 0} & \cdots & {\bf 0}  \\
{\bf E}_{n\times n} & {\bf E}_{n\times n} & \cdots & {\bf 0}  \\
\cdots  & \cdots & \ddots & {\bf 0} \\
{\bf E}_{n\times n}  & {\bf E}_{n\times n} & \cdots & {\bf
E}_{n\times n}
\end{array}
\right ).
$$
В результате, подставляя (15) в~формулу (14), находим, что
\begin{equation}
\hat{\bf y} = \hat{\bf y}(\Delta\hat{\bf u})={\bf L}\bar{\bf
x}[k]+\tilde{{\bf M}}_0 {\bf u}[k-1]+\tilde{{\bf M}}_1 \Delta
\hat{\bf u},
\end{equation}
где $\tilde{\bf M}_0 = {\bf M}{\bf M}_0$, $\tilde{\bf M}_1 = {\bf
M}{\bf M}_1$~--- вспомогательные матрицы. Таким образом, формула
(16) позволяет вычислить прогноз $\hat{\bf y} = \hat{\bf
y}(\Delta\hat{\bf u})$ динамики движения объекта на~горизонте $P$
для заданного программного управления $\Delta\hat{\bf u}$. Обратим
внимание, что прогноз осуществляется на~основе информации
о~текущем состоянии $\bar{\bf x}[k]$ объекта и~управлении
на~предыдущем шаге ${\bf u}[k-1]$.

Рассмотрим вопрос о~построении допустимого множества управлений
на~горизонте прогноза. Поскольку формирование управляющего сигнала
осуществляется в~дискретные моменты времени с~шагом дискретизации
$T_s$, то и~проверка ограничений (9) осуществляется только в~эти
же моменты времени. В~связи с~этим перепишем неравенства (9),
преобразуя их к~дискретному виду:
$$
\tilde{\bf y}_{\rm min} \le \tilde{\bf y}[k] \le \tilde{\bf
y}_{\rm max}.
$$
Тогда, с~учетом (8), справедливы аналогичные неравенства для
относительных значений контролируемых переменных
\begin{equation}
{\bf y}_{\rm min} \le {\bf y}[k] \le {\bf y}_{\rm max}.
\end{equation}
B (17) ${\bf y}_{\rm max} = \tilde{\bf y}_{\rm max} - {\bf y}_s$,
${\bf y}_{\rm min} = \tilde{\bf y}_{\rm min} - {\bf y}_s$~---
вспомогательные векторы, а~${\bf y}_s$~--- начальное положение
по~контролируемым переменным.

Рассмотрим ограничения на~контролируемые переменные на~горизонте
прогноза:
\begin{equation}
{y}_j^{\rm min} \le \bar{y}_j[i] \le {y}_j^{\rm max},\ ~ i =
\overline{k+1,k+P},\ ~ j = \overline{1,m},
\end{equation}
где ${\bf y}^{\rm min} = \left(y_1^{\rm min}, y_2^{\rm min}, ...,
y_m^{\rm min} \right)^T$, ${\bf y}^{\rm max} = \left(y_1^{\rm
max}, y_2^{\rm max}, ..., y_m^{\rm max} \right)^T$~--- заданные
векторы с~постоянными компонентами, определяемые ограничениями
(9); $\bar{y}_j$~--- $j$-я компонента вектора $\bar{\bf y}$.
Введeм следующие вспомогательные векторы:
$$
\hat{\bf y}_{\rm min} = \left( {\bf y}^{\rm min},..., {\bf y}^{\rm
min} \right)^T \in E^{mP},\ ~ \hat{\bf y}_{\rm max} = \left( {\bf
y}^{\rm max},..., {\bf y}^{\rm max} \right)^T \in E^{mP},
$$
представляющие верхние и~нижние границы на~горизонте прогноза для
контроли\-руе\-мых переменных.

Важно отметить, что ограничения (18) на~контролируемые переменные
могут нарушаться. Это связано с~тем, что в~определенные моменты
времени объект управления уже может находиться в~таком состоянии,
что избежать выхода части контролируемых переменных
за~установленные пределы (9) не удастся. В~связи с~этим
преобразуем ограничения (18) посредством добавления «слабой»
скалярной переменной $\varepsilon$, которая допускает возможность
нарушения ограничений в~определенные моменты времени:
\begin{equation}
%\begin{aligned}
{y}_j^{\rm min}-\varepsilon \le \bar{y}_j[i] \le {y}_j^{\rm
max}+\varepsilon,\ ~ i = \overline{k+1,k+P},\,\,j =
\overline{1,m}, \ ~
 \varepsilon \ge 0.
%\end{aligned}
\end{equation}
Покажем, что ограничения на~контролируемые переменные (19)
нетрудно преобразовать к~системе линейных неравенств относительно
компонент вектора $\Delta\hat{\bf u}$, представляющего управление
на горизонте прогноза. Для этого перепишем ограничения (19)
в~векторной форме с~учетом введенных ранее обозначений:
\begin{equation}
%\begin{aligned}
\hat{\bf y}^{\rm min}-{\bf V}\varepsilon \le \hat{\bf y} \le
\hat{\bf y}^{\rm max}+{\bf V}\varepsilon, \ ~
 \varepsilon \ge 0,
%\end{aligned}
\end{equation}
в которой ${\bf V} = \left( 1, 1, ..., 1  \right)^T \in
E^{mP}$~--- вспомогательный вектор, состоящий из~всех единиц. С
учетом (16) преобразуем ограничения (20), приводя их к~системе
линейных неравенств относительно вектора $\Delta\hat{\bf
u}$:\pagebreak

\begin{equation}
%\begin{aligned}
{\bf A}_y \left (
\begin{array}{c}
\Delta\hat{\bf u}  \\
\varepsilon
\end{array}
\right ) \le {\bf b}_y + {\bf b}_{y1}{\bf u}[k-1]+{\bf
b}_{y2}\bar{\bf x}[k], \ ~ \varepsilon \ge 0,
%\end{aligned}
\end{equation}
где
$$
{\bf A}_y = \left (
\begin{array}{cc}
\tilde{\bf M}_1 & -{\bf V} \\
-\tilde{\bf M}_1 & -{\bf V}
\end{array}
\right ), \,\, {\bf b}_y = \left (
\begin{array}{c}
\bar{\bf y}^{\rm max} \\
-\bar{\bf y}^{\rm min}
\end{array}
\right ), \,\, {\bf b}_{y1} = \left (
\begin{array}{c}
-\tilde{\bf M}_0 \\
\tilde{\bf M}_0
\end{array}
\right ), \,\, {\bf b}_{y2} = \left (
\begin{array}{c}
-{\bf L} \\
{\bf L}
\end{array}
\right ).
$$
Заметим, что правая часть в~неравенствах (21) является
нестационарной, так как зависит от текущего состояния объекта
$\bar{\bf x}[k]$ и~управления ${\bf u}[k-1]$ на~такте $k-1$.
Система линейных неравенств (21) задает допустимое множество
программных последовательностей векторов управления
$\Delta\hat{\bf u}$ на~горизонте прогноза. Введем формальное
определение этого множества:
\begin{equation}
\Omega = \left\{ \left( \Delta\hat{\bf u}, \varepsilon \right) \in
E^{nP+1} : {\bf A}\left (
\begin{array}{c}
\Delta\hat{\bf u}  \\
\varepsilon
\end{array}
\right ) \le {\bf b} \right\},
\end{equation}
здесь
$$
{\bf A} = \left (
\begin{array}{cc}
\tilde{\bf M}_1 & -{\bf V} \\
-\tilde{\bf M}_1 & -{\bf V} \\
{\bf 0} & -1
\end{array}
\right ), \,\,
 {\bf b} =
\left (
\begin{array}{c}
{\bf b}_y \\
0
\end{array}
\right ) + \left (
\begin{array}{c}
{\bf b}_{y1} \\
{\bf 0}
\end{array}
\right ) {\bf u}[k-1] + \left (
\begin{array}{c}
{\bf b}_{y2} \\
{\bf 0}
\end{array}
\right ) \bar{\bf x}[k].
$$

Зададим квадратичный функционал, определяющий качество процессов
управления на~горизонте прогноза $P$:
\begin{equation}
J_k = J_k\left(\hat{\bf y}, \Delta\hat{\bf u},\varepsilon  \right)
= \sum \limits_{j=1}^{P} \Delta\bar{\bf u}[k+j-1]^T{\bf
Q}\Delta\bar{\bf u}[k+j-1]+\rho \varepsilon^2.
\end{equation}
%
В (23) $\rho > 0$~--- весовой коэффициент штрафа за~нарушение
диапазона (9), ${\bf Q}$~--- диагональная положительно
определенная весовая матрица, у~которой по~диагонали расположены
значения приоритетов по~управляющим переменным. Отметим, что
внутри диапазона (9) данный функционал достигает минимального
нулевого значения при фиксированном управляющем воздействии.
Следовательно, вне диапазона (9) стремление минимизировать
функционал (23) приведет к~«втягиванию» контролируемых переменных
внутрь ограничений, а~внутри диапазона~--- к~автоматическому
выключению (фиксации) управления, поскольку при этом достигается
минимальное значение функционала. С учетом введенных ранее
обозначений запишем для функционала (23)  выражение $ J_k =
J_k\left(\Delta\hat{\bf u}, \varepsilon  \right) = \Delta\hat{\bf
u}^T\hat{\bf Q}\Delta\hat{\bf u}+\rho \varepsilon^2, $ где $
\hat{\bf Q} = {\rm diag} ({\bf Q}, ..., {\bf Q})$~--- весовая
матрица размера $nP\times nP$, или в~эквивалентном виде
$$
J_k = J_k\left(\Delta\hat{\bf u}, \varepsilon  \right) = \left(
\Delta\hat{\bf u} \,\, \varepsilon \right)^T\tilde{\bf H} \left(
\begin{array}{c}
\Delta\hat{\bf u} \\
\varepsilon
\end{array}
\right),
$$
в котором $\tilde{\bf H} = \left(
\begin{array}{cc}
\hat{\bf Q} & {\bf 0} \\
{\bf 0}  & \rho
\end{array}
\right)$~--- диагональная весовая матрица. В~результате поставим
следующую задачу оптимизации управления на~горизонте прогноза
с~учетом ограничений (9) на~контролируемые переменные:
\begin{equation}
J_k = J_k\left(\Delta\hat{\bf u},\varepsilon  \right) = \left(
\Delta\hat{\bf u} \,\, \varepsilon \right)^T\tilde{\bf H} \left(
\begin{array}{c}
\Delta\hat{\bf u} \\
\varepsilon
\end{array}
\right)  \rightarrow \min \limits_{\left( \Delta\hat{\bf u} \,\,
\varepsilon \right) \in \Omega \subseteq E^{nP+1}}.
\end{equation}
Здесь $\Omega$~--- допустимое множество (22). Заметим, что
размерность задачи оптимизации (24) равна $nP+1$.\pagebreak

Решение задачи (24) определяет оптимальную программную
последовательность векторов $\Delta\bar{\bf
u}^{*}[k],\Delta\bar{\bf u}^{*}[k+1],...,\Delta\bar{\bf
u}^{*}[k+P-1]$, а~также значение слабой переменной
$\varepsilon^{*}$.  В~соответствии со~стратегией MPC-подхода
из~этой последовательности используется только первая компонента
$\Delta\bar{\bf u}^{*}[k]$ на~текущем такте. Для следующего такта
$(k+1)$ процесс вычисления оптимальной программной
последовательности повторяется заново.

Задача оптимизации (24) является задачей выпуклого квадратичного
программирования.  Отметим, что для ее решения могут
использоваться известные численные методы, например методы
активного набора [7], а~также программные средства, в~частности,
реализованные в~среде MATLAB.

В итоге в~рамках рассмотренной задачи алгоритм реализации
управления с~прогнозом, включенным в~контур обратной связи,
заключается в~следующем:
%\begin{enumerate}

$1)$\,\,осуществляется измерение вектора ${\bf y}[k]$
и~восстанавливается текущее состояние $\tilde{\bf x}[k]$  объекта
с~помощью асимптотического наблюдателя (11);

$2)$\,\,решается оптимизационная задача (24) для прогнозирующей
модели (13) с~начальным условием $\bar{\bf x}[k] = \tilde{\bf
x}[k]$. Это задача выпуклого квадратичного программирования
на~допустимом множестве (22), которое определяется ограничениями
на~контролируемые переменные (9);

$3)$\,\,из~найденной в~результате решения задачи (24) оптимальной
последовательности $\Delta\bar{\bf u}^{*}[k],\Delta\bar{\bf
u}^{*}[k+1],...,\Delta\bar{\bf u}^{*}[k+P-1]$ используется только
первый вектор $\Delta\bar{\bf u}^{*}[k]$ на~текущем такте (с
момента времени $k$  до момента $k+1$); при этом на~объект
подается управляющий сигнал ${\bf u}[k] = {\bf
u}[k-1]+\Delta\bar{\bf u}^{*}[k]$;

$4)$\,\,для следующего такта, начиная с~момента времени $k+1$, все
операции, указанные выше, повторяются заново.
%\end{enumerate}

\textbf{Пример управления процессами нефтепереработки.} В~качестве
тестовой математической модели рассмотрим следующую систему
уравнений:\vskip -5mm
\begin{equation}
%\begin{aligned}
\begin{array}{l}
& y_1 = \frac{-0.03}{10s+1}e^{-2s}u_2,\ ~ y_2 = \frac{-0.03}{10s+1}e^{-6s}u_1,
\\[-0.3cm]
& y_3 = \frac{0.05}{5s+1}u_2,\ ~ y_4 = \frac{20}{5s+1}u_3, \\[-0.3cm]
& y_5 = \frac{-2}{35s+1}e^{-13s}u_3+\frac{-400}{8s+1}u_4, \\[-0.3cm]
& y_6 =
\frac{0.03}{20s+1}e^{-8s}u_1+\frac{0.15}{70s+1}e^{-10s}u_2+\frac{0.6}{25s+1}u_4.
%\end{aligned}
\end{array}
\end{equation}
В соответствии с~обозначениями, принятыми для модели (1), в~данном
случае имеем: $m=6, n=4$, т. е. число контролируемых переменных
превышает число управляющих переменных. Постоянные времени
и~транспортные запаздывания в~уравнениях (25) заданы в~минутах.
Начальные условия нулевые: $y_i(0) = 0, i = \overline{1,6}$.
Модель (25) приближенно описывает процессы переработки нефти
в~ректификационной колонне.

Исходные данные для абсолютных значений контролируемых переменных
представлены в~таблице.


\begin{table}[h!]
\begin{center}
{\small

{\it Таблица.} {\bf Исходные данные\\ для контролируемых переменных}%

}

\vskip 3mm

{\footnotesize

\begin{tabular}{ | c | c | c | c | }
\hline Переменная & ${\bf y}_s$ & $\tilde{\bf y}_{\rm min}$ &
$\tilde{\bf y}_{\rm max}$ \\ \hline
$\tilde{y}_1$ & 8.1 & 0 & 8 \\
$\tilde{y}_2$ & $-$1 & $-$2.5 & 4.1 \\
$\tilde{y}_3$ & 2 & $-$6 & 6 \\
$\tilde{y}_4$ & 1 & $-$3 & 3 \\
$\tilde{y}_5$ & $-$3 & 0 & 3 \\
$\tilde{y}_6$ & $-$1 & 0 & 10.15 \\
\hline
\end{tabular}

}
\end{center}\vspace{-3mm}
\end{table}

Абсолютные значения управляющих переменных в~начальный момент
времени задаются вектором
$$
{\bf u}_s = ( 0.4,\,-5,\,0.5,\,0.2 )^T.
$$
Отметим, что в~соответствии с~таблицей и~формулой (8), переменные
$\tilde{y}_1,\tilde{y}_5,\tilde{y}_6$ нарушают границы заданного
диапазона (9) при $t=0$.

Зададим шаг дискретизации $T_s = 1$~мин, горизонт прогноза $P =
50$. Таким образом, временной интервал прогнозирования составляет
50~мин. При этом в~рамках MPC-подхода на~каждом такте формирования
управления необходимо решать задачу квадратичного программирования
(24), размерность которой равна $nP+1=201$. Отметим, что
допустимое множество (22) в~рассматриваемом случае состоит
из~ограничений на~контролируемые переменные $y_i, i =
\overline{1,6}$, и~скалярную переменную $\varepsilon$.

Зададим значение коэффициента при штрафном слагаемом в~функционале
(23), равным $\rho = 100$, а~весовую матрицу примем равной ${\bf
Q}
= {\bf E}_{4\times 4}$. %
%
\begin{figure}[h!]
\centering{
\includegraphics[scale=1]{09/fig1}

\vskip 2mm
{\small{\it Рис. 1.} Переходные процессы по~выходу $\tilde{\bf y}$ } \\

\vskip 0mm {\footnotesize Пунктирной линией показаны границы
диапазона.} }
\end{figure}
%
%
На рис. 1 и~2 приведены результаты имитационного моделирования.
Видно, что все контролируемые переменные попадают внутрь диапазона
(9), причем переменная $\tilde{y}_4$ после завершения переходного
процесса находится практически на~границе диапазона. Такая
особенность определяется тем, что управляющие воздействия
автоматически прекращаются (в~силу выбора функционала (23)) при
попадании переменных внутрь диапазона.



\begin{figure}[h!]
\centering{
\includegraphics[scale=1]{09/fig2}

\vskip 2mm
{\small{\it Рис. 2.} Переходные процессы по~входу $\tilde{\bf u}$ } \\

\vskip 0mm {\footnotesize Пунктирной линией показаны границы
диапазона.} }
\end{figure}

%\begin{figure}[h]
%\begin{center}
%\includegraphics[scale=0.6]{Fig1.eps}
%\caption{\small Переходные процессы по~выходу $\tilde{\bf y}$. }
%\end{center}
%\end{figure}
%
%\begin{figure}[h]
%\begin{center}
%\includegraphics[scale=0.6]{Fig2.eps}
%\caption{\small Переходные процессы по~входу $\tilde{\bf u}$. }
%\end{center}
%\end{figure}

Заметим также, что переменная $\tilde{y}_4$ выходит за~границы
диапазона на~небольшом интервале времени переходного процесса. Это
связано с~выбором коэффициента $\rho$, который определяет
существенный штраф за~выход из~диапазона и~стремление быстро его
уменьшить, что приводит к~высокой интенсивности управления.
Аналогичные результаты имитационного моделирования при выборе
значения $\rho=1$ показали, что в~этом случае интенсивность
управления существенно снижается. При этом все контролируемые
переменные попадают в~заданный диапазон (9), но за~больший
промежуток времени (180 мин) и~переменная $\tilde{y}_4$  не
выходит за~границы диапазона. Таким образом, чем меньше величина
$\rho$, тем менее интенсивным является управление. Однако введение
штрафного слагаемого с~любым значением $\rho > 0$, вообще говоря,
не исключает возможности нарушения диапазона некоторыми
контролируемыми переменными в~определенные моменты времени
в~течение переходного процесса.

\textbf{Заключение.} Рассмотрена задача управления контролируемыми
переменными динамического процесса в~заданном диапазоне. Предложен
метод синтеза цифрового закона управления, основная идея которого
состоит в~использовании прогнозирующих моделей и~введении
специального квадратичного функционала, включающего штраф за~выход
контролируемых переменных из~заданного диапазона. Эффективность
подхода проиллюстрирована примером управления процессами
нефтепереработки в~ректификационной колонне.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\newpage
\input{09/lit-ra}

%\newpage
\input{09/ref-s}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{\footnotesize

%\thispagestyle{empty}

\vskip 3mm

\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
\fancyfoot[LO]{\footnotesize{\rm{Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~15.~Вып.~\issuenum}}
\hfill}%
\fancyfoot[RE]{\hfill\footnotesize{\rm{Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~15.~Вып.~\issuenum}}}%
% для оформления нижнего колонтитула
\cfoot{} %

}
