%
{\footnotesize \noindent$\issueyear$\mbox{~~~~~~~~~~}
ВЕСТНИК\,САНКТ-ПЕТЕРБУРГСКОГО\,УНИВЕРСИТЕТА
Т.\,15.\,\,Вып.\,$\issuenum$\linebreak %
\mbox{~~~~~~~~~~}ПРИКЛАДНАЯ МАТЕМАТИКА. ИНФОРМАТИКА. ПРОЦЕССЫ
УПРАВЛЕНИЯ %
}

%\ \\ \vskip 0.8mm\hrule \\ \hrule \\ \ \\

\vskip 0.5mm

\hline\vskip .5mm

\hline

\vspace{1.8cm} \noindent {\large ПРОЦЕССЫ
УПРАВЛЕНИЯ} \vspace{1.6cm}%1.8cm}

\noindent{\small УДК 519.6:517.977\\ %  \hfill {\footnotesize Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~14.~Вып.~\issuenum}\\ %
MSC 49J15; 65K10

}

\vskip3mm

\noindent{\bf О численном решении задачи  оптимального
управления\\  на~основе метода,
использующего вторую вариацию траектории%$^{*}$%
 }

\vskip3mm

\noindent{\it О. И. Дривотин%$\,^1$%
%, И.~О. Фамилия%$\,^2$%

 }

\efootnote{
%%
%\vspace{-3mm}\parindent=7mm
%%
%\vskip 0.1mm $^{*}$ Работа выполнена при финансовой поддержке
%Рoссийского фонда фундаментальных исследований (грант №
%17-51-53030).\par
%%
%%\vskip 2.0mm
%%
\indent{\copyright} Санкт-Петербургский государственный
университет, \issueyear%
%%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
\fancyfoot[LO]{{\footnotesize\rm{\doivyp/spbu10.\issueyear.\issuenum11 } }\hfill\thepage}%
\fancyfoot[RE]{\thepage\hfill{\footnotesize\rm{\doivyp/spbu10.\issueyear.\issuenum11}}}%
% для оформления нижнего колонтитула
\cfoot{} %

\vskip2.0mm

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{\footnotesize

\noindent%
%$^1$~%
Санкт-Петербургский государственный университет,
Российская Федерация,

\noindent%
%\hskip2.45mm%
199034, Санкт-Петербург, Университетская~наб., 7--9

%\noindent%
%$^2$~%
%Санкт-Петербургский государственный университет,
%Российская Федерация,


%\noindent%
%\hskip2.45mm%
%1199034, Санкт-Петербург,
%Университетская~наб., 7--9

}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\vskip2.5mm%3mm

{\small \noindent \textbf{Для цитирования:} \textit{Дривотин О.
И.} О численном решении задачи оптимального управления на~основе
метода, использующего вторую вариацию траектории~// Вестник
Санкт-Пе\-тербургского университета. Прикладная математика.
Информатика. Процессы управления. \issueyear. Т.~15.
Вып.~\issuenum. С.~\pageref{p11}--\pageref{p11e}. \doivyp/\enskip%
\!\!\!spbu10.\issueyear.\issuenum11

\vskip2.5mm%3mm

{\leftskip=7mm\noindentПредставлен  подход к~численному решению
задачи оптимального управления, основанный на~параметризации
управления и~вычислении первых и~вторых производных функционала
по~параметрам. Вычисление вторых производных производится
на~основе интегрального представления для второй вариации
траектории управляемой динамической системы, включающего некоторый
тензор третьего ранга. Предложенный подход отличается
от~использовавшегося ранее подхода, в~котором вторые производные
функционала выражаются через матричные импульсы. Численный метод,
основанный на~второй вариации, может быть эффективен в~задачах
с~большим числом параметров. Используя матричные импульсы,
%поскольку в~методе на~основе матричных импульсов
необходимо интегрировать систему дифференциаль\-ных уравнений,
количество которых квадратично по~числу параметров.
В~рассматри\-вае\-мом подходе количество интегрируемых
дифференциальных уравнений зависит лишь от~размерности
фазового пространства.\\[1mm]
\textit{Ключевые слова}: оптимальное управление, управляемая
динамическая система, вторая вариация, численные методы второго
порядка.

}

}

\vskip 3mm%4mm

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\textbf{Введение.} Рассмотрим управляемую динамическую систему
\begin{equation}
\frac{dx}{dt}=f(t,x,u), \quad t\in[t_0,T], \quad
x(t)\in\Omega\subset R^n, \quad
  x(t_0)=x_0\in \Omega,
\label{eq:dxdt}
\end{equation}
где $u=u(t)$ --- управление
 из~некоторого класса функций,
например из~класса кусочно-непрерывных векторных функций
со~значениями в~некотором множестве: $u(t)\in U\subset R^r.$ Здесь
и далее считаем, что область допустимых состояний системы $\Omega$
и функция $f(t,x,u)$ таковы, что решение задачи Коши
(\ref{eq:dxdt}) существует и~единственно~[1].


Не уменьшая общности, будем рассматривать задачу оптимального
управления Майера, поскольку задачи Лагранжа и~Больца могут быть
сведены к~ней введением дополнительной динамической
переменной~[2,~3]. Для простоты считаем, что на~конечное значение
$x(T)$ не~накладываются никакие дополнительные условия. Задача
Майера состоит в~том, чтобы найти управление $u(t)$ из~заданного
класса функций, доставляющее минимум некоторому функционалу,
который зависит от~ $x(T)$:
\begin{equation}
\min_u\Phi(u),~~ \Phi(u)=g(x(T)). \label{eq:func}
\end{equation}

%Решение задачи (\ref{eq:dxdt}), (\ref{eq:func})
%может быть получено в~аналитическом виде
%на основе принципа максимума Понтрягина \cite{pontr},
%если все величины, используемые
%при формулировке принципа максимума,
%могут быть найдены аналитически.


Численные методы решения задачи оптимального управления
(\ref{eq:dxdt}), (\ref{eq:func}) широко известны. Прямые
методы~[3,~4] состоят в~переходе от~непрерывного описания
со\-стоя\-ния и~управления к~дискретному, что означает их
параметризацию. Тогда функционал можно рассматривать как функцию
от вводимых параметров, и~исходная задача сводится к~задаче
нелинейного программирования.


Непрямые методы [5--10] основаны на~использовании
  импульсов   $\Psi(t)\in T^*_x\Omega,$
компоненты которых называют также сопряженными функциями,
и~в~некоторых из~этих методов функции Гамильтона
$$
H=\Psi(t)f(t,x,u).
$$
При этом импульсы удовлетворяют сопряженному уравнению
\begin{equation}
\frac{d\Psi}{dt}=-\Psi\frac{\partial f}{\partial x}
\label{eq:conjeq}
\end{equation}
 и~конечному условию
\begin{equation}
\Psi(T)=-\frac{\partial g}{\partial x}. \label{eq:tercond}
\end{equation}
Поскольку конечное значение $x(T),$ входящее в~выражение
(\ref{eq:tercond}), заранее неизвестно, то конечное и~тем более
начальное значения $\Psi$ также неизвестны.

Широко известны методы стрельбы (shooting) [4] и~многократной
стрельбы (mul\-tip\-le shoo\-ting)~[9,~10], которые состоят
в~задании некоторых недостающих краевых условий, интегрировании
исходного и~сопряженного уравнений, а~затем коррекции этих краевых
условий. Неизвестное заранее управление находится исходя
из~принципа максимума для функции Гамильтона, вычисляемой
с~использованием результатов интегрирования. При этом в методе
многократной стрельбы данная вычислительная процедура повторяется
на~каждом из~подинтервалов, на~которые разбивается исходный
интервал $[t_0,T].$

В других непрямых численных методах
  задают некоторое начальное управление $u_{(0)}(t),$
интегрируют исходную систему в~прямом направлении, затем
интегрируют сопряженную систему вместе с~исходной в~обратном
направлении и~находят новое управление $u_{(1)}(t).$

В  методе Крылова---Черноусько [11,~12] определяется сначала
управление $u^*_{(1)}$ из~принципа максимума Понтрягина, а~затем
уточненное значение управления
$$
u_{(1)}=u_0+k(u^*_{(1)}-u_{(0)}).
$$
Коэффициент $k$ при этом подбирается так, чтобы функционал
$\Phi(u)$ был меньше при управлении $u_{(1)},$ чем $u_{(0)}.$
Описанная процедура может быть повторена при новом управлении
$u_{(1)}(t).$

Во многих непрямых численных методах используют выражение для
линейной части  приращения  функционала $\Phi(u)$ при вариации
управления~[5,~13]
\begin{equation}
\delta\Phi=-\int\limits_{t_0}^T\Psi\frac{\partial f}{\partial
u}\delta u\,dt. \label{eq:varx}
\end{equation}
%(\ref{eq:varx})
В работах  [14,~15] было предложено параметризовать управление.
Тогда, используя~(\ref{eq:varx}),
 можно определить производные функционала по~параметрам управления,
т.~е. градиент функционала в~пространстве значений параметров.
После этого задача может быть решена на~основе численной
оптимизации с~применением одного из~известных алгоритмов
градиентного спуска~[16--18]. Таким образом,   методы,
 основанные на~выражении (\ref{eq:varx}),
представляют собой методы первого порядка.


При применении метода градиентного спуска бывает трудно определить
шаг и~направление спуска в~пространстве параметров, так как
градиент задает лишь некоторую гиперплоскость, касательную
к~поверхности, на~которой значения функционала постоянны.

%Основную трудность
%при использовании метода первого
%порядка, представляет выбор
%направления и~шага спуска,
%поскольку градиент функционала,
%который вычисляется
%в рамках этого метода,
% определяет лишь гиперплоскость
%в многомерном пространстве параметров управления,
%при малом смещении вдоль которой значение функционала
%не меняется.
Кроме того, для вырожденных задач оптимального управления, когда
$\Psi\partial f/\partial u=0,$ невозможно использовать этот метод,
так как вычисляемый градиент оказывается равным нулю.

Потому большое внимание уделяют также методам второго порядка
[5,~15, 19--23], под которыми понимаются такие методы, в~которых
используется выражение для квадратичной части функционала $\Phi,$
аналогичное (\ref{eq:varx}):
\begin{equation}
\delta^2\Phi= \frac12 \Biggl[\delta x^{\rm T} \frac{\partial^2
g}{\partial x^2}\delta x -\int\limits_{t_0}^T \biggl( \delta
x^{\rm T} \frac{\partial^2 H}{\partial x^2}\delta x+ 2\delta
x^{\rm T} \frac{\partial^2 H}{\partial x\partial u}\delta u+
\delta u^{\rm T} \frac{\partial^2 H}{\partial u^2}\delta u
\biggr)\,dt\Biggr]. \label{eq:var2x}
\end{equation}
Здесь индекс T обозначает транспонирование, а~$\delta x$ ---
вариация траектории $x(t)$
%представляет собой линейную часть приращения траектории $x(t)$
при вариации управления $\delta u,$
%то есть первую вариацию траектории.
%Величина $\delta x$ удовлетворяет
удовлетворяющая дифференциальному уравнению
$$
%\begin{equation}
\frac{d\delta x}{dt}=\frac{\partial f}{\partial x}\delta x
+\frac{\partial f}{\partial u}\delta u
$$
%\label{eq:ddxdt}
%\end{equation}
и начальному условию
$$
\delta x(t_0)=0.
$$
%Таким образом подинтегральное выражение в~(\ref{eq:var2x})
%зависит от~первой вариации траектории и~вариации управления.

Рассматривая управление в~параметризованном виде и~применяя
(\ref{eq:var2x}), можно получить выражения для вторых производных
функционала по~параметрам управления [15,~22], %
%аналогичные выражениям для первых производных,
которые содержат так называемые матричные импульсы, введенные
Р.~Габасовым и~Ф.~М.~Кирилловой~[21]. %
%вместо импульсов $\Psi$ в~выражениях для первых производных.
При этом
%каждый из~матричных импульсов
каждая из~вторых производных
 является решением
некоторой краевой задачи для соответствующего обыкновенного
дифференциального уравнения.

%Поскольку размер матрицы матричного импульса
%равен числу параметров,
%количество компонент матричных импульсов
%квадратично по~этому числу.

%Так как количество вторых производных
%квадратично по~числу параметров,
%численное решение может потребовать


Во многих задачах параметризация управляющих функций может
требовать большого числа параметров.
%Например, ускорительный
%канал с~про\-стран\-ствен\-но-од\-но\-род\-ной квадрупольной
%фокусировкой может состоять
%из нескольких сотен ячеек,
%каждая их которых в~простейшем случае
%описывается тремя параметрами,
Например, в~задачах оптимизации ускорительных структур их может
быть несколько сотен, что дает порядка $10^6$ краевых задач для
вторых производных функционала по~параметрам.

С этой точки зрения, представляется актуальной разработка нового
подхода, позволяющего существенно повысить эффективность
вычислений при решении рассматриваемой задачи. В~настоящей работе
предлагается подход,
%Такой подход и~предлагается в~настоящей работе.
в рамках которого вторые производные функционала выражаются через
некоторые тензоры третьего ранга, удовлетворяющие соответствующим
краевым задачам. При этом количество уравнений для компонент
тензоров, которые должны численно интегрироваться, зависит только
от размерности фазового пространства и~может быть существенно
меньше, чем в~подходе, использующем  матричные импульсы.



\textbf{Вторая вариация траектории.} Рассмотрим управляемую
систему (\ref{eq:dxdt}) при некотором начальном условии
$x(t_0)=x_0$ и~при условии, что функция $f(t,x,u)$ дваж\-ды
непрерывно дифференцируема по~$x$ и~$u.$


Пусть
% начальные условия или
управление подверглось малому изменению порядка $O(\lambda),$ где
$\lambda$~--- малое число, а~начальное значение $x_0$
не~изменилось. Представим возмущенное решение в~виде
\begin{equation}
\overline x= x+\delta x+\delta^2x+O(\lambda^3), \label{eq:x}
\end{equation}
где $x$~--- решение невозмущенной системы, $\delta x$~---
величина, линейная по~$\lambda,$ а~$\delta^2x$~--- величина,
квадратичная по~$\lambda,$ которую будем называть второй вариацией
траектории. При этом
$$
f(t,\overline x,u+\delta u)=f(t,x,u)+ \frac{\partial f}{\partial
x}(\delta x+\delta^2 x)+ \frac 12 \frac{\partial^2 f}{\partial
x^2}\delta x^2~ +
$$
\begin{equation}
+ ~ \frac{\partial f}{\partial u}\delta u+ \frac 12
\frac{\partial^2 f}{\partial u^2} \delta u^2+ \frac{\partial^2
f}{\partial x\partial u}\delta x\delta u+ O(\lambda^3).
\label{eq:f}
\end{equation}

Остановимся кратко на~смысле используeмых обозначений.
В~выражениях для второй вариации основное значение имеют члены,
содержащие вторые производные~$f.$ Так, $\partial^2 f/\partial
x^2,$ $\partial^2 f/\partial x\partial u$ представляют собой
тензоры третьего ранга, у~которых два векторных аргумента и~один
из~сопряженного пространства. Обычно аргументы из~сопряженного
пространства записывают слева, а~векторные справа последовательно
без запятой. Мы будем придерживаться этой традиции. Для сокращения
записи два одинаковых аргумента обозначаем в~виде квадрата
аргумента. Например, $\delta x^2$ следует рассматривать как
$\delta x\delta x.$ Кроме того, чтобы подчеркнуть, что некоторое
выражение является векторным аргументом, будем заключать его
в~скобки, если оно состоит из~нескольких сомножителей. Такая форма
записи позволяет существенно уменьшить громоздкость выражений.


Далее, члены в~правой части (\ref{eq:f}) содержат тензорные
свертки по~соответствующим индексам:
$$
\left(\frac{\partial f}{\partial x}\delta x \right)^k=
\sum\limits_{i=1}^{n}\frac{\partial f^k}{\partial x^i}\delta x^i,
\qquad \left(\frac{\partial^2 f}{\partial x^2}\delta x^2
\right)^k= \sum\limits_{i=1}^{n}\sum\limits_{j=1}^{n}
\frac{\partial^2 f^k}{\partial x^i\partial x^j}\delta x^i\delta
x^j,
$$
$$
\left(\frac{\partial f}{\partial u}\delta u \right)^k=
\sum\limits_{i=1}^{r} \frac{\partial f^k}{\partial u^i}\delta u^i,
\qquad \left(\frac{\partial^2 f}{\partial u^2}\delta u^2
\right)^k= \sum\limits_{i=1}^{r}\sum\limits_{j=1}^{r}
\frac{\partial^2 f^k}{\partial u^i\partial u^j}\delta u^i\delta
u^j,
$$
$$
\left(\frac{\partial^2 f}{\partial x\partial u}\delta x\delta u
\right)^k= \sum\limits_{i=1}^{n}\sum\limits_{j=1}^{r}
\frac{\partial^2 f^k}{\partial x^i\partial u^j}\delta x^i\delta
u^j.
$$
При этом контравариантные  индексы записываются сверху,
а~ковариантные снизу.  При записи сверток будем опускать знаки
суммирования, используя правило суммирования Эйнштейна, согласно
которому по~повторяющимся верхним и~нижним индексам производится
суммирование.


Подставляя (\ref{eq:x}) и~(\ref{eq:f}) в~уравнение (\ref{eq:dxdt})
и приравнивая в~обеих его частях члены первого и~второго порядков,
получим  для членов этих порядков два уравнения:
\begin{equation}
\frac{d \delta x}{dt}= \frac{\partial f}{\partial x}\delta x+
\delta_uf, \label{eq:first}
\end{equation}

\begin{equation}
\frac{d \delta^2 x}{dt}= \frac{\partial f}{\partial x}\delta^2 x+
\frac 12 \frac{\partial^2 f}{\partial x^2}(\delta x)^2+ \delta_u
\left(\frac{\partial f}{\partial x} \right)\delta x+ \delta^2_u f,
\label{eq:second}
\end{equation}
в которых
$$
%\begin{equation}
\delta_uf=\frac{\partial f}{\partial u}\delta u, \quad
\delta^2_uf=\frac 12 \frac{\partial^2 f}{\partial u^2}(\delta
u)^2, \quad \delta_u\frac{\partial f}{\partial x}=
\frac{\partial^2 f}{\partial x\partial u}\delta u.
%\label{eq:duf}
%\end{equation}
$$
Уравнение для второй вариации траектории, аналогичное
(\ref{eq:second}), рассматривалось также в~работе~[24].



\textbf{Интегральное представление для второй вариации
траектории.} %
%
Решение линейного неоднородного уравнения (\ref{eq:first}) можно
записать в~виде
\begin{equation}
\delta x(t)=\int\limits_{t_0}^tG(t,t')\delta_uf(t')\,dt',
%+G(t,t_0)\delta x_0,
\label{eq:firstsol}
\end{equation}
где  $G(t,t')$    --- функция Грина соответствующего однородного
уравнения, удовлетворяющая уравнениям
$$
\frac{\partial G(t,t')}{\partial t}= \frac{\partial f}{\partial
x}(t)G(t,t'),
$$
$$
\frac{\partial G(t,t')}{\partial t'}= -G(t,t')\frac{\partial
f}{\partial x}(t')
$$
и условию
$$
G(t,t)=E,
$$
  $E$~--- тензор,
компоненты которого образуют  единичную матрицу:
$$
E^i_j=\delta^i_j,
$$
а $\delta^i_j$~--- символы Кронекера.



Уравнение (\ref{eq:second}) также является линейным неоднородным
относительно $\delta^2x$ уравнением. Поэтому его решение можно
представить следующим образом:
$$
\delta^2 x(t)=\int\limits_{t_0}^tG(t,t') \left\{ \frac 12
\frac{\partial^2 f}{\partial x^2}(t')(\delta x(t'))^2+
\delta_u\frac{\partial f}{\partial x}(t')\delta x(t')+ \delta^2_u
f(t') \right\} \,dt'=
$$
$$
=\frac 12 \int\limits_{t_0}^tG(t,t') \frac{\partial^2 f}{\partial
x^2}(t') \left[
\int\limits_{t_0}^{t'}G(t',t'')\delta_uf(t'')\,dt''
%+G(t',t_0)\delta x_0
\right]^2\,dt'+
$$
\begin{equation}
+\int\limits_{t_0}^tG(t,t') \left[ \delta_u\frac{\partial
f}{\partial x}(t')
\int\limits_{t_0}^{t'}G(t',t'')\delta_uf(t'')\,dt''+ \delta^2_u
f(t') \right]\,dt'. \label{eq:secondsol}
\end{equation}
Рассмотрим первый член выражения (\ref{eq:secondsol}). Он
описывает эффект взаимодействия двух линейных отклонений решения
за счет нелинейности уравнения (\ref{eq:dxdt}), что и~приводит
к~появлению члена второго порядка. Запишем его в~виде
\begin{equation}
\frac 12 \int\limits_{t_0}^tG(t,t') \frac{\partial^2 f}{\partial
x^2}(t') \left[
\int\limits_{t_0}^{t'}G(t',t'')\delta_uf(t'')\,dt'' \right] \left[
\int\limits_{t_0}^{t'}G(t',t''')\delta_uf(t''')\,dt''' \right]
\,dt'. \label{eq:firstterm}
\end{equation}
Интегрирование в~(\ref{eq:firstterm}) выполняется по~области
$$
t'\in [t_0,t],~~~ t'',t'''\in [t_0,t'].
$$
Меняя порядок интегрирования, запишем выражение
(\ref{eq:firstterm}) так:
$$
\frac 12 \int\limits_{t_0}^t\,dt''\int\limits_{t_0}^t\,dt'''
\int\limits_{\max(t'',t''')}^t \Biggl\{ G(t,t')\frac{\partial^2
f}{\partial x^2}(t')\times
$$
\begin{equation}
\times \bigl[ G(t',t'')\delta_uf(t'') \bigr] \bigl[
G(t',t''')\delta_uf(t''') \bigr] \Biggr\}\,dt'.
\label{eq:firstterm2}
\end{equation}

Обозначим подынтегральное выражение для двух внешних интегралов
в~(\ref{eq:firstterm2}) через $F(t'',t'''):$
$$
F(t'',t''')= \int\limits_{\max(t'',t''')}^t
G(t,t')\frac{\partial^2 f}{\partial x^2}(t') \bigl[
 G(t',t'')\delta_uf(t'')
\bigr] \bigl[ G(t',t''')\delta_uf(t''') \bigr] \,dt'.
$$
Очевидно, что
$$
F(t'',t''')=F(t''',t'').
$$
Поэтому интеграл $F(t'',t''')$ по~области $t'',t'''\in [t_0,t']$
равен удвоенному интегралу по~любому из~треугольников:
$t'',t'''\in [t_0,t'],~ t''<t'''$ или $t'', t'''\in [t_0,t'],~
t''>t'''$. Пусть $t''>t'''.$ Тогда выражение (\ref{eq:firstterm2})
можно записать в~виде
\begin{equation}
\int\limits_{t_0}^t\,dt''\int\limits_{t_0}^{t''}\,dt'''
\int\limits_{t''}^t G(t,t')\frac{\partial^2 f}{\partial x^2}(t')
\bigl[
 G(t',t'')\delta_uf(t'')
\bigr] \bigl[ G(t',t''')\delta_uf(t''') \bigr] \,dt'.
\label{eq:firstterm22}
\end{equation}
Учитывая, что $G(t',t''')=G(t',t'')G(t'',t'''),$ перепишем
(\ref{eq:firstterm22})  следующим образом:
%\begin{equation}
$$
\int\limits_{t_0}^t\,dt''\int\limits_{t_0}^{t''}\,dt'''
\int\limits_{t''}^t G(t,t')\frac{\partial^2 f}{\partial x^2}(t')
\bigl[
 G(t',t'')\delta_uf(t'')
\bigr] \bigl[ G(t',t'')G(t'',t''')\delta_uf(t''') \bigr] \,dt'.
$$
%\label{eq:firstterm3}
%\end{equation}


Введем тензор
\begin{equation}
D(t,t'')= \int\limits_{t''}^t G(t,t')\frac{\partial^2 f}{\partial
x^2}(t') \bigl[
 G(t',t'')
\bigr] \bigl[ G(t',t'') \bigr] \,dt'. \label{eq:D}
\end{equation}
%
%
%
Тогда выражение (\ref{eq:firstterm}) примет вид
$$
\int\limits_{t_0}^t\,dt'\int\limits_{t_0}^{t'}\,dt''
D(t,t')\delta_uf(t') \bigl[ G(t',t'')\delta_uf(t'') \bigr]=
$$
$$
=\int\limits_{t_0}^t\,dt' D(t,t')\delta_uf(t') \left[
\int\limits_{t_0}^{t'}\,dt'' G(t',t'')\delta_uf(t'') \right].
$$

Тензор $D$ является, как и~тензор $\partial^2 f/\partial x^2,$
тензором третьего ранга, один раз контравариантным и~дважды
ковариантным. Таким образом, как полилинейная форма он имеет два
векторных аргумента, которые записываем последовательно справа,
как было указано ранее. Заметим, что тензор $D$ симметричен
по~своим векторным аргументам. Из его определения также следует,
что $D(t,t)=0.$

Дифференцируя выражение (\ref{eq:D}) по~второму аргументу, который
обозначим через $t',$ получим следующее дифференциальное
уравнение:
\begin{equation}
\frac{dD(t,t')}{dt'}= D(t,t')\left[\frac{\partial f}{\partial
x}(t')\right]\left[\ldots\right] +D(t,t')\left[\ldots\right]
\left[\frac{\partial f}{\partial x}(t')\right]
-G(t,t')\frac{\partial^2 f}{\partial x^2}(t'). \label{eq:dDdt}
\end{equation}
В  (\ref{eq:dDdt}) многоточие обозначает, что один из~векторных
аргументов у~$D$ отсутствует: в~первом члене в~правой части
уравнения --- второй, во~втором члене --- первый.

Для большей ясности запишем компоненты выражения для второй
вариации траектории (\ref{eq:secondsol}), тензора $D$ и~тензорного
уравнения (\ref{eq:dDdt}):
$$
\delta^2 x^i(t)= \int\limits_{t_0}^t D^i_{jk}(t,t') \frac{\partial
f^j}{\partial u^l}(t')\delta u^l(t') \int\limits_{t_0}^{t'}
G^k_m(t',t'') \frac{\partial f^m}{\partial u^n}(t'')\delta
u^n(t'') \,dt''\,dt'+
$$
$$
+\int\limits_{t_0}^tG^i_j(t,t') \Biggl[ \frac{\partial^2
f^j}{\partial u^k\partial x^l}(t')\delta u^k
\int\limits_{t_0}^{t'}G^l_m(t',t'') \frac{\partial
f^m(t'')}{\partial u^n}\delta u^n\,dt''+
$$
\begin{equation}
+~ \frac{\partial^2 f^j}{\partial u^k\partial u^l}(t') \delta
u^k(t')\delta u^l(t') \Biggr]\,dt', \label{eq:secondsolcomp}
\end{equation}
$$
%\begin{equation}
D^i_{jk}(t,t')= \int\limits_{t'}^t G^i_l(t,t'')\frac{\partial^2
f^l}{\partial x^m\partial x^n}(t'') G^m_j(t'',t') G^n_k(t'',t')
\,dt'',
%\label{eq:Dcomp}
%\end{equation}
$$
$$
\frac{dD^i_{jk}(t,t')}{dt'}= D^i_{mk}(t,t')
 \frac{\partial f^m}{\partial x^j}(t')~
+
$$
$$
%\begin{equation}
+~ D^i_{jm}(t,t') \frac{\partial f^m}{\partial x^k}(t')
-G^i_m(t,t')\frac{\partial^2 f^m}{\partial x^j\partial x^k}(t').
%\label{eq:dDdtcomp}
%\end{equation}
$$



%\textbf{Алгоритм численного решения
%задачи оптимального управления
%с использованием второй вариации траектории.}

\textbf{Вторые производные функционала по~параметрам управления.} %
Изменение функционала (\ref{eq:func})
 при вариации управления $u$ запишем в~виде равенства
\begin{equation}
\Delta\Phi=\frac{\partial g}{\partial x}\Delta x(T)+ \frac 12
\frac{\partial^2 g}{\partial x^2}(\Delta x(T))^2 +o(\lambda^2).
\label{eq:dphi}
\end{equation}
Здесь будем считать, что функция $g(x),$ входящая в~функционал
(\ref{eq:func}), дваж\-ды непрерывно дифференцируема. Удерживая
в~(19) линейные члены, имеем равенство
%\begin{equation}
$$
\delta\Phi=\frac{\partial g}{\partial x}\delta x(T).
%\label{eq:dphi1}
%\end{equation}
$$
Вводя сопряженные импульсы
$$
\Psi(t)=-\frac{\partial g}{\partial x}G(T,t),
$$
удовлетворяющие сопряженному уравнению (\ref{eq:conjeq})
и~конечному условию (\ref{eq:tercond}) и~учитывая формулу
(\ref{eq:firstsol}), получим для вариации функционала $\delta\Phi$
 известное выражение (\ref{eq:varx}).





Удерживая в~  равенстве (\ref{eq:dphi}) квадратичные члены, для
второй вариации функционала при вариации управления получим, что
\begin{equation}
\delta^2\Phi=\frac{\partial g}{\partial x}\delta^2 x(T)+ \frac 12
\frac{\partial^2 g}{\partial x^2}(\delta x(T))^2. \label{eq:dphi2}
\end{equation}
Равенство (\ref{eq:dphi2}) можно записать покомпонентно в~виде
\begin{equation}
\delta^2\Phi=\frac{\partial g}{\partial x^i}\delta^2 x^i(T)+ \frac
12 \frac{\partial^2 g}{\partial x^j\partial x^k}\delta
x^j(T)\delta x^k(T). \label{eq:dphi2c}
\end{equation}



Произведем параметризацию управления следующим образом.
Ра\-зо\-бъем исходный отрезок $[t_0, T]$ на~подотрезки
$[t_i,t_{i+1}],$ $i=\overline{1,M},$ $t_M=T,$
 и~аппроксимируем управление кусочно-постоянной векторной функцией:
$$
u^j(t)=u^j_i, \quad t\in [t_i,t_{i+1}].
$$

На основе выражения (\ref{eq:varx}) определяются первые
производные функционала по~параметрам
\begin{equation}
\frac{\partial\Phi}{\partial u^j_i}=
-\int\limits_{t_i}^{t_{i+1}}\Psi(t)\frac{\partial f}{\partial
u^j}\,dt . \label{eq:derfunc1}
\end{equation}

Аналогичным образом, используя выражение (\ref{eq:dphi2c}), можно
найти и~вторые произ\-вод\-ные функционала по~параметрам.
Представим (\ref{eq:dphi2c}) в~виде суммы двух членов
$$
\frac{\partial^2\Phi}{\partial u^j_i\partial u^l_k}=
\left(\frac{\partial^2\Phi}{\partial u^j_i\partial
u^l_k}\right)_1+ \left(\frac{\partial^2\Phi}{\partial
u^j_i\partial u^l_k}\right)_2,
$$
причем первый член представляет собой вклад во~вторую производную
от первого члена
   (\ref{eq:dphi2c}), а~второй~--- от~второго.
Пусть $i>k.$ Тогда
\begin{equation}
\left(\frac{\partial^2\Phi}{\partial u^j_i\partial
u^l_k}\right)_1= \frac{\partial g}{\partial
x^p}\int\limits_{t_i}^{t_{i+1}} D^p_{qs}(T,t) \frac{\partial
f^q}{\partial u^j}(t) \left(\int\limits_{t_k}^{t_{k+1}}
G^s_m(t,t')\frac{\partial f^m}{\partial u^l}(t')\,dt'\right).
\label{eq:der2func1}
\end{equation}
Если $i<k,$ то аналогичное выражение получим перестановкой
индексов. Наконец, если  $i=k,$ то
\begin{equation}
\left(\frac{\partial^2\Phi}{\partial u^j_i\partial
u^l_k}\right)_1= \frac{\partial g}{\partial
x^p}\int\limits_{t_i}^{t_{i+1}} D^p_{qs}(T,t) \frac{\partial
f^q}{\partial u^j}(t) \left(\int\limits_{t_i}^t
G^s_m(t,t')\frac{\partial f^m}{\partial u^l}(t')\,dt'\right).
\label{eq:der2func2}
\end{equation}
Для второго члена имеем
\begin{equation}
\left(\frac{\partial^2\Phi}{\partial u^j_i\partial
u^l_k}\right)_2=
 \frac{\partial^2 g}{\partial x^m\partial x^n}
\int\limits_{t_i}^{t_{i+1}}G^m_p(T,t)\frac{\partial f^p}{\partial
u^j}\,dt \int\limits_{t_k}^{t_{k+1}}G^n_q(T,t)\frac{\partial
f^q}{\partial u^l}\,dt. \label{eq:der2func3}
\end{equation}

\textbf{Об алгоритме численного решения задачи оптимального
управления на~основе второй вариации траектории. } Для численного
решения задачи оптимального управления будем использовать
следующий алгоритм.


Выбирается некоторое начальное управление, заданное как
параметризованная векторная функция, например кусочно-постоянная
или кусочно-линейная. Затем проис\-хо\-дит циклическое повторение
шагов, каждый из~которых состоит в~изменении параметров управления
в соответствии с~некоторым численным методом минимизации функции
многих переменных~[17]. При реализации подхода, предложенного
в~настоящей работе, предлагаем использовать методы оптимизации
второго порядка, т.~е. такие методы, которые учитывают как первые,
так и~вторые производные минимизируемой функции по~параметрам.
Одним из~таких методов является, например, метод Ньютона~[17],
согласно которому вектор смещения в~пространстве параметров
$\delta u$ определяется следующим образом:
$$
\delta u= -\left(\frac{\partial^2 \Phi}{\partial u^2}\right)^{-1}
\frac{\partial \Phi}{\partial u}.
$$
Здесь  ${\partial^2 \Phi}/{\partial u^2}$ и~${\partial
\Phi}/{\partial u}$~--- матрица вторых производных и~градиент
$\Phi$ в~пространстве параметров соответственно.

Если управление $u$~--- кусочно-постоянная векторная функция, то
вычисление  ${\partial \Phi}/{\partial u}$ производится по~формуле
(\ref{eq:derfunc1}), т.~е. обычным образом, а~${\partial^2
\Phi}/{\partial u^2}$~--- в~соответствии с~предложенным подходом,
т.~е.  по~формулам (\ref{eq:der2func1})--(\ref{eq:der2func3}).


Описанные шаги повторяются до момента, когда будет выполнен
некоторый критерий остановки вычислений.







\textbf{Заключение.} В~настоящей работе рассмотрена вторая
вариация траек\-то\-рии при вариации управления. Записано
дифференциальное уравнение для второй вариации (\ref{eq:second}),
аналогичное приведенному в~работе~[24]. Получено решение этого
дифференциального уравнения в~виде  интегрального представления
(\ref{eq:secondsolcomp}), с~помощью которого можно найти
 вторые производные по~параметрам управления.

Как уже отмечалось, вторые производные функционала могут быть %
%найдены также на~основе известного выражения
%для второй вариации функционала (ref{eq:var2x}) и~
выражены через матричные импульсы.
При этом число дифференциальных уравнений, которые необходимо
численно интегрировать для их определения, квадратично по~числу
параметров и~может быть значительно велико в~ различных прикладных
задачах.

В представленном  в~работе подходе
  необходимо интегрировать
уравнения для функций Грина $G$ и~тензоров $D,$ а~количество
компонент $G$ и~$D$ зависит только от~размерности фазового
пространства $N$: количество компонент $G$ квадратично по~$N$,
а~компонент $D$  пропорционально $N$ в~третьей степени. Таким
образом, применение выражений  (\ref{eq:secondsolcomp}),
(\ref{eq:der2func1})--(\ref{eq:der2func3}) позволяет строить более
эффективные алгоритмы численного решения задачи оптимального
управления в~случаях, когда количество параметров управления
велико, а~размерность фазового пространства небольшая.

Численные методы решения задачи оптимального управления
применяются во~многих прикладных задачах. В~работах
Д.~А.~Овсянникова и~его последователей~[25--29] эти методы
получили дальнейшее развитие с~целью их использования для
оптимального управления ансамблями динамических систем, что
позволило решать такие сложные задачи как оптимизация структуры
каналов ускорения заряженных частиц. Особенностью этих задач
является большой объем вычислений, что диктует необходимость
разработки более эффективных алгоритмов, чем существующие,
основанные на~методах первого порядка. Ранее было предложено
применять здесь методы второго порядка, в~которых используются
матричные импульсы~[28]. Но, так как число параметров в~задачах
оптимизации структуры канала ускорения может достигать нескольких
сотен, для реализации такого подхода необходимо численно
интегрировать системы, содержащие десятки и~сотни тысяч
дифференциальных уравнений. Однако размерность фазового
пространства в~данных задачах невелика и~обычно равна шести.
Поэтому, по~нашему мнению, для решения таких задач было бы более
эффективно применение предложенного в~настоящей работе подхода,
чем подхода на~основе матричных импульсов.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\newpage
\input{11/lit-ra}

%\newpage
\input{11/ref-s}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{\footnotesize

%\thispagestyle{empty}

\vskip 3mm

\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
\fancyfoot[LO]{\footnotesize{\rm{Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~15.~Вып.~\issuenum}}
\hfill}%
\fancyfoot[RE]{\hfill\footnotesize{\rm{Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~15.~Вып.~\issuenum}}}%
% для оформления нижнего колонтитула
\cfoot{} %

}
