
\noindent{\small УДК 51-76  \hfill {\footnotesize Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~16.~Вып.~\issuenum}\\
MSC 62P12

}

\vskip3mm

\noindent{\bf К~вопросу автоматизации построения вариограмм \\ в~задачах точного земледелия$^{*}$%
 }

\vskip3mm

\noindent{\it В.~П.~Якушев$\,^1$%
, В.~М.~Буре$\,^{1,2}$%
, О.~А.~Митрофанова$\,^{1,2}$%
, Е.~П.~Митрофанов$\,^{1,2}$%
%, И.~О. Фамилия%$\,^2$%
}

\efootnote{
%%
\vspace{-3mm}\parindent=7mm
%%
\vskip 0.1mm $^{*}$ Работа выполнена при финансовой поддержке Российского фонда фундаментальных исследований (грант № 19-29-05184 мк).\par
%%
%%\vskip 2.0mm
%%
\indent{\copyright} Санкт-Петербургский государственный
университет, \issueyear%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
\fancyfoot[LO]{{\footnotesize\rm{\doivyp/spbu10.\issueyear.\issuenum09 } }\hfill\thepage}%
\fancyfoot[RE]{\thepage\hfill{\footnotesize\rm{\doivyp/spbu10.\issueyear.\issuenum09}}}%
% для оформления нижнего колонтитула
\cfoot{} %

\vskip3mm

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{\footnotesize

\noindent%
$^1$~%
Агрофизический научно-исследовательский институт,
Российская Федерация,

\noindent%
\hskip2.45mm%
195220, Санкт-Петербург, Гражданский пр., 14

\noindent%
$^2$~%
Санкт-Петербургский государственный университет, Российская
Федерация,

\noindent%
\hskip2.45mm%
199034, Санкт-Петербург, Университетская~наб., 7--9

}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\vskip3mm

{\small \noindent \textbf{Для цитирования:} \textit{Якушев В.~П.,
Буре В.~М., Митрофанова О.~А., Митрофанов Е.~П.} К~вопросу
автоматизации построения вариограмм в~задачах точного
земледелия~// Вестник Санкт-Петербургского университета.
Прикладная математика. Информатика. Процессы управления.
\issueyear. Т.~16. Вып.~\issuenum.
С.~\pageref{p9}--\pageref{p9e}. %\\
\doivyp/\enskip%
\!\!\!spbu10.\issueyear.\issuenum09

\vskip3mm

{\leftskip=7mm\noindentБольшинство задач точного земледелия (ТЗ)
основаны на оценке изменчивости агроэкологических параметров
(дифференцированное внесение удобрений, выделение неоднородных зон
сельскохозяйственного поля и~др.). В~связи с~этим актуальным
и~перспективным направлением является изучение пространственной
структуры таких данных с~помощью геостатистических методов. Для
выполнения валидации модели вариограммы, определения ее
параметров, анализа анизотропии и~осуществления других этапов
эксперимента требуется значительное количество численных расчетов.
Вручную их все провести крайне сложно, потому необходима
автоматизация таких процессов. Большинство существующих программ
исключает определенные действия, которые могут иметь важное
значение при решении задач ТЗ (нет возможности исследования
анизотропии или пространственного тренда, ограничено число
теоретических моделей вариограммы и~т.~п.), а~использование языков
программирования (R, Python и~др.) требует глубоких экспертных
знаний. Поэтому возникла необходимость автоматизировать решение
определенного круга задач геостатистическими методами. Для
реализации рассматриваемого модуля оптимальным представляется
применение языка программирования R, обладающего рядом
существенных преимуществ: открытый исходный код и~бесплатный
доступ, значительное количество поддерживаемых и~регулярно
пополняемых пакетов, широкие графические возможности,
кросс-платформенность и~др. Представлены общие предложения по
автоматизации построения вариограмм и~дальнейшего использования
в~решении определенного
круга задач ТЗ.\\[1mm]
\textit{Ключевые слова}: вариограммный анализ, точное земледелие, геостатистика, автоматизация, язык программирования R.

}

}

\vskip 4mm

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{ \bfseries  Введение.} Технологии точного земледелия (ТЗ)
основываются на ис\-сле\-до\-ва\-ниях пространственной
вариабельности агроэкологических параметров. Прецизионное
применение сельскохозяйственных ресурсов позволяет не только
экономить финансовые и~трудозатраты, но и~повышать урожайность,
а~также снижать вредное воздействие на окружающую среду [1].
В~последние годы активно развиваются различные системы поддержки
принятия решений для предоставления специализированных программных
инструментов и~баз знаний сельскохозяйственным производителям [2].
Такие системы предназначены для оперативного сбора, хранения
и~обработки множества типов агроэкологических данных (данные
дистанционного зондирования (ДДЗ), агрохимические показатели почвы
и т.~п.).

Геостатистика включает в~себя ряд методов, позволяющих
осуществлять анализ вариабельности пространственно распределенных
данных. Этот подход активно используется не только в~геологии [3],
но и~в~других областях, оперирующих пространственно
структурированными параметрами, например в~метеорологии [4],
геохимии~[5], экологии [6] и~др. В~последние десятилетия он
становится также актуальным и~востребованнным для решения задач ТЗ
[7]. Основные этапы геостатистического анализа состоят из
построения экспериментальной вариограммы, подбора ее теоретической
модели, а~также при необходимости пространственной интерполяции
методом кригинга.

Для выполнения валидации модели вариограммы, определения ее
параметров, анализа анизотропии и~осуществления других этапов
эксперимента требуется большое количество численных расчетов.
Вручную их провести крайне сложно, в~связи с~чем необходима
автоматизация таких процессов. В~таблице представлены наиболее
используемые бесплатные программы, включающие в~себя ряд этапов
геостатистического анализа. Однако следует отметить, что
большинство из них исключают определенные действия, которые могут
иметь важное значение при решении задач ТЗ (нет возможности
исследования анизотропии или пространственного тренда, ограничено
число теоретических моделей вариограммы и~т.~п.). Целесообразно
отдельно выделить язык программирования R, который ориентирован на
решение множества задач с~помощью статистического анализа. Главным
его недостатком является необходимость глубоких экспертных знаний,
для пользователей в~области решения практических
и~научно-исследовательских задач ТЗ он слишком сложный. Поэтому
следует автоматизировать решение определенного круга задач
геостатистическими методами.

\begin{table}[h!]
\begin{center}
{\small

{\it Таблица.} {\bf Наиболее используемые бесплатные программы,
включающие в~себя методы геостатистики}%

}

\vskip 3mm

{\footnotesize

\begin{tabular}{|p{3.4cm}|c|c|c|c|c|}
\hline
 & \multicolumn{5}{c|}{Программные инструменты} \\
\cline{2-6} \raisebox{1.5ex}[0cm][0cm]{~~~~~~Характеристики}
& GeoDa & GMT & GSLIB & R (GStat, geoR,...) & SAGA  GIS\\
%& & & & & \\
\hline
 Вариограммный анализ & -- & -- & + & + & + \\
\hline
Кригинг & -- & -- & + & + & + \\
\hline
Кокригинг & -- & -- & + & + & -- \\
\hline
Альтернативные методы & & & & & \\
 пространственной & + & + & -- & + & + \\
интерполяции  & & & & & \\
\hline
ГИС-функции & + & -- & -- & -- & + \\
\hline
& Windows, & Windows, & Windows, & Windows, & Windows, \\
ОС & MacOS, & MacOS, & Linux, & MacOS, & Linux \\
& Linux & Linux & Dos & Linux & \\
\hline
Последняя & 1.14.0 & 6.0.0 & 1.5 & 4.0.0 & 7.6.2 \\
версия & (2019) & (2019) & (2009) & (2020) & (2020) \\
\hline
& & & & Между- & \\
Страна & США & США & США & народный & Германия \\
& & & & проект & \\
\hline
\end{tabular}

}
\end{center}\vspace{-3mm}
\end{table}

{\bfseries  Объекты и~методы.}
К основным задачам ТЗ, требующим применения методов геостатистики, относятся:\\
\indent---\,\,оценка пространственного распределения агроэкологических данных методом кригинга, кокригинга и~т.~п. (например, для дифференцированного внесения удобрений [7]);\\
\indent---\,\,изучение внутриполевой неоднородности с~использованием вариограммного анализа [8];\\
\indent---\,\,мониторинг мелиоративных и~прецизионное применение ирригационных сис\-тем [9, 10];\\
\indent---\,\,оценка эффективности перехода к~дифференцированным технологиям на конкретной сельскохозяйственной территории [11].\\
%
\indentВ большинстве задач статистический анализ осуществляется на
основе набора агроэкологических данных $Z(x_i)$, это могут быть
значения вегетационного индекса NDVI (Normalized Difference
Vegetation Index), полученные с~помощью аэрофото- и~космоснимков
в~ближнем инфракрасном и~видимом диапазонах; агрохимические
и~физические показатели почвы (влажность, электропроводность,
содержание питательных веществ и~т.~п.) и~др. В~первую очередь
необходимо автоматизировать вариограммный анализ, поскольку именно
на этом этапе геостатистики существенные недостатки выявлены
в~доступных программах для решения определенного круга задач ТЗ.

Вариограмма представляется графически как функция расстояний между
наблюдениями, оценивается она на основе экспериментальной
вариограммы [12]:
  \begin{equation*}
  \hat\gamma (\text {\bf h}) = \frac {1}{2N(\text {\bf h})} \sum\limits_{i=1}^{N(\text {\bf h})} [Z(x_i) - Z(x_i+\text {\bf h})]^2,          \end{equation*}
где $\text {\bf h}$ --- вектор расстояния между двумя точками;
$N(\text {\bf h})$ --- число пар экспериментальных точек,
разделенных вектором $\text {\bf h}$. Для ее построения
целесообразно проводить несколько этапов предварительного анализа:
визуализация исходных данных на карте, расчет основных
статистических показателей, проверка ограничений и~предположений
геостатистики (выбросы в~данных, наличие пространственного
тренда), построение гистограммы частот, выбор шага и~количества
лагов, анализ анизотропии.

На заключительном этапе подбирается теоретическая модель
вариограммы (сферическая, экспоненциальная, гауссова, модель
с~эффектом дырок и~др.). Основные компоненты вариограммы:
<<самородок>> ($c_0$)~--- значение начальной изменчивости;
<<ранг>> ($a$)~--- расстояние, на котором данные становятся
полностью независимыми; <<порог>> ($c$)~--- предельное значение
вариограммы, достигаемое на расстоянии ранга.

В качестве проверки построений предлагается использовать
классический подход, основанный на вычислении стандартного
отклонения значений экспериментальной вариограммы и~подобранной
теоретической модели. Однако целесообразно также протестировать
применение более новых подходов, например предложенный в~работе
[13] механизм подбора модели вариограммы, который одновременно
учитывает пространственную структуру изучаемого параметра
и~сопутствующую ей точность интерполяции.

{\bfseries  Результаты и~их обсуждение.} Геостатистический модуль,
автоматизирующий вариограммный анализ для задач ТЗ, предлагается
внедрить в~программный веб-сервис, разрабатываемый
в~Агрофизическом НИИ. На рис.~1 схематично представлена
архитектура этого проекта. Платформа предназначена для
оперативного сбора, хранения и~всесторонней обработки разнородных
данных, используемых для широкого круга востребованных задач
в~области производства растениеводческой продукции.

%\begin{figure}[h!]
%\center {\includegraphics[width=0.75\textwidth]{1.pdf}} \caption
%{\centering.~Структурная схема веб-сервиса, разрабатываемого
%в~Агрофизическом НИИ } \label{fig4}
%\end{figure}


\begin{figure}[h!]
\centering{
\includegraphics[scale=1]{09/fig1}

\vskip 0mm {\small{\it Рис. 1.} Структурная схема веб-сервиса,
разрабатываемого в~Агрофизическом НИИ} }
\end{figure}


Для реализации рассматриваемого модуля оптимальным представляется
использование языка программирования R, обладающего некоторыми
существенными преимуществами: открытый исходный код и~бесплатный
доступ, большое количество поддерживаемых и~регулярно пополняемых
пакетов, широкие графические возможности, высокая совместимость
с~другими языками программирования (например, Python, который
предполагается применять для реализации веб-сервиса
и~геоприложения), кросс-платформенность, значительный объем
инструментария статистического анализа и~машинного обучения. На
рис. 2 схематично представлен общий алгоритм реализации
вариограммного анализа.


%\begin{figure}[h!]
%\center {\includegraphics[width=0.9\textwidth]{2.pdf}}
%\caption{\centering.~Общий алгоритм автоматизации вариограммного анализа }
%\label{fig1}
%\end{figure}

При реализации модуля предполагается, что пользователю будут
доступны дополнительные функции анализа (не по умолчанию,
а~в~качестве отдельных опций), например для анализа выбросов
в~экспериментальных данных. Основной алгоритм можно также
схематично представить следующим образом:
\\
\\{\bf Data}: $Z(x, y)=(Z_1,...,Z_n)$~--- набор агроэкологических геопривязанных данных, $x=(x_1,...,x_n), y=(y_1,...,y_n)$~--- координаты экспериментальных точек, $n$~--- количество наблюдений.
\\{\bf Result}: График вариограммы и~основные результаты построения (параметры модели, наггет-дисперсия и~т.~п.).
\\$//$
\\ Визуализация исходных данных (plot);
\\ Output: карта распределения исследуемого параметра;
\\$//$ Блок предварительного анализа:
\\ trend $ \leftarrow$ оценка присутствия пространственного тренда (линейная корреляция переменной с~координатами, cor.test);
\\ {\bf if} trend $==$ TRUE {\bf then}
\\ \{
\\ \indent Сообщение пользователю об обнаружении дрифта;
\\ \indent Устранение тренда построением его модели (строятся несколько основных, срав-
\\ \indent ниваются коэффициенты детерминации, выбирается наилучшая) и~элиминацией
\\ \indent (вычитаются модельные значения из данных, дальнейший анализ проводится на
\\ \indent остатках);
\\ \}
\\ Построение гистограммы расстояний (hist);
\\ Расчет оптимальных значений шага и~числа лагов с~помощью оценки разброса расстояний, их запись;
\\ Output: Рекомендуемые параметры экспериментальной вариограммы;
\\ Input: Пользователь либо принимает рекомендуемые, либо вводит свои параметры экспериментальной вариограммы;
\\ $//$ Блок построения экспериментальной вариограммы:
\\ anis $ \leftarrow$ оценка присутствия анизотропии (строятся экспериментальные вариограммы в~разных направлениях и~рассчитываются отклонения полученных построений друг от друга, в~случае превышения допустимого значения запоминаются направления анизотропии и~возвращается TRUE, variogram);
\\ Расчет и~запись основных параметров теоретической вариограммы (определяются начальное значение и~предельное, а~также расстояние, где оно достигается);
\\ {\bf if} anis $==$ TRUE {\bf then}
\\ \{
\\ \indent В~параметры теоретической вариограммы записывается информация об
\\ \indent анизотропии;
\\ \indent Output: Графики экспериментальной вариограммы по направлениям, сообщение
\\ \indent пользователю, рекомендуемые параметры теоретической вариограммы;
\\ \}
\\ {\bf else}
\\ \indent Output: График экспериментальной вариограммы, рекомендуемые параметры
\\ \indent теоретической вариограммы;
\\ Input: Пользователь либо принимает рекомендуемые, либо вводит свои параметры теоретической вариограммы, из выпадающего списка выбирает модель;
\\ $//$ Блок построения теоретической вариограммы:
\\ Построение теоретической модели (vgm);
\\ Output: Наложение на график экспериментальной вариограммы теоретической модели;
\\ Подгонка теоретической модели (валидация, fit.variogram);
\\ Output: Скорректированный график, результаты построений.
\\ $//$
\\


\begin{figure}[h!]
\centering{
\includegraphics[scale=1]{09/fig2}

\vskip 2mm {\small{\it Рис. 2.} Общий алгоритм автоматизации
вариограммного анализа} }
\end{figure}



У существующих программных инструментов, реализующих
геостатистические подходы, выделяются две основные проблемы: либо
расчеты чрезмерно упрощены для пользователя, соответственно
упускается часть важных статистических проверок и~результатов,
либо применение средств автоматизации требует от пользователя
глубоких экспертных знаний. Данный модуль от существующих аналогов
отличает ряд особенностей: на каждом этапе построений
рассчитываются оптимальные параметры для дальнейшего анализа,
пользователь может согласиться применять предложенные программой
либо ввести свои показатели; полученные результаты могут быть
напрямую автоматически применены для решения определенной задачи
ТЗ (например, выдать заключение о~целесообразности перехода
к~дифференцированным технологиям на конкретном
сельскохозяйственном поле на основе вычисленной наггет-дисперсии).


{\bfseries  Заключение.} В~работе рассмотрен вопрос автоматизации
построения вариограмм для решения определенного круга задач ТЗ,
связанных с~исследованием пространственной вариабельности
агроэкологических данных. Предложены общий алгоритм реализации,
а~также структура веб-платформы с~составным геостатистическим
модулем, отвечающей за оперативный сбор, хранение и~обработку
геопривязанных параметров.

Данный проект позволит автоматизировать большой объем
вычислительных процессов, а~также внедрить информационные
технологии в~процесс производства растениеводческой продукции.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\newpage
\input{09/lit-ra}

%\newpage
\input{09/ref-s}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{\footnotesize

%\thispagestyle{empty}
%
\vskip 3mm
%
\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
\fancyfoot[LO]{\footnotesize{\rm{Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~16.~Вып.~\issuenum}}
\hfill}%
\fancyfoot[RE]{\hfill\footnotesize{\rm{Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~16.~Вып.~\issuenum}}}%
% для оформления нижнего колонтитула
\cfoot{} %
%
}
