



\zagol{539.3}{О.~А.~Митрофанова$^1$, В.~М.~Буре$^2$,
Е.~В.~Канаш$^1$}{МАТЕМАТИЧЕСКИЙ МОДУЛЬ ДЛЯ АВТОМАТИЗАЦИИ\\
КОЛОРИМЕТРИЧЕСКОГО МЕТОДА ОЦЕНКИ ОБЕСПЕЧЕННОСТИ \\РАСТЕНИЙ
АЗОТОМ}{


\vspace{-3mm}\parindent=7mm


%{\copyright} А.\,Н. Иванов, 2014

\textit {Митрофанова Ольга Александровна}  --- аспирант;
omitrofa@gmail.com

\textit {Буре Владимир Мансурович}  --- доктор технических наук,
профессор;  vlb310154@gmail.com

\textit {Канаш Елена Всеволодовна}  --- доктор биологических наук;
 ykanash@yandex.ru


\vskip 3mm


\emph{Mitrofanova Olga Aleksandrovna}  --- post-graduate student;
 omitrofa@gmail.com

\emph{Bure Vladimir Mansurovich}  --- doctor of technical
sciences, professor;  vlb310154@gmail.com

\emph{Kanash Elena Vsevolodovna}  --- doctor of biological
sciences;  ykanash@yandex.ru


{\copyright} Санкт-Петербургский государственный университет, 2016

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
\fancyfoot[LO]{\hfill\thepage}%
\fancyfoot[RE]{\thepage\hfill}%
%\lhead{} %верхний колонтитул слева
%%\rhead{} % верхний колонтитул справа
% для оформления нижнего колонтитула
\cfoot{} %
%\lfoot{} %
%\rfoot{\thepage} %



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%$^{*)}$ Работа выполнена при частичной финансовой поддержке
%Российского фонда фундаментальных исследований (грант №
%14-08-01276).


}


{\footnotesize


\noindent $^1$ Агрофизический научно-исследовательский институт,
Россия,

\noindent\hskip2.45mm 195220, Санкт-Петербург, Гражданский пр., 14




\noindent $^2$ Санкт-Петербургский государственный университет,
Россия,

\noindent\hskip2.45mm 199034, Санкт-Петербург, Университетская
наб., 7--9




\vskip4.5mm


\begin{list}{}{\leftmargin=7mm \rightmargin=7mm \listparindent=5mm}


\item \hskip5mm Точный прогноз потребности в~питательных веществах растений в~период выращивания необходим для эффективного использования удобрений, выгодной урожайности и~высокого качества продукции. Перспективными приемами мониторинга посевов для принятия решений по~оптимизации продукционного процесса являются доступные недорогие методы анализа цифровых изображений. Колориметрический метод основан на~анализе оптических характеристик  растений по~цифровым изображениям. Для усовершенствования данного метода  разработан модуль, отвечающий за~автоматическое построение калибровочных кривых для количественной оценки обеспеченности растений азотом. Библиогр. 11 назв. Ил. 2.


{\it Ключевые слова}: дистанционное зондирование, цифровой анализ
изображений, обобщенная характеристика цвета, построение
калибровочных кривых.

\end{list}

}

\vskip4mm

\noindent{\it O.~A.~Mitrofanova$^1$, V.~M.~Bure$^2$,
E.~V.~Kanash$^1$}

\vskip3mm \noindent{\bf MATH MODULE TO AUTOMATE THE COLORIMETRIC
METHOD\\ FOR ESTIMATING NITROGEN STATUS OF PLANTS}

\vskip3mm


{\footnotesize



\noindent $^1$ Agrophysical Research Institute, 14, Grazhdanskiy
pr.,

\noindent\hskip2.45mm  St. Petersburg, 195220, Russia


\noindent $^2$ St. Petersburg State University, 7--9,
Universitetskaya nab.,

\noindent\hskip2.45mm  St. Petersburg, 199034, Russia


\vskip4.5mm

\begin{list}{}{\leftmargin=7mm \rightmargin=7mm \listparindent=5mm}

\item \hskip5mm Accurate prediction of nutrient status of plants during the growing period is necessary for the efficient use of fertilizers, low yields and high quality products. The cheap and affordable methods of image analysis are promising techniques for monitoring crops for decision making to optimize the production process. Colorimetric method is based on an analysis of the optical characteristics of plants by digital images. To improve the colorimetric method we developed the module for the automatic construction of calibration curves for quantifying nitrogen status of plants. Refs 11. Figs 2.

\textit{Keywords}: remote sensing, digital image analysis,
generalized color characteristic, construc-\linebreak tion of
calibration curves.

\end{list}

}


\vskip4mm


{\bfseries  Введение.} Методы анализа цифровых изображений
являются перспективными, недорогими и~доступными приемами решения
различных задач [1,~2]. В~последние годы они стали актуальными
также в~задачах мониторинга посевов. Подобные методы имеют ряд
важных преимуществ:

--- изображения могут быть получены быстро и~в~разные моменты
времени, что позволяет оценить изменение состояния посевов
в~динамике;

--- процедура получения и~обработки изображений проста,
не~трудоемка и~не требует длительной специальной подготовки
персонала;

--- реализация этих методов не~требует значительных материальных
затрат.

Для количественной оценки обеспеченности растений удобрением
с~помощью оптических методов следует разработать специальное
программное обеспечение, которое позволит автоматизировать
обработку информации и~облегчит принятие решений о~необходимости
и~дозе подкормки растений. Анализ колориметрических характеристик
растений был проведен во~многих современных исследованиях [3--7].

{\bfseries  Объекты и~методы.}  Колориметрический метод основан
на~анализе оптических характеристик растений по~цифровым
изображениям [7]. Для описания и~анализа колориметрических
параметров была использована модель цветового пространства CIELAB,
принятая Международной комиссией по~освещению (МКО) в~1976~г. [8].
Изображения для анализа получены с~помощью аэрофотосъемки
беспилотными летательными аппаратами (БЛА) самолетного
и~вертолетного типа, на~которых закреплены цифровые камеры. Каждая
аэрофотография поля содержит тестовые площадки~--- небольшие
участки поля, на~которых была внесена определенная доза азота
(например, 0, 30, 50, 70, 90, 110~кг действующего вещества на~1
га). Таким образом, средние значения колориметрических
характеристик посева на~каждой из~тестовых площадок являются
эталонами. Сравнивая с~ними характеристики остальных зон поля,
была оценена потребность растений в~азоте. Полученные
аэрофотоснимки привязывались к~глобальной системе позиционирования
(геопривязка). После этого измерялись колориметрические
характеристики: на~цифровое изображение наносилась сетка,
измерения выполнялись в~каждой ячейке сетки не~менее чем в~20
разных точках. Затем колориметрические характеристики подвергались
статистической обработке. Далее непосредственно оценивалось
содержание азота в~каждой ячейке сетки. Пос\-ле обследования
цифрового изображения и~тестовых площадок на~аэрофотографии
выделялись зоны посева, тре\-бую\-щие подкормки, и~в~специальной
программе генерировались технологические карты, необходимые для
дифференцированного внесения азотных удобрений.

Для того чтобы определить потребность растений в~азоте на~каждом
участке сельскохозяйственного поля, необходимо на~основе
характеристик эталонов построить калибровочную кривую, отражающую
зависимость содержания удобрения от~цвета растений. В~связи с~этим
целесообразно создание математического модуля, позво\-ляю\-щего
автоматизировать построение калибровочных кривых.

{\bfseries  Результаты и~их обсуждение.}  С~помощью программы
Photoshop CS4 Portable были получены средние значения
колориметрических характеристик $L,~a,~b$. Основная трудность при
работе с~графическим редактором Photoshop --- необходимость
перевода данных гистограмм в~размерность системы МКО. В~системе
$L^*a^*b^*$, принятой МКО, значение $L^*$ изменяется в~пределах
от~0 до 100, величины $a^*$ и~$b^*$ от~$-$120 до~120.
А~на~гистограмме в~редакторе Photoshop значения этих характеристик
изменяются в~диапазоне от~0 до~255.

Входными данными рассматриваемого модуля являются количество
тестовых площадок, значения доз азота на~каждой площадке
и~соответствующие им средние значения колориметрических
характеристик, приведенных к~размерности системы МКО: параметр
$L^*$ всегда положителен и~обозначает светлоту; $a^* > 0$
обозначает параметр красной составляющей, $a^* < 0$ --- зеленой,
$b^* > 0$ --- желтой, $b^* < 0$ --- синей. Следовательно, для
построения калибровочной кривой,  описывающей зависимость дозы
азота на~тестовых площадках от~характеристики цвета листьев,
необходимо представить колориметрические характеристики цвета
в~виде единого параметра. В~связи с~этим предложено свернуть
вектор параметров цвета в~одно значение с~использованием выпуклой
линейной комбинации. Данное значение условно названо обобщенной
характеристикой цвета (generalized color characteristic) $C_Lab$,
которая рассчитывается по~формуле [7]
  \begin{equation}\label{1}
  C_Lab = \alpha L^* + \beta_1 a^* + \beta_2 b^*,              \end{equation}
где $\alpha \geq 0$, $\beta_1 \geq 0$ и~$\beta_2 \geq 0$ ---
эмпирически подбираемые коэффициенты для каждого цифрового
изображения посева, причем
  \begin{equation*}
  \alpha + \beta_1 + \beta_2 = 1.                              \end{equation*}
Основной критерий подбора коэффициентов $\alpha,~ \beta_1,
~\beta_2$ --- обеспечение максимально выраженной линейной связи
между дозой азота на~тестовых площадках и~характеристикой цвета
[9--11]. Классический метод решения подобных задач --- линейное
регрессионное моделирование. При построении предполагается, что
линейная модель наилучшим образом характеризует зависимость между
содержанием азота $N$ и~характеристикой цвета~$C_Lab$:
  \begin{equation*}
  N = \beta_0 + \beta_1 C_Lab + \varepsilon,          \end{equation*}
в~которой $\beta_0$ и~$\beta_1$ --- параметры модели,
а~$\varepsilon$ --- случайная величина (возмущение),
характеризующая влияние неучтенных факторов. Уравнение регрессии
при этом примет вид
  \begin{equation}\label{2}
  N^* = b_0 + b_1 C_Lab.                  \end{equation}
Коэффициенты $b_0$ и~$b_1$ вычислялись методом наименьших
квадратов:
   \begin{equation}\label{3}
b_1 = \frac{n \sum\limits_{i = 1}^{n} N_i C^i_Lab - \sum\limits_{i
= 1}^{n} N_i \sum\limits_{i = 1}^{n} C^i_Lab}{n \sum\limits_{i =
1}^{n} (C^i_Lab)^2 - (\sum\limits_{i = 1}^{n} C^i_Lab)^2},
\end{equation}
  \begin{equation}\label{4}
b_0 = \frac{1}{n} \left( \sum\limits_{i = 1}^{n} N_i - b_1
\sum\limits_{i = 1}^{n} C^i_Lab \right).    \end{equation} После
этого была проведена проверка адекватности модели. Соответственно
рассчитываются полная сумма квадратов вариации отклика:
   \begin{equation}\label{5}
  Q = \sum\limits_{i = 1}^{n} \left( N_i - \bar N \right)^2,   \end{equation}
а~также две ее составляющие --- сумма квадратов, объясненная
регрессией:
   \begin{equation}\label{6}
  Q_x = \sum\limits_{i = 1}^{n} \left( N^*_i - \bar N \right)^2,   \end{equation}
и~остаточная сумма квадратов\newpage
  \begin{equation*}
  Q_e = \sum\limits_{i = 1}^{n} \left( N_i - N^*_i \right)^2.     \end{equation*}
При этом $\bar N$ --- среднее выборочное. Для оценки меры
выраженности линейной связи принято использовать долю объясненной
суммы квадратов, называемую коэффициентом детерминации:
  \begin{equation}\label{7}
  R^2 = \frac{Q_x}{Q} = 1 - \frac{Q_e}{Q}.   \end{equation}
Для того чтобы иметь общее суждение о~качестве модели, по~каждому
наблюдению из~относительных отклонений определялась средняя ошибка
аппроксимации \vspace*{-2mm}
   \begin{equation}\label{8}
\bar\varepsilon = \frac{1}{n} \sum\limits_{i = 1}^{n} \frac{|N_i -
N^*_i|}{N_i} \cdot 100.  \end{equation}

Оценка значимости уравнения регрессии в~целом проводится на~основе
\mbox{$F$-кри}\-те\-рия Фишера, строится $F$-статистика:
\vspace*{-2mm}
  \begin{equation}\label{9}
  F = \frac{Q_x / (k - 1)}{Q_e / (n - k)} = \frac{S_x^2}{S_e^2},     \end{equation}
  где $k = 2$ --- число степеней свободы простой линейной регрессии.
Полученный оптимальный набор коэффициентов позволил построить
калибровочную кривую, с~помощью которой можно определить
содержание азота на~каждом элементарном участке поля.

В~ходе решения поставленной задачи был разработан алгоритм
построения калибровочных кривых, осуществлена его проверка
на~адекватность. Схематично алгоритм основной функции построения
можно представить
следующим образом:\\

\noindent$//$ Входные данные основной функции:\\%
{\bf Data}: \,\,\,\,\,\,$n$ --- количество тестовых площадок; $N\!
=\!
(N_1,...,N_n)$ --- значения содержания\\%
\indent \indent азота на~площадках; $L^* = (L^*_1,...,L^*_n), a^*
= (a^*_1,...,a^*_n), b^* = (b^*_1,...,b^*_n)$ ---\\%
\indent \indent соответствующие им цветовые параметры.\\%
$//$ Выходные данные:\\%
{\bf Result}: \,Эмпирически подобранные коэффициенты $\alpha,~
\beta_1,~ \beta_2$; уравнение\\%
\indent \indent калибровочной кривой; коэффициент детерминации
$R^2$; средняя ошибка\\%
\indent \indent аппроксимации $\bar\varepsilon$;
$F$-статистика.\\%
$//$\\%
max $ \leftarrow 0;$\\%
{\bf for} $\alpha \in [0; 1]$ {\bf do}\\%
\{\\%
\indent {\bf for} $\beta_1 \in [\alpha; 1]$ {\bf do}\\%
\indent \{\\%
\indent \indent $\beta_2 \leftarrow 1 - \alpha - \beta_1;$\\%
\indent \indent  Вычисление значений $C_Lab = (C^1_Lab,...,
C^n_Lab)$ по~формуле (1);\\%
\indent \indent {\bf if} {\it Значения $C_Lab$ монотонны} {\bf
then}\\%
\indent \indent \{\\%
\indent \indent \indent $//$ Построение линейной регрессионной
модели:\\%
\indent \indent \indent Вычисление коэффициентов
уравнения линейной регрессии по~\\%
\indent \indent \indent формулам (3), (4);\\%
\indent \indent \indent  Вычисление новых смоделированных значений
содержания азота\\%
\indent \indent \indent $N^* = (N^*_1,..., N^*_n)$ по~формуле
(2);\\%
\indent \indent \indent Вычисление сумм квадратов отклонений
по~формулам (5), (6);\\%
\indent \indent \indent Вычисление средней ошибки аппроксимации
по~формуле (8);\\%
\indent \indent \indent Вычисление коэффициента детерминации $R^2$
по~формуле (7);\\%
\indent \indent \indent {\bf if} $R^2 > $ max {\bf then}\\%
\indent \indent \indent \indent max $ \leftarrow R^2;$\\%
\indent \indent \}\\%
\indent \}\\%
\}\\%
Вычисление $F$-статистики по~формуле (9).\\



Таким образом, находим такой набор коэффициентов $\alpha,~
\beta_1,~ \beta_2,$ при котором коэффициент детерминации
максимален, и~соответственно линейная зависимость параметров $N$
и~$C_Lab$ наиболее выражена.

Модуль был реализован в~среде разработки Visual Studio 2012
Professional с~использованием дополнительной библиотеки ZedGraph
и~языка программирования C\#. На~рис.~1 приведен  пример
результатов расчета модуля.

\begin{figure}[h!]
\centering
\includegraphics[scale=1]{08/fig1}
\vskip 0mm \caption{Пример результатов расчета модуля }%\label{fig:image}
\end{figure}

%\begin{figure}[h]
%\includegraphics{1}
%\caption{~Пример результатов расчета} \label{fig:image}
%\end{figure}

Пример построенной калибровочной кривой иллюстрирует рис.~2.

\begin{figure}[h!]
\centering
\includegraphics[scale=1]{08/fig2}
\vskip 0mm \caption{Пример построенной калибровочной кривой }%\label{fig:image}
\end{figure}

%\begin{figure}[h]
%\includegraphics{2}
%\caption{~Пример построенной калибровочной прямой}
%\label{fig:image}
%\end{figure}

{ \bfseries  Заключение.} В~данном исследовании описан
колориметрический метод количественной оценки обеспеченности
растений азотом, а~также разработан и~реализован алгоритм
построения калибровочных кривых, осуществлена проверка
адекватности модели. На~основании проведенного исследования можно
сформулировать следующие выводы:

---~точная оценка обеспеченности растений азотом с~помощью анализа колориметрических характеристик изображения --- весьма актуальный и~перспективный метод;

---~описанный метод --- доступный, недорогой и~достаточно точный
прием мониторинга растений;

---~рассмотренный метод позволяет наиболее точно оценить
целесообразность внесения азотных удобрений, что, в~свою очередь,
будет способствовать выгодной урожайности, хорошему качеству
продукции, экономии дорогостоящих удобрений, а~также улучшению
экологического состояния полей;

---~оценку обеспеченности растений азотом наиболее эффективно
проводить с~помощью построения калибровочных кривых, отражающих
зависимость дозы азота от~обобщенной характеристики цвета.




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\input{08/lit-ra}

%\newpage

\input{08/ref-s}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


{\footnotesize



%\thispagestyle{empty}

\vskip 3mm



%\thispagestyle{empty}


\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
\fancyfoot[LO]{\footnotesize{\it{Вестник~СПбГУ.~Сер.~10.~Прикладная~математика.~Информатика...~2016.~Вып.~1}}
\hfill}%
\fancyfoot[RE]{\hfill\footnotesize{\it{Вестник~СПбГУ.~Сер.~10.~Прикладная~математика.~Информатика...~2016.~Вып.~1}}}%
%\lhead{} %верхний колонтитул слева
%%\rhead{} % верхний колонтитул справа
% для оформления нижнего колонтитула
\cfoot{} %
%\lfoot{} %
%\rfoot{\thepage} %



\noindent Статья рекомендована к~печати проф. Л. А. Петросяном.

\vskip 1mm

\noindent Статья поступила в~редакцию 26 нoября  2015~г.

}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%\vskip 5mm


%{\footnotesize

%\noindent К\,о\,н\,т\,а\,к\,т\,н\,а\,я\,
%и\,н\,ф\,о\,р\,м\,а\,ц\,и\,я \nopagebreak

%\vskip 3mm



%\textit {Иванов Андрей Николаевич}~--- аспирант; e-mail:
%05x.andrey@gmail.com



%\vskip 2mm




%\emph{Ivanov Andrei Nikolaevich}~--- post-graduate student; e-mail:
%a.ivanov@fz-juelich.de

%}
