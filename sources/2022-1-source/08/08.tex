
%\noindent{\small УДК 519.178  \hfill {\footnotesize %Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~18.~%Вып.~\issuenum}\\
%MSC 91B38

\noindent{\small \mbox{\,}  \hfill {\footnotesize Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~18.~Вып.~\issuenum}\\
УДК 620.187.3.004.932.2\\
MSC 05C85

}

\vskip3mm

\noindent{\bf Численные методы и алгоритмы восстановления голографических \\ изображений с произвольным выбором физических размеров плоскости \\ объекта и наблюдения%$^{*}$%
 }

\vskip3.0mm

\noindent{\it А.~Г.~Федоров$^{1, 2}$, В.~В.~Трофимов$^1$, А.~Г.~Карпов$^1$%
%, И.~О. Фамилия%$\,^2$%

}

\efootnote{
%%
%\vspace{-3mm}\parindent=7mm
%%
%\vskip 0.1mm $^{*}$ Работа выполнена при финансовой поддержке %Российского фонда фундаментальных исследований (проект № 20-07-%0108).\par
%%
%%\vskip 2.0mm
%%
\indent{\copyright} Санкт-Петербургский государственный
университет, \issueyear%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
\fancyfoot[LO]{{\footnotesize\rm{\doivyp/spbu10.\issueyear.\issuenum08} }\hfill\thepage}%
\fancyfoot[RE]{\thepage\hfill{\footnotesize\rm{\doivyp/spbu10.\issueyear.\issuenum08}}}%
% для оформления нижнего колонтитула
\cfoot{} %

\vskip2mm

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{\footnotesize


\noindent%
$^1$~%
Санкт-Петербургский государственный университет, Российская Федерация,

\noindent%
\hskip2.45mm%
199034, Санкт-Петербург, Университетская~наб., 7--9


\noindent%
$^2$~%
Северо-восточный федеральный университет им. М. К. Аммосова, Российская Федерация,

\noindent%
\hskip2.45mm%
677027, Республика Саха (Якутия), Якутск, ул. Белинского, 58



}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\vskip2.5mm

{\small \noindent \textbf{Для цитирования:} \textit{Федоров А. Г., Трофимов В. В., Карпов А. Г.} Численные методы и алгоритмы восстановления голографических изображений с произвольным выбором физических размеров плоскости объекта и наблюдения~// Вестник
Санкт-Пе\-тер\-бург\-ско\-го университета. Прикладная математика.
Информатика. Процессы управления. \issueyear. Т.~18.
Вып.~\issuenum.
С.~\pageref{p8}--\pageref{p8e}. %\\
\doivyp/\enskip%
\!\!\!spbu10.\issueyear.\issuenum08

\vskip2.5mm

{\leftskip=7mm\noindentПриведены численные результаты моделирования и восстановления голографических изображений с разными физическими размерами плоскости объекта и наблюдения. Предлагаются простые и практичные подходы к относительно свободному выбору физических размеров в обоих плоскостях. Разработаны алгоритмы в случае, когда размерности плоскости объекта и наблюдения совпадают. Разработаны два алгоритма двухэтапного рассеяния для моделирования и восстановления голографических изображений с~относительно свободным выбором физических размеров плоскости объекта и наблюдения.\\[1mm]
\textit{Ключевые слова}: электронная голография, цифровая обработка изображений, преобразование Фурье, приближение Френеля, метод углового спектра.

}

}

\vskip 3mm

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\textbf{1. Введение.}
Метод осевой голографии Габора [1], реализуемой в низкоэнергетических проекционных электронных микроскопах, является одним из перспективных способов структурного анализа объектов [2--4]. Такой способ анализа требует разработки численных методов восстановления изображений, другими словами, получения исходной структуры объекта от интерференционной картины (голографическое изображение объекта). В этом заключается основное достоинство осевой голографии, т.~е. запись амплитуды и фазы волны в интенсивность регистрируемого изображения.

В рамках скалярной теории дифракции основным аппаратом, применяемым в~численных расчетах, являются приближения Френеля, Фраунгофера и метод углового спектра [5]. Наиболее интересно с практической точки зрения решение задачи в~ближнем поле (приближение Френеля, метод углового спектра) с точечным источником.

Моделирование распределения комплексного волнового фронта в приближении Френеля можно осуществить двумя основными способами: свертка исходной волны с импульсным откликом или с передаточной функцией импульсного отклика. Более строгим в ближнем поле считается метод углового спектра, который напрямую выводится с интеграла Релея\,---\,Зоммерфельда. В методе углового спектра точечный источник рассматривается в рамках параксиального приближения, т. е. точечный источник представляется в виде плоских волн. Поэтому данный метод применяется, когда расстояния распространения комплексного волнового фронта относительно малы. Для увеличения расстояния распространения метод углового спектра используют многократно [6].

В большинстве работ, связанных с численным восстановлением голографических изображений, вопросы, связанные с физическими размерами плоскости объекта и наблюдения, не изучаются [7--9]. Численное моделирование с различными физическими размерами плоскостей объекта и наблюдения имеет большую практическую значимость для адекватного анализа структуры объектов.

В настоящей работe описаны методы численного моделирования голографических изображений с различными физическими размерами плоскостей объекта и наблюдения.

\textbf{2. Осевая голография Габора.} Рассмотрим распределение волнового фронта (рис.~1).


\begin{figure}[h!]
\centering{
\includegraphics[scale=0.5]{08/fig1}

\vskip 2mm {\small{\it Рис. 1.} Осевая голография Габорa} }
\end{figure}
%
%
%
%\begin{figure}
%\centering
%\includegraphics[width=0.75\textwidth]{Fig1.eps}
%\caption{\label{Рис. 1} Осевая голография Габора }
%\end{figure}
Распространение сферической волны на расстояние $z_1$ можно охарактеризовать следующим образом [9]:
\begin{equation}
   U_{\tt  in}(x,y) \approx \frac{1}{z_1} \exp\left[i\frac{k}{2z_1}\left(x^2+y^2\right)\right],
\end{equation}
где $k=\frac{2\pi}{\lambda}$; $\lambda$ --- длина волны. Отметим, что в (1) и далее (см.~интеграл Ре\-лея\,---\,Зоммерфельда) фазовым множителем $\exp(ikz)$ можно пренебречь.

Пусть поглощающие и отражающие свойства объекта описываются через некую передаточную функцию $t(x,y)$. Тогда распределение комплексной волны за объектом можно представить так:
\begin{equation}
   U_{\tt ex}(x,y) = \frac{1}{z_1}\exp\left[i\frac{k}{2z_1}\left(x^2+y^2\right)\right] \otimes t(x,y),
\end{equation}
здесь $t(x,y)=1 + t'(x,y)$ означает, что часть волны $U_{\tt in}$ проходит без взаимодействия с~объектом; $\otimes$ обозначает свертку. Тогда распределение комплексной волны за объектом можно условно разделить на волну, прошедшую без взаимодействия с объектом (опорная, $r(x,y)$), и волну, провзаимодействовавшую с объектом (объектная, $o(x,y)$):
\begin{equation}
   U_{\tt ex}(x,y) =r(x,y)+o(x,y).
\end{equation}
C учетом уравнения (3) распределение комплексной волны около плоскости наблюдения можно записать в виде
\begin{equation}
\begin{gathered}
   U_{\tt scr}(x_0,y_0) =\frac{1}{i\lambda z}\iint U_{\tt ex}(x,y)\exp\left[i\frac{k}{2z}\left[\left(x_0-x\right)^2+\left(y_0-y\right)^2\right]\right]dxdy = \\
	=R(x_0,y_0)+O(x_0,y_0).
\end{gathered}
\end{equation}
С учетом (4) голографическое изображение объекта, полученное методом осевой голографии Габора, можно записать следующим образом:
\begin{equation}
\begin{gathered}
   H(x_0,y_0)=|U_{\tt scr}(x_0,y_0)|^2= |R(x_0,y_0)|^2 + |O(x_0,y_0)|^2 \,+ \\
	+\, R(x_0,y_0)O^*(x_0,y_0) + R^*(x_0,y_0)O(x_0,y_0).
\end{gathered}
\end{equation}
В соответствии c [4] $|O(x_0,y_0)|^2<<|R(x_0,y_0)|^2$, поэтому величиной $|O(x_0,y_0)|^2$ будем пренебрегать; $|R(x_0,y_0)|^2$ является фоновым изображением, которое может быть удалено численно [10] или путем нормировки [8]; последние два слагаемых в выражении (5) формируют голографическое изображение с мнимым изображением, которое известно как <<двойное изображение>> (<<twin image>>). В электронно-оптических системах оно находится численно (см., например, [11]).

После соответствующих упрощений выражение (5) можно записать так:
\begin{equation}
   H(x_0,y_0) = R^*(x_0,y_0)O(x_0,y_0).
\end{equation}
Для того чтобы восстановить исходную структуру объекта, с учетом выражения (6) применим метод <<обратного рассеяния>>\ [12]:
\begin{equation}
   U_{\tt ex}(x,y) =\frac{1}{i\lambda z}\iint U_{\tt in}(x_0,y_0)H(x_0,y_0)\exp\left[-i\frac{k}{2z}\left[\left(x_0-x\right)^2+\left(y_0-y\right)^2\right]\right]dx_0dy_0.
\end{equation}
С помощью выражений (4) и (7) осуществим численное моделирование и восстановление голографических изображений. Компьютерное моделирование выражений (4) и (7) основано на приближении Френеля или на методе углового спектра с применением алгоритма быстрого преобразования Фурье.



\textbf{3. Методы Френеля и углового спектра.} Сначала приведем выражение (4) в виде
\begin{equation}
   U_{\tt scr}(x_0,y_0) =\frac{1}{i\lambda z}\exp\left[i\frac{k}{2z}\left(x_0^2+y_0^2\right)\right] FT\left[ U_{\tt ex}(x,y)\exp\left[i\frac{k}{2z}\left(x^2+y^2\right)\right]\right],
\end{equation}
здесь $FT[\ ]$ --- двумерное быстрое преобразование Фурье.

Рассмотрим модель распространения волнового фронта, представленную на рис.~1. Тогда с учетом (1) выражение (8) можно представить следующим образом:
\begin{equation}
   U_{\tt scr}(x_0,y_0) =G(x_0,y_0)FT\left[\frac{1}{z_1} t'(x,y)\exp\left[i\frac{k}{2}\left(\frac{1}{z}+\frac{1}{z_1}\right)\left(x^2+y^2\right)\right]\right],
\end{equation}
здесь $G(x_0,y_0)=\frac{1}{i\lambda z z_1}\exp\left[i\frac{k}{2z}\left(x_0^2+y_0^2\right)\right]$. Теперь дадим выражение (9) как свертку  $U(x,y)$ c передаточной функцией:
\begin{equation}
   U_{\tt scr}(x_0,y_0) =FT^{-1}\left[FT\left[\frac{1}{z_1}U(x,y)\right]H(f_x,f_y)\right],
\end{equation}
в которой $f_x=\frac{x}{\lambda z},\ f_y=\frac{y}{\lambda z}$, $U(x,y)=t'(x,y)\otimes \exp \left[i\frac{k}{2z_1}\left(x^2+y^2\right)\right]$. В случае, когда $H\left( {{f_x},{f_y}} \right)= \exp \left[ { - i\pi \lambda z\left( {f_x^2 + f_y^2} \right)} \right]$, считается, что волновой фронт моделируется с помощью приближения Френеля (метод Френеля); когда
\begin{equation}
H\left( {{f_x},{f_y}} \right) = \exp \left[ {ikz\ \sqrt {1 - {{\left( {\lambda {f_x}} \right)}^2} - {{\left( {\lambda {f_y}} \right)}^2}} } \right], \nonumber
\end{equation}
волновой фронт моделируется с помощью метода углового спектра.

Для метода Френеля алгоритм в MATLAB может быть дан следующим образом:

\begin{verbatim}
function [u2] = ConvolFresnel(u1, L, lambda, z, z1)
[M,N] = size(u1);
k = 2*pi/lambda;
% object plane
dx = L / M;
x = -L/2:dx:L/2-dx;
[X, Y] = meshgrid(x, x);
% freq domain
fx = -1/(2*dx) : 1/L : 1/(2*dx) - 1/L;
[FX, FY] = meshgrid(fx, fx);
% simulation
H = exp(-1i*pi*lambda*z*(FX.^2+FY.^2));
H = fftshift(H);
U1 = fft2(fftshift(1/z1*u1.*exp(1i*k/(2*z1)*(X.^2+Y.^2))));
U2 = H.*U1;
u2 = ifftshift(ifft2(U2)).
\end{verbatim}

Для метода углового спектра он будет выглядеть так:

\begin{verbatim}
function [u2] = ASM(u1, L, lambda, z,z1)
[M,N] = size(u1);
k = 2*pi/lambda;
% object plane
dx = L/N;
x = -L/2:dx:L/2-dx;
[X, Y] = meshgrid(x, x);
% freq domain
fx = -1/(2*dx) : 1/L : 1/(2*dx) - 1/L;
[FX, FY] = meshgrid(fx, fx);
if any(sqrt(FX.^2+FY.^2)<=1/lambda)
    H = exp(-1i*k*z*sqrt(1-(lambda*FX).^2-(lambda*FY).^2));
end
H = fftshift(H);
% simulation
U1 = fft2(fftshift(1/z1*u1.*exp(1i*k/(2*z1)*(X.^2+Y.^2))));
U2 = H.*U1;
u2 = ifftshift(ifft2(U2)).
\end{verbatim}

Рассмотрим пример, где размерность $N=500$, длина волны $\lambda = 500\cdot 10^{-9}$~м, расстояние распространения волнового фронта $z=0.14$ м, расстояние от источника до плоскости объекта $z_1=1\cdot 10^{-6}$ м, размер квадратной стороны плоскости объекта $L=2\cdot 10^{-3}$ м. В результате моделирования получим изображение, представленное на рис.~2.


\begin{figure}[h!]
\centering{
\includegraphics[scale=1]{08/fig2}

\vskip 2mm {\small{\it Рис. 2.} Моделирование распределения комплексного поля с помощью\\ методов Френеля (\textit{а}) и углового спектра (\textit{б})\\} }
\end{figure}
%
%\begin{figure}
%\centering
%\includegraphics[width=0.75\textwidth]{Fig2.eps}
%\caption{\label{рис. 2} Моделирование распределения комплексного поля с %помощью методов Френеля (\textit{а}) и углового спектра (\textit{б})}
%\end{figure}
Восстановление исходного сигнала осуществляется с помощью выражения (7). Численная реализация практически аналогична моделированию, поэтому вывод формул не представлен (рис.~3).

\begin{figure}[h!]
\centering{
\includegraphics[scale=1]{08/fig3}

\vskip 2mm {\small{\it Рис. 3.} Сравнение исходного (\textit{а}) и восстановленного с помощью методов\\ Френеля (\textit{б}) и углового спектра (\textit{в}) изображений\\}  }
\end{figure}
%
%
%\begin{figure}
%\centering
%\includegraphics[width=0.75\textwidth]{Fig3.eps}
%\caption{\label{ } Сравнение исходного изображения (\textit{а}) и %восстановленного с помощью методов Френеля (\textit{б}) и углового %спектра (\textit{в})}
%\end{figure}
%
Из полученных результатов можно сделать вывод, что методы Френеля и углового спектра фактически не отличаются в случае, когда размеры плоскостей объекта и наблюдения одинаковы. Немного другая ситуация наблюдается, когда рассматриваются различные размеры плоскостей.

\textbf{4. Метод двухэтапного распространения.}
Для того чтобы размеры плоскостей объекта и наблюдения отличались, необходимо ввести масштабирующий параметр $S$. В случае метода Френеля параметр $S$ можно ввести, рассмотрев двухэтапное распространение. Существует несколько способов описания двухэтапного рассеяния [13--15]. Сначала опишем подход, предложенный в [13] (рис.~4).


\begin{figure}[h!]
\centering{
\includegraphics[scale=0.7]{08/fig4}

\vskip 2mm {\small{\it Рис. 4.} Модель двухэтапного распространения волнового фронта } }
\end{figure}


%\begin{figure}
%\centering
%\includegraphics[width=0.5\textwidth]{Fig4.eps}
%\caption{\label{рис. 4} Модель двухэтапного распространения волнового %фронта}
%\end{figure}

Для вывода уравнений обратимся к выражению (8). В соответствии с [13] распишем его сначала для случая распространения волнового фронта на расстояния $z_1$ и $z_2$:
\begin{equation}
{U_d}\left( {{x_d},{y_d}} \right) = \frac{1}{{i\lambda {z_1}}}\exp \left[ {i\frac{k}{{2z{}_1}}\left( {x_d^2 + y_d^2} \right)} \right]FT\left[ {{U_{\tt ex}}\left( {x,y} \right)\exp \left[ {i\frac{k}{{2{z_1}}}\left( {{x^2} + {y^2}} \right)} \right]} \right],
\end{equation}
\begin{equation}
{U_d}\left( {{x_d},{y_d}} \right) = \frac{1}{{i\lambda {z_2}}}\exp \left[ {i\frac{k}{{2z{}_2}}\left( {x_d^2 + y_d^2} \right)} \right]FT\left[ {{U_{\tt scr}}\left( {{x_0},{y_0}} \right)\exp \left[ {i\frac{k}{{2{z_2}}}\left( {x_0^2 + y_0^2} \right)} \right]} \right],
\end{equation}
где $(x,y)$ --- плоскость объекта; $(x_0,y_0)$ --- плоскость наблюдения; $(x_d,y_d)$ --- фиктивная плоскость. Считается, что физические размеры ($L_1, L_2, L_d$) плоскостей отличаются.
Далее выражения (11) и (12) приравниваются и разрешаются относительно плоскости наблюдения $(x_0,y_0)$:
\begin{equation}
\begin{gathered}
{U_{\tt scr}}\left( {{x_0},{y_0}} \right) = \frac{{{z_2}}}{{{z_1}}}\exp \left[ { - i\frac{k}{{2z{}_2}}\left( {x_0^2 + y_0^2} \right)} \right]F{T^{ - 1}} \times \\
\times \left[ {\exp \left[ {i\frac{k}{2}\frac{{{z_2} - {z_1}}}{{{z_1}{z_2}}}\left( {x_d^2 + y_d^2} \right)} \right]FT\left[ {{U_{\tt ex}}\left( {x,y} \right)\exp \left[ {i\frac{k}{{2{z_1}}}\left( {{x^2} + {y^2}} \right)} \right]} \right]} \right].
\end{gathered}
\end{equation}
В (13) значения для $z_1$ и $z_2$ неизвестны, через них можно выразить физические размеры плоскости объекта и наблюдения. Из рис.~4 видно, что расстояние между плоскостями объекта и наблюдения можно задать следующим образом: $z=z_1-z_2$. Далее для фиктивной плоскости можно написать, что
\begin{equation}
x_d=f_{x_0}\lambda z_2=f_x\lambda z_1. \nonumber
\end{equation}
Тогда учитывая, что $f_{x}=\frac{p}{2\delta_x}$, $f_{x_0}=\frac{q}{2\delta_{x_0}}$ ($p=q=-\frac{N}{2}..\frac{N}{2}-1$; $\delta_x, \ \delta_{x_0}$ --- выборка в~плоскости объекта и наблюдения соответственно):
\begin{equation}
\frac{p}{2\delta_{x_0}} \lambda z_2=\frac{p}{2\delta_{x}} \lambda z_1.
\end{equation}
Далее перепишем (14) в виде
\begin{equation}
S=\frac{z_1}{z_2}=\frac{\delta_x}{\delta_{x_0}}=\frac{L_1}{L_2}.
\end{equation}
Отметим, что для оси $Oy$ рассуждения аналогичные, поэтому они не приводятся. С~учетом (15) получим значения для $z_1$ и $z_2$ относительно размеров $L_1,\ L_2$:
\begin{equation}
\begin{gathered}
z_1=z\frac{L_1}{L_1-L_2}, \\
z_2=z\frac{L_2}{L_1-L_2}.
\end{gathered}
\end{equation}
Теперь перепишем выражение (13) с учетом (15) и (16):
\begin{equation}
{U_{\tt scr}}\left( {{x_0},{y_0}} \right) = F{T^{ - 1}}\left[ {H'\left( {{f_x},{f_y}} \right)FT\left[ {{U_{\tt ex}}\left( {x,y} \right)\exp \left[ {i\frac{k}{{2z}}\left( {\frac{{{L_1} - {L_2}}}{{{L_1}}}} \right)\left( {{x^2} + {y^2}} \right)} \right]} \right]} \right],
\end{equation}
где $H'\left( {{f_x},{f_y}} \right) = \exp \left[ { - i\pi \lambda zS\left( {f_x^2 + f_y^2} \right)} \right]$. Фазовым множителем  перед знаком $FT^{-1}[\ ]$ пренебрегается, в силу незначительного влияния на конечный результат.

В итоге, учитывая точечность источника (2), из (17) получим распределение волнового поля, учитывающее различные размеры плоскости объекта и наблюдения:
\begin{equation}
\begin{gathered}
{U_{\tt scr}}\left( {{x_0},{y_0}} \right) = \\
= F{T^{ - 1}}\left[ {H'\left( {{f_x},{f_y}} \right)FT\left[ {\frac{1}{{{z_0}}}t'\left( {x,y} \right)\exp \left[ {i\frac{k}{2}\left( {\frac{1}{z}\frac{{{L_1} - {L_2}}}{{{L_1}}} + \frac{1}{{{z_0}}}} \right)\left( {{x^2} + {y^2}} \right)} \right]} \right]} \right].
\end{gathered}
\end{equation}

Дополнительно, чтобы избежать краевых эффектов, можно воспользоваться оконной функцией Гаусса высокого порядка [14]:
\begin{equation}
g(x,y)=\exp \left[-\left(\frac{x+y}{w}\right)^2\right], \nonumber
\end{equation}
где $w$ --- ширина функции Гаусса относительно размерности $N$ массива.

Алгоритм реализации выражения (18) можно представить следующим образом:
\begin{verbatim}
function [U2]=TwoStep(u1, L1 ,L2, lambda, z, z0)
[M, N] = size(u1);
k = 2*pi/lambda;
% higher-order Gaussian
[nx, ny] = meshgrid((-N/2 : 1 : N/2 - 1));
nsq = nx.^2 + ny.^2;
w = 1*N;
sg = exp(-nsq.^8/w^16); clear('nsq','w');
% object plane
dx1 = L1/M;
x1 = -L1/2:dx1:L1/2-dx1;
[X, Y] = meshgrid(x1,x1);
% dummy plane
fx1 = -1/(2*dx1):1/L1:1/(2*dx1)-1/L1;
fx1 = fftshift(fx1);
[FX1, FY1] = meshgrid(fx1,fx1);
H = exp(-1i*pi*lambda*z*L1/L2*(FX1.^2+FY1.^2));
% simulation
u = 1/z0*u1.*exp(1i*k/2*(1/(z*L1)*(L1-L2)+1/z0)*(X.^2+Y.^2));
U = H.*fft2(fftshift(u));
U2 = ifftshift(ifft2(U));
U2 = sg.*U2*dx1^2.
\end{verbatim}

Рассмотрим пример из п. 3. Отметим, что на практике голографическое изображение получают на экспериментальных установках, после постобработки (удаления шумов) происходит численное восстановление. Другими словами, с практической точки зрения важным является численное восстановление голографических изображений. Поэтому будем учитывать то, что имеем смоделированное каким-нибудь способом изображение (см., например, рис.~2).


\begin{figure}[h!]
\centering{
\includegraphics[scale=1]{08/fig5}

\vskip 2mm {\small{\it Рис. 5.} Восстановление голографического изображения с помощью метода двухэтапного распространения волнового фронта разными параметрами \\ }
\vskip .5mm {\footnotesize \textit{a} --- $L_1=2\cdot 10^{-3}$ м, $L_2=2.5\cdot 10^{-3}$ м, $w=0.45\cdot N$; \textit{б} --- $L_1=2\cdot 10^{-3}$ м, $L_2=5\cdot 10^{-3}$ м,\\ $w=0.25\cdot N$; \textit{в} --- $L_1=2\cdot 10^{-3}$ м, $L_2=1 \cdot  10^{-2}$ м, $w=0.1\cdot N$ \\ } }
\end{figure}



%\begin{figure}
%\centering
%\includegraphics[width=0.75\textwidth]{Fig5.eps}
%\caption{\label{рис. 5} Восстановление голографического изображения с %помощью метода двухэтапного распространения волнового фронта разными %параметрами: \textit{a} --- $L_1=2\cdot 10^{-3}$ м, $L_2=2.5\cdot 10^{-%3}$ м, $w=0.45\cdot N$; \textit{б} --- $L_1=2\cdot 10^{-3}$ м, %$L_2=5\cdot 10^{-3}$ м, $w=0.25\cdot N$; \textit{в} --- $L_1=2\cdot 10^{-%3}$ м, $L_2=1*10^{-2}$ м, $w=0.1\cdot N$}
%\end{figure}

У вышеописанного двухэтапного рассеяния есть существенный недостаток, заключающийся в том, что при незначительных изменениях физических размеров плоскости наблюдения результаты восстановления будут значительно отличаться, как это представлено на рис.~5. Это связано с параметрами $S$ и $\frac{L_1-L_2}{L_1}$ в выражении (18).

Наиболее гибким в плане <<свободного>>\ выбора физических размеров плоскостей объекта наблюдения является применение свертки вида (10) дважды. Рассмотрим для этого схему распространения, представленную на рис.~6.

\begin{figure}[h!]
\centering{
\includegraphics[scale=0.6]{08/fig6}

\vskip 2mm {\small{\it Рис. 6.} Модель двойного применения свертки --- плоскость объекта;\\ $(x_0,y_0)$ --- плоскость наблюдения; $(x',y')$ --- промежуточная плоскость\\ } }
\end{figure}

%\begin{figure}
%\centering
%\includegraphics[width=0.5\textwidth]{Fig6.eps}
%\caption{\label{рис. 6} Модель двойного применения свертки --- плоскость %объекта; $(x_0,y_0)$ --- плоскость наблюдения; $(x',y')$ --- промежуточная %плоскость}
%\end{figure}

Как из него видно, данный подход похож на метод, показанный на рис.~4}, и~от\-личается лишь тем, что на втором этапе используются результаты первого этапа. В~соответствии с рис.~6 и выражением для первого этапа (см. (9)) получим следующее:
\begin{equation}
    U'\left( {x',y'} \right) = F{T^{ - 1}}\left[ {FT\left[ {\frac{1}{{{z_0}}}U(x,y)} \right]H\left( {{f_x},{f_y}} \right)} \right],
\end{equation}
где $z_0$ --- расстояние <<точечный источник\,---\,плоскость объекта>>; для второго этапа распространения
\begin{equation}
    {U_{\tt scr}}\left( {{x_0},{y_0}} \right) = F{T^{ - 1}}\left[ {FT\left[ {U'(x',y')} \right]H\left( {{f_{x'}},{f_{y'}}} \right)} \right].
\end{equation}
В (19) и (20) важно определить расстояния распространения волнового фронта $z_1, \ z_2$. В работе [13] рассматривается масштабирующий параметр $ m =\frac{\delta_{x_0}}{\delta_{x}}$, с помощью которого они находятся: $z_1=\frac{z}{1-m}$, $z_2=z-z_1$. Учитывая ранее введенный параметр $S$ и предполагая, что $z_1<z_2$,  выражение (14) можно переписать так: $S=\frac{L_2}{L_1}$.

Алгоритм реализации выражений (19) и (20) представим так:
\begin{verbatim}
function [Uout] = two_step_prop(Uin, lambda, L1, L2, deltaX, z)
N = size(Uin, 1);
k = 2*pi/wvl;
% scaling parameter
S = L2/L1;
% intermediate plane
z1 = Dz / (1 - m);
df1 = 1 / (N*deltaX);
fx = -1/(2*deltaX):df1:1/(2*deltaX)-df1;
[Fx, Fy] = meshgrid(fx, fx);
% simulation of wave propagation in intermediate plane
Hd = exp(-1i*pi*lambda*z1*(Fx.^2+Fy.^2));
Hd = fftshift(Hd);
Ud = fft2(fftshift(Uin));
U2 = Hd.*Ud;
U2 = ifftshift(ifft2(U2));
% observation plane
z2 = z - z1;
dltIntr = wvl * abs(z1) / (N * deltaX);
fxd = -1/(2*dltIntr):1/(N*dltIntr):1/(2*dltIntr)-1/(N*dltIntr)  ;
[Fxd, Fyd] = meshgrid(fxd, fxd);
% simulation in observation plane
H = exp(-1i*pi*lambda*z2*(Fxd.^2+Fyd.^2));
H = fftshift(H);
U = fft2(fftshift(U2));
Uout = H.*U;
Uout = ifftshift(ifft2(Uout)).
\end{verbatim}

Отметим, что в первой строке этого алгоритма, функция $U_{\tt in}$ имеет вид
\begin{equation}
    U\left( {x,y} \right) = \frac{1}{{{z_0}}}t'\left( {x,y} \right)\exp \left[ {i\frac{k}{{2{z_0}}}\left( {{x^2} + {y^2}} \right)} \right]. \nonumber
\end{equation}

Рассмотрим пример, в котором произвольно выберем следующие параметры: $L_1=2\cdot 10^{-3}$ м, $L_2=2\cdot 10^{-2}$ м, $\lambda = 500\cdot 10^{-9}$ м, $\delta_X=4\cdot 10^{-6}$ м, $\delta_{X_0}=4\cdot 10^{-6}$ м. В нем будем учитывать минимально возможную размерность массива, в силу произвольного выбора шага дискретизации в плоскостях объекта и наблюдения, в соответствии с~[13]:
\begin{equation}
    N_{\rm min} = \frac{{{L_1}}}{{2{\delta _x}}} + \frac{{{L_2}}}{{2{\delta _{{x_0}}}}} + \frac{{\lambda z}}{{2{\delta _x}{\delta _{{x_0}}}}}=1187.5. \nonumber
\end{equation}
Величины, близкие к $N_{\tt min}$, могут повлиять на ухудшение качества изображения, поэтому для нашего примера возьмем $N=4096$. Результаты моделирования и восстановления представлены на рис.~7.

\begin{figure}[h!]
\centering{
\includegraphics[scale=1]{08/fig7}

\vskip 2mm {\small{\it Рис. 7.} Моделирование ({\it a}) и восстановление ({\it б}) голографического изображения\\ с помощью двойного применения свертки } }
\end{figure}
%
%
%\begin{figure}
%\centering
%\includegraphics[width=0.5\textwidth]{Fig7.eps}
%\caption{\label{рис. 7} Моделирование и восстановление голографического %изображения с помощью двойного применения свертки: (a) моделирование; %(b) восстановление.}
%\end{figure}
Для задач, связанных с относительно произвольным выбором физических размеров плоскостей объекта и наблюдения, применимы выражения (19) и (20).

%\section{Заключение}
\textbf{5. Заключение.}
В работе описаны простые способы численного моделирования и восстановления голографических изображений, а также проведена реализация алгоритмов в MATLAB.

Рассмотрены алгоритмы в случае, когда размерности плоскости объекта и наблюдения совпадают. Представлены два алгоритма двухэтапного рассеяния для моделирования и восстановления голографических изображений с относительно свободным выбором физических размеров плоскости объекта и наблюдения.

Первый алгоритм предусматривает применение мнимой плоскости, когда $z>z_1$. В этом случае фазовые множители под знаками $FT^{-1}[\ ], FT[\ ]$ зависят от величины $L_1$ и $L_2$, вследствие чего появляются ограничения, достаточно сильно влияющие на конечный результат.

Второй алгоритм основан на повторном использовании свертки, где расстояния распространения выражаются через масштабирующий параметр $S$. В этом случае возможен более гибкий способ выбора физических размеров плоскостей объекта и~наблюдения без значительных потерь качества на конечный результат. Однако следует отметить ограничения, связанные с размерностью входного массива. Другими словами, перед регистрацией голографических изображений должна быть проведена предварительная оценка размерности входного массива, с которой будут регистрироваться голографические изображения. Также необходимо помнить, что шаг дискретизации и размеров плоскостей следует менять в адекватных диапазонах, принимая во внимание все возникающие ограничения.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\newpage
\input{08/lit-ra}

%\newpage
\input{08/ref-s}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%{\footnotesize

%\thispagestyle{empty}
%
\vskip 3mm
%
\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
\fancyfoot[LO]{\footnotesize{\rm{Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~18.~Вып.~\issuenum}}
\hfill}%
\fancyfoot[RE]{\hfill\footnotesize{\rm{Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~18.~Вып.~\issuenum}}}%
% для оформления нижнего колонтитула
\cfoot{} %


%}
