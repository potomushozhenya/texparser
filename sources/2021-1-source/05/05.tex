
\noindent{\small УДК 517.977.1  \hfill {\footnotesize Вестник~СПбГУ.~Прикладная~математика.~Информатика
...~\issueyear.~Т.~17.~Вып.~\issuenum}\\
MSC 49M

}

\vskip3mm

\noindent{\bf Метод кодифференциального спуска в задаче нахождения\\ глобального  минимума кусочно-аффинного целевого функционала\\ в линейных  системах управления$^{*}$%
 }

\vskip3mm

\noindent{\it А. В. Фоминых, В. В. Карелин, Л. Н. Полякова, С. К. Мышков, В. П. Трегубов%$^{1,2,3}$%
%, И.~О. Фамилия%$^2$%
}

\efootnote{
%%
\vspace{-3mm}\parindent=7mm
%%
\vskip 0.1mm $^{*}$ Работа выполнена при финансовой поддержке Российского научного фонда (проект № 20-71-10032).\par
%%
%%\vskip 2.0mm
%%
\indent{\copyright} Санкт-Петербургский государственный
университет, \issueyear%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
\fancyfoot[LO]{{\footnotesize\rm{\doivyp/spbu10.\issueyear.\issuenum05 } }\hfill\thepage}%
\fancyfoot[RE]{\thepage\hfill{\footnotesize\rm{\doivyp/spbu10.\issueyear.\issuenum05}}}%
% для оформления нижнего колонтитула
\cfoot{} %

\vskip3mm

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{\footnotesize

\noindent%
%$^1$~%
Санкт-Петербургский государственный университет, Российская
Федерация,

\noindent%
%\hskip2.45mm%
199034, Санкт-Петербург, Университетская~наб., 7--9

}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\vskip3mm

{\small \noindent \textbf{Для цитирования:} \textit{Фоминых А. В., Карелин В. В., Полякова Л. Н., Мышков С. К., Трегубов В. П.} Метод кодифференциального спуска в задаче нахождения глобального минимума кусочно-аффинного целевого функционала в линейных системах управления~// Вестник Санкт-Пе\-тер\-бург\-ского университета.
Прикладная математика. Информатика. Процессы управления.
\issueyear. Т.~17. Вып.~\issuenum.
С.~\pageref{p5}--\pageref{p5e}. %\\
\doivyp/\enskip%
\!\!\!spbu10.\issueyear.\issuenum05

\vskip3mm

{\leftskip=7mm\noindentРассматривается задача оптимального управления объектом, описываемым
линейной нестационарной системой и с кусочно-аффинным функционалом качества.
Изучается задача в форме Майера как со свободным, так и с частично закрепленным правым концом.
Допустимыми считаются кусочно-непрерывные и ограниченные управления, лежащие в каждый момент
времени в некотором параллелепипеде. Производятся стандартные дискретизация исходной системы и
параметризация управления, приводятся теоремы о сходимости решения построенной дискретной системы
к искомому решению непрерывной задачи. Далее для исследования полученной дискретной системы
используется аппарат кодифференциального исчисления и применяется метод модифицированного
кодифференциального спуска, который гарантированно находит глобальный минимум данной задачи
за конечное число шагов. Разрабатываемый алгоритм демонстрируется на примерах.\\[1mm]
\textit{Ключевые слова}: негладкая задача оптимального управления,
кусочно-аффинная функция, кодифференциал, параметризация
управления, метод кодифференциального\linebreak спуска.

}

}

\vskip 4mm

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\textbf{1. Введение.} Несмотря на большое количество теоретических
исследований негладких задач теории оптимального управления в
различных постановках (в том числе получение принципа максимума
для таких задач)
[1--7], %
%\cite{Vinter2}, \cite{Frankowska},
%\cite{Mordukhovich}, \cite{Ioffe},
%\cite{Shvartsman},\cite{Fominyh2}
практическая сторона до сих пор остается плохо развитой в силу
затруднения применения, как правило, сложно устроенных условий
оптимальности при построении численных методов для решения
конкретных задач. В некоторых работах численные методы основаны на
предварительном процессе сглаживания целевой функции. Например,
в~[8, 9] рассматривается минимаксная задача управления, и с
помощью специально построенной гладкой штрафной функции она
сводится к классической непрерывно дифференци\-руе\-мой задаче.
 В работе [10] субдифференцируемая штрафная функция строится для учета
 терминальных ограничений и ограничений на управления, после чего также используется
  процесс сглаживания субдифференциала.

В данной статье изучается задача управления линейной системой как со свободным,
 так и с частично закрепленным правым концом. Описывается целевой функционал
 в форме Майера, который предполагается не гладким, а лишь кусочно-аффинным (см. определение в п. 4)
 по фазовым координатам, и для его минимизации ис\-поль\-зует\-ся аппарат кодифференциального исчисления,
  разрабатываемый в научной школе В.~Ф.~Демьянова
  [11--15]. В работе [16] были получены условия глобального минимума разности полиэдральных функций в терминах кодифференциала.
  % \cite{demrub}, \cite{demtam}, \cite{demshablnik},
%\cite{Fominyh1},  %\cite{Fominyh3}.
   Еще в статье [17] было замечено, что метод кодифференциального
   спуска имеет свойство <<перепрыгивать>> локальные минимумы в некоторых случаях.
    Недавно М.~В.~Долгополиком [18] в конечномерном случае был
    предложен модифицированный метод кодифферен\-циального спуска, который находит глобальный
    минимум кусочно-аффинной функции за конечное число шагов.

В настоящей статье с помощью техники параметризации управления,
разрабатываемой в научной школе К. Л. Тео [19, 20], %
%\cite{LoxtonTeoRehbocka,TeoGohWong},
%\cite{LoxtonTeoRehbocka}
 исходная задача сводится к конечномерной задаче минимизации некоторой функции параметров
  управления. Линейная структура системы позволяет сохранить кусочную аффинность
   этой функции по параметрам управления, потому для ее минимизации можно применять
   упомянутый модифицированный метод кодифференциального спуска [18].



%\vskip3mm \indent
\textbf{2. Постановка задачи.}
Рассмотрим линейную систему обыкновенных дифференциальных уравнений
\begin{equation}
\label{1}
\dot{x}(t) = A(t) x(t) + B(t) u(t)
\end{equation}
с начальной точкой
\begin{equation}
\label{2}
x(0) = x_{0}.
\end{equation}
%и конечным условием
%\begin{equation}
%\label{3}
%%(x_{i_1}(T), \dots, x_{i_p}(T)) = x_T, \quad \{i_1, \dots i_p\} \subset \{1, \dots, n\}, \ p < n.
%\Phi(x(T)) = {\bf 0}_p.
%\end{equation}
В формуле (\ref{1}) $A(t)$, $B(t)$ ---
 вещественные непрерывные матрицы размерностей $n \times n$ и $n \times m$ соответственно,
  заданные на временном промежутке $[0, T]$, где $T > 0$ --- известный конечный момент
   времени; $x(t)$ --- $n$-мерная непрерывная вектор-функция фазовых координат
    с кусочно-непрерывной и ограниченной на $[0, T]$ производной; $u(t)$ --- $m$-мерная
     вектор-функция управлений, которая предполагается кусочно-непрерывной и ограниченной
     на $[0, T]$.

%Также наложим на правую часть системы стандартное условие роста: для каждого компактного подмножества $K \subset R^m$ существует такое число $C$, что для всех $x$, $u \in K$ и $t \in [0, T]$ выполняется $||f(x,u,t)||_{R_n} \leq C (1 + ||x||_{R_n})$. В формуле (\ref{2}) $x_0 \in R^n$ --- заданный вектор.

Будем использовать следующие обозначения:
 $C_{n} [0, T]$ --- пространство $n$-мерных непрерывных на $[0, T]$ вектор-функций
 с производной из пространства $P_{n} [0, T]$; \linebreak $P_{n} [0, T]$ --- пространство кусочно-непрерывных
 и ограниченных на $[0, T]$ $n$-мерных вектор-функций;\, $\langle a, b \rangle$ ---
  скалярное произведение некоторых векторов\, $a, b \in R^d$; $ \mathrm{co} \, P $~---
  выпуклая оболочка множества $P$; $o(\alpha)$ --- величина большего порядка малости
    по сравнению с числом $\alpha$, т. е.
     $o (\alpha) / \alpha \rightarrow 0, \ \text{если} \ \alpha \rightarrow 0$.

Если $t_0 \in [0, T)$ --- точка разрыва вектор-функции $u(t)$, то
для определенности полагаем $u(t_0) = \lim \limits_{t \downarrow
t_0} u(t)$. В точке $T$ положим $u(T) = \lim \limits_{t \uparrow
T} u(t)$. Аналогично счи\-таем,
  что $\dot x(t_0)$ --- правосторонняя производная вектор-функции
   $x$ в точке $t_0$,\, $\dot x(T)$ --- левосторонняя производная вектор-функции $x$ в точке~$T$.

Введем множество допустимых управлений
\begin{equation}
\label{4''}
U = \big\{ u \in P_m[0, T] \ | \ \underline{u}_i \leq u_i(t) \leq \overline{u}_i, \ i = \overline{1, m}, \ t \in [0, T] \big\},
\end{equation}
где $\underline{u}_i, \overline{u}_i \in R$, $i = \overline{1, m}$, --- заданные числа.

%\renewcommand{\thefootnote}{}
%\noindent  { \footnotetext{\footnotesize Вестник СПбГУ. Прикладная математика. Информатика... 2021. Т. 17.  Вып. 1 }}

Обозначим $x(t, u)$ --- решение задачи Коши (\ref{1}), (\ref{2})
 для некоторого заданного управления $u \in U$
 (будем иногда для краткости также писать просто $x(t)$ вместо $x(t, u)$).
  При сделанных предположениях такое решение существует и единственно [21].
  Требуется найти такое управление $u^{*} \in U$, которое доставляет минимум функционалу
$$
\varphi(u) = \psi(x(T, u)).
$$
Считаем, что функция $\psi(x)$ кусочно-аффинна по фазовым
переменным. Соответствующую оптимальную траекторию $x(t, u^*)$
(она должна удовлетворять начальному условию (\ref{2})) обозначим
$x^*(t)$. Предполагаем, что такое решение существует.

{З а м е ч а н и е 1.}
Вместо управлений из пространства $P[0, T]$ и соответственно траекторий из
пространства $C_n [0, T]$ с производными из пространства $P_n [0, T]$ мож\-но
рассматривать измеримые и почти всюду ограниченные на $[0, T]$ управления и~абсолютно непрерывные на отрезке $[0, T]$ траектории с измеримыми
 и почти всюду\linebreak ограниченными на $[0, T]$ производными соответственно.
Тогда при сделанных предположениях у описываемой задачи
оптимального управления  существует решение [22]. Выбор
пространства управлений и траекторий в статье будем объяснять
возмож\-ностью их практического построения.

{З а м е ч а н и е 2.} Множество (\ref{4''}) допустимых управлений выбрано для простоты изложения.
 Можно изучать и другие ограничения на управления, лишь бы они сохраняли кусочно-аффинную
  структуру задачи.

%\vskip3mm \indent
\textbf{3. Параметризация управления.}
Следуя работе [20], произведем следующую дискретизацию исходной задачи.
Разобьем отрезок времени $[0, T]$ на $2^p$ равных частей $\Delta t$ (где $p$ ---
 заданное натуральное число) точками $t_k$, $k = \overline{0,2^p}$, $t_0 = 0, \dots, t_{2^p} = T$.
 Рассмотрим управление, которое принимает постоянные значения на каждом из этих интервалов.
 Оно может быть записано в виде
\begin{equation}
\label{6'}
 u^p(t) = \sum_{k=1}^{2^p} \sigma^{p, k} \chi_{I_k^p}(t),
 \end{equation}
где $\sigma^{p, k} \in R^m$, $k = \overline{1,2^p}$,  ---
 вектор постоянных управлений; $\chi_{I_k^p}(t)$ --- индикаторная функция
 множества $I_k^p = [t_{k-1}, t_k)$, $k = \overline{0,2^p-1}$, $I_{2^p}^p = [t_{2^p-1}, t_{2^p}]$.
  Обозначим $U^p$ --- множество всех векторов $\sigma^{p, k}$, $k = \overline{1,2^p}$,
  лежащих во множестве $U$.

Положим $\sigma^p = (\sigma^{p,1}, \dots, \sigma^{p, {2^p}})'$ и
перепишем исходную систему (\ref{1}) с новым управлением $u^p(t)$:
\begin{equation}
\label{6}
\dot x(t) = A(t) x(t) + B(t) \sigma^p
\end{equation}
и тем же начальным условием
\begin{equation}
\label{2'}
x(0) = x_{0}.
\end{equation}

Обозначим $x(t, \sigma^p)$ --- решение задачи Коши (\ref{6}), (\ref{2'})
для некоторого заданного управления $\sigma^p \in U^p$. При сделанных предположениях
такое решение существует и~единственно [21].
Требуется найти такое управление $\sigma^{p *} \in U^p$, которое достав\-ляет минимум функционалу
\begin{equation}
\label{7}
\overline \varphi(\sigma^p) = \psi(x(T, \sigma^p)).
\end{equation}
Соответствующую оптимальную траекторию $x(t, \sigma^{p *})$ (она
должна удовлетворять начальному условию (\ref{2'})) обозначим
$x^{p *} (t)$. Предполагаем, что такое решение сущест\-вует.

Таким образом, исходная задача построения кусочно-непрерывного управления
 $u^*(t)$ свелась к задаче (или последовательности задач при увеличении числа~$p$)
  построения кусочно-постоянного управления
  $u^{p*}(t) = \sum_{k=1}^{2^p} \sigma^{p*, k} \chi_{I_k^p}(t)$
   (т. е. определения вектора параметров $\sigma^{p *}$).
    Проведенная параметризация управления позволит вычислить кодифференциал
    минимизируемого функционала в каждой точке $\sigma^{p}$ и,~благодаря этому,
     применить к нему метод кодифференциального спуска, тем са\-мым получить
     алгоритм решения исходной задачи. Можно обосновать построенную параметризацию управления,
      т. е. доказать сходимость значений функционала $\varphi(u^{p*}) \rightarrow \varphi(u^*)$
      при $p \rightarrow \infty$. Известны также некоторые результаты по сходимости
      последовательности управлений $u^{p*}$ и траекторий $x(t, u^{p *})$.
      Приведем соответствующие теоремы [20] в удобном для данной статьи виде.

{\bf Теорема 1.} \textit{При сделанных предположениях верно, что}
\begin{equation}
\label{7'}
\varphi(u^{p*}) \rightarrow \varphi(u^*) \ \text {\textit{при}} \ p \rightarrow \infty.
\end{equation}

{\bf Теорема 2.} \textit{При сделанных предположениях справедливо утверждение:
 если \linebreak $u^{p*}\rightarrow \overline u$ почти всюду на интервале $[0, T]$,
 то $\overline u$ есть оптимальное управление исходной задачи.
 Тогда для любого $t \in [0, T]$ верно, что
%\begin{equation}
%\label{8'}
$$\lim_{p \rightarrow \infty} ||x(t, u^{p *}) - x(t, \overline u)||_{R^n} = 0, $$
%\end{equation}
и по определению $x(t, \overline u)$ является оптимальной траекторией (возможно, не единственной) исходной задачи.}

{З а м е ч а н и е 3.}
В действительности в [20] от функции $\psi(x)$
требуется более сильное условие непрерывной дифференцируемости, однако видно,
что доказательства в~этой работе требуемых утверждений используют лишь условие
липшицевости функции $\psi(x)$ на ограниченных подмножествах $R^n$, которое выполнено
в~силу предположения о  кусочной аффинности такой функции.

%\vskip3mm \indent
\textbf{4. Кодифференцируемость кусочно-аффинных функций.}
В общем случае интуитивное понятие кусочно-аффинной функции как функции, получаемой
 <<соединением>> заданных на некоторых множествах аффинных функций
  $\langle c, x \rangle + d$, где $a, x \in R^d$, $b \in R$,
   можно формализовать с помощью понятия полиэдрального разбиения [23].
При такой формализации определения кусочно-аффинной функции
оказы\-вает\-ся
   [23], что функция $\xi : R^n \rightarrow R$ является кусочно-аффинной
   тогда и только тогда, когда найдутся такие конечные наборы
   $(a_i, v_i) \in R \times R^n$, $i = \overline{1,r}$,
    и $(b_j, w_j) \in R \times R^n$,\, $j = \overline{1,s}$, что
\begin{equation}
\label{31} \xi(\varsigma) = \underline\xi(\varsigma) + \overline\xi(\varsigma)
 = \max \{a_i + \langle v_i, \varsigma \rangle \} + \min \{b_j + \langle w_j, \varsigma \rangle \}.
\end{equation}

Здесь не будем использовать полиэдральное разбиение,
а примем формулу (\ref{31}) за <<конструктивное>> определение кусочно-аффинной функции.

\textbf{Определение 1.}
Функция $\xi : R^n \rightarrow R$
 называется кусочно-аффинной тогда и~только тогда, когда она допускает
  представление в форме (\ref{31}).

{З а м е ч а н и е 4.} Множество кусочно-аффинных функций
является линейным пространством, содержащим все аффинные функции и
 замкнутым относительно операций взятия конечного числа максимумов и
  минимумов [23], поэтому, например,
   функция $\xi(\varsigma_1, \varsigma_2) = \min \{|\varsigma_1|, \max \{|\varsigma_1 - 1|, |\varsigma_2| \} \}$ кусочно-аффинная.

Напомним определение кодифференцируемой функции и кодифференциала.

\textbf{Определение 2.}
Пусть имеется некоторое непустое множество $\Sigma \subset R^n$.
 Функция $\xi: \Sigma \rightarrow {\bf R}$ называется кодифференцируемой
 на множестве $\Sigma$, если для каждого $\varsigma \in \Sigma$ существуют
 такие выпуклые компактные множества,
 гиподифференциал \linebreak $\underline d \xi(\varsigma) \subset R \times R^n$ и
 гипердифференциал $\overline d \xi(\varsigma) \subset R \times R^n$,
 что для каждого допустимого приращения $\Delta \varsigma \in R^n$
 (т. е. co$\{ \varsigma, \varsigma + \Delta \varsigma \} \in \Sigma $)
 соответствующее приращение функции~$\xi$ представимо по формуле
$$ \xi(\varsigma+\Delta \varsigma) - \xi(\varsigma) = \max_{(a, v) \in {\underline d}\xi(\varsigma)}
 \big( a + \langle v, \Delta \varsigma \rangle \big) + \min_{(b, w) \in {\overline d}\xi(\varsigma)}
  \big( b + \langle w, \Delta \varsigma \rangle \big) + o (\Delta \varsigma, \varsigma), $$
где $o (\alpha \Delta \varsigma, \varsigma) / \alpha \rightarrow 0$, {если} $\alpha \rightarrow 0$. Пара ${D} \xi (\varsigma) = [{\underline{d}} \xi(\varsigma), {\overline{d}} \xi(\varsigma)]$ называется кодифференциалом функции $\xi$ в точке $\varsigma$.

Заметим, что класс кодифференцируемых функций достаточно широкий:
 к нему, в частности, относятся любые суперпозиции конечного числа максимумов и
 минимумов непрерывно дифференцируемых функций. Для кодифференцируемых функций
 разработано богатое и конструктивное исчисление [12]. Укажем известную формулу~[12] для вычисления кодифференциала кусочно-аффинной функции,
  записанной в~стандартном виде (см. определение 1):
$$ D \xi(\varsigma) = [\underline d \xi(\varsigma), \overline d \xi(\varsigma)],$$
$$\underline d \xi(\varsigma) = \mathrm{co} \big\{ (a_i + \langle v_i, \varsigma \rangle
 - \underline \xi(\varsigma), v_i) \ | \  i = \overline{1,r} \big\}, $$
$$\overline d \xi(\varsigma) = \mathrm{co} \big\{ (b_j+ \langle w_j, \varsigma \rangle
 - \overline  \xi(\varsigma), w_j) \ | \  j = \overline{1,s} \big\}. $$

\vskip3mm \indent
\textbf{5. Учет ограничений на управление и случай частично закрепленного правого конца.}
Построим штрафную функцию, которая учитывает ограничения на управление (см. формулу (\ref{4''})), сохранив для нее прежнее обозначение:
%    \begin{equation}
%\label{22}
%
%{\overline{\varphi}}(\sigma^p) := \overline{\varphi}(\sigma^p) + \lambda_1 \Big [ \sum_{k = 1}^{2^p} \sum_{i = 1}^m \max\{0, \sigma^{p,k}_i - \overline{u}_i\} + \sum_{k = 1}^{2^p} \sum_{i = 1}^m \max\{0, \underline{u}_i - \sigma^{p,k}_i \} \Big] \end{equation}%
\begin{equation}
\begin{array}{c}
\label{22} {\overline{\varphi}}(\sigma^p) :=
\overline{\varphi}(\sigma^p) + \lambda_1 \max\Big\{0,
\sigma^{p,1}_1 - \overline{u}_1, \dots, %& %
\sigma^{p,1}_m -
\overline{u}_m, \dots, \sigma^{p,2^p}_1 - \overline{u}_1,
\dots, \\ %
%
%$$%
\sigma^{p,2^p}_m - \overline{u}_m, \underline{u}_1 -
\sigma^{p,1}_1, \dots, \underline{u}_m -
\sigma^{p,1}_m, \dots, %& $
\underline{u}_1
 - \sigma^{p,2^p}_1, \dots, \underline{u}_m - \sigma^{p,2^p}_m \Big\}.%
%$$ %
\end{array}\end{equation}
Заметим, что штрафное слагаемое здесь является кусочно-аффинной
функцией. Известно [24], что построенная функция будет точной
штрафной. Это означает сле\-дую\-щее: существует такое число
$\lambda^* < \infty$, что для всех $\lambda_1 \geq \lambda^*$
задача минимизации функции (\ref{22}) на всем пространстве $R^m
\times R^{2^p}$ эквивалентна минимизации функции (\ref{7})
 на множестве~$U^p$.


Предположим теперь, что (не умаляя общности) первые $n_T < n$
координат объек\-та системы (\ref{1}), (\ref{2}) в конечный момент
времени  фиксированы, т. е. наложим дополнительное ограничение
    \begin{equation}
\label{24}
x_i(T) = x_{T_i}, \quad i = \overline{1, n_T}, \ n_T< n,
\end{equation}
где числа $x_{T_i}$, $i = \overline{1, n_T}$, заданы.

Составим для учета такого ограничения штрафную функцию и также
сохраним для нее прежнее обозначение:
\begin{equation}
\label{25} \overline{\varphi}(\sigma^p)  := \overline{\varphi}(\sigma^p) +
 \lambda_2 \sum_{i=1}^{n_T} | x_i(T) - x_{T_i}|.\end{equation}

При некоторых естественных дополнительных предположениях данная функция
 также будет точной штрафной [25].
 Это означает следующее: существует такое число $\lambda^{**} < \infty$,
 что для всех $\lambda_2 \geq \lambda^{**}$ задача минимизации функции (\ref{25})
 на всем пространстве $R^m \times R^{2^p}$ эквивалентна минимизации функции (\ref{22})
 при ограничениях  (\ref{24}). Заметим, что штрафное слагаемое здесь является
  кусочно-аффинной по $x$ функцией.

Итак, указанные ограничения на управление и на правый конец траектории не
меняют структуру задачи, и с их учетом окончательно следует рассматривать задачу
минимизации функционала   (\ref{25}) при достаточно больших значениях параметров
$\lambda_1$, $\lambda_2$. На эти параметры существуют некоторые оценки, однако на
практике нужно просто следить за тем, выполняются ли ограничения при выбранных
значениях параметров, а также при необходимости производить их увеличение.

%\vskip3mm \indent
\textbf{6. Кодифференцируемость функционала $\overline
\varphi(\sigma^p)$. Метод кодиф\-фе\-рен\-циаль\-ного спуска.} С
помощью формулы Коши легко непосредственно проверить, что функция
$x(T, \sigma^p)$ аффинна по своему аргументу $\sigma^{p}$.
Действительно,
$$
x(T, \sigma^p) = Y(T) \left( x_0 + \sum_{k=0}^{2^p-1} \int\limits_{t_k}^{t_{k+1}} Y^{-1}
(\tau) B(\tau) \sigma^{p,k} d \tau \right),$$
где $Y(t)$, $t \in [0,T]$, --- фундаментальная матрица системы  (\ref{1}), нормированная в нуле.
Отсюда и из замечания 4 следует: из сделанного предположения о том,
что функция $\psi(x)$ кусочно-аффинна, вытекает кусочная аффинность функции $\overline\varphi(\sigma^p)$. При этом функция $\psi(x)$ может быть записана в
стандартном виде $(\ref{31})$ или каким-нибудь другим образом (см. замечание 4).
%\renewcommand{\thefootnote}{}
%\noindent  { \footnotetext{\footnotesize Вестник СПбГУ. Прикладная математика. Информатика... 2021. Т. 17.  Вып. 1 }}

Известно [26],
что производная вектор-функции $x(T, \sigma^p)$ как функции
аргумента $\sigma^{p,k}$, $k = \overline{1, 2^p}$, дается формулой
  \begin{equation}
\label{51}
 \frac{\partial x(T, \sigma^{p, k})}{\partial \sigma^{p,k}} = H^k(T),
 \end{equation}
в которой матрица $H^k(T)$ есть решение следующего матричного
 дифференциального уравнения:
$$
\dot H^k(t) = A(t) H^k(t) + \delta_{k, l} B(t), $$
$$ t \in [t_{l-1}, t_l), \ l = \overline{k, 2^p-1}, \ t \in [t_{l-1}, t_l], \ l = 2^p,
$$
с начальным условием
$$
\label{19}
 H^k(t) = 0, \quad t \in [0, t_{k-1}),
$$
где $\delta_{k, l}$, $k, l = \overline{1, 2^p}$, --- символ Кронекера.

Пользуясь правилом суперпозиции кодифференцируемой
функции и непрерывно дифференцируемой функции [12],
приведем явную формулу кодифференциала функционала $\overline \varphi(\sigma^p)$ в случае, когда функция $\psi(x)$ записана в стандартном виде:
\begin{equation}
\label{52} \overline \varphi(\sigma^p) = \underline{\overline \varphi}(\sigma^p) +
\overline{\overline \varphi}(\sigma^p)= \max \{a_i + \langle v_i, x(T, \sigma^p) \rangle \}
+ \min \{b_j + \langle w_j, x(T, \sigma^p) \rangle \},
\end{equation}
где
$i = \overline{1,r}$; $j = \overline{1,s}$.
Имеем равенства
$$ D {{\overline \varphi}}(\sigma^p) = [\underline d {{\overline \varphi}}(\sigma^p),
 \overline d {{\overline \varphi}}(\sigma^p)],$$
$$\underline d {{\overline \varphi}}(\sigma^p) =
\mathrm{co} \left\{ \left(a_i + \langle v_i, x(T, \sigma^p) \rangle -
 \underline {\overline\varphi}(\sigma^p), \
 \left(\frac{\partial x(T, \sigma^p)}{\partial \sigma^p}\right)' v_i \right) \
  \Big| \  i = \overline{1,r} \right\},  $$
$$\overline d {{\overline \varphi}}(\sigma^p) =
 \mathrm{co} \left\{ \left(b_j + \langle w_j, x(T, \sigma^p) \rangle -
  \overline {\overline\varphi}(\sigma^p), \ \left(\frac{\partial x(T, \sigma^p)}{\partial \sigma^p}
  \right)' w_j \right) \ \Big| \  j = \overline{1,s} \right\}, $$
в которых производные $\displaystyle{\frac{\partial x(T, \sigma^p)}{\partial \sigma^p}}$
вычисляются по формуле (\ref{51}).

В общем случае (т. е. когда функция $\psi(x)$ кусочно-аффинна, но записана не
 в~стандартном виде $(\ref{52})$) для вычисления кодифференциала функционала
  $\overline \varphi(\sigma^p)$ нужно использовать правила кодифференциального
   исчисления [12] и формулу (\ref{51}). Мы не приводим эти правила для краткости,
   однако заметим, что в данном случае (в силу того, что функция $\psi(x)$ является кусочно-аффинной)
   вычисления по таким правилам не представляют труда.

{З а м е ч а н и е 5.} Отметим, что при вычислении по этим правилам
 как гиподифференциал $\underline d {{\overline \varphi}}(\sigma^p)$,
 так и гипердифференциал $\overline d {{\overline \varphi}}(\sigma^p)$
 кусочно-аффинной функции ${{\overline \varphi}}(\sigma^p) $ будут представлять
  собой выпуклые многогранники, заданные выпуклой оболочкой своих вершин.

Приведем модифицированный алгоритм кодифференциального спуска [18]
для поиска глобального минимума функционала ${{\overline \varphi}}(\sigma^p)$.
Обозначим $J(\sigma^p)$ множество индексов вершин, задающих гипердифференциал
$\overline d {{\overline \varphi(\sigma^p)}}$ функции ${{\overline \varphi(\sigma^p)}}$
в точке $\sigma^p$, а~сами вершины  --- как $z_j(\sigma^p)$, $j \in J(\sigma^p)$.

1. Выберем произвольную начальную точку $\sigma^p_{(0)} \in R^m \times R^{2^p}$ и
положим $N :=~0$, $M_N = J(\sigma^p_{(0)})$.

2. Рассчитаем гиподифференциал $\underline d {{\overline \varphi}}(\sigma^p_{(N)})$ и
гипердифференциал $\overline d {{\overline \varphi}}(\sigma^p_{(N)})$,
тем~самым определив вершины $z_j(\sigma^p_{(N)})$, $j \in M_N$.

3. Для каждого $j \in M_N$ вычислим вектор
$$(a_j(\sigma^p_{(N)}), v_j(\sigma^p_{(N)})) \in \mathrm{argmin} \, ||(a, v)||^2, \quad (a, v)
 \in \underline d {{\overline \varphi}}(\sigma^p_{(N)}) + z_j(\sigma^p_{(N)}),$$
и если будет $a_j(\sigma^p_{(N)}) \geqslant 0$, то положим $M_N := M_N \setminus \{j\}$.

4. Если $M_N = \emptyset$, то процесс завершается. В противном случае найдeм индекс
$$ j(N) \in \mathrm{argmin}_{j \in M_N} \, \overline \varphi
 \left( \sigma^p_{(N)} + \frac{1}{a_j(\sigma^p_{(N)})} v_j(\sigma^p_{(N)}) \right).$$
Далее положим $\sigma^p_{(N+1)} = \sigma^p_{(N)} + \displaystyle{\frac{1}{a_{j(N)}
(\sigma^p_{(N)})} v_{j(N)}(\sigma^p_{(N)})}$, $M_{N+1} := M_N$, $N := N + 1$ и~перейдем к шагу 2.

По предположению выше кусочно-аффинная функция $\overline\varphi
(\sigma^p)$ ограничена снизу и~достигает глобального минимума,
поэтому справедлив следующий результат, полученный
 в работе [18].

{\bf Теорема 3.} \textit{Описанный модифицированный алгоритм
кодифференциального спуска приводит к точке глобального минимума
 функции $\overline\varphi (\sigma^p)$ за конечное число шагов.}

%\vskip3mm \indent
\textbf{7. Численные примеры.} Как было отмечено при описании
алгоритма, при каждом фиксированном параметре $p$ точное решение
находится за конечное число шагов. Однако для сокращения записи
все результаты вычислений будут записаны с~точностью до 4-го знака
после запятой.

\textbf{Пример 1.} На отрезке времени $[0, 1]$ рассмотрим систему
$$
\dot{x}_1 = x_2 + u_1,
$$
$$
\dot{x}_2 = -2 x_1 - 3 x_2 + u_2
$$
с начальным условием
$x(0) = (0, 0)'$.

Необходимо подобрать такое управление $u$  (здесь не накладываем на него никаких ограничений),
которое минимизирует функционал
$$\varphi(u) = \psi(x(1, u)) = \min \left\{ \max \big\{ |x_1(1)|, |x_2(1)| \big\}, 1 +
 \max \big\{ 2 |x_1(1) - 2|, |x_2(1) - 2| \big\} \right\}. $$
Поскольку по своей структуре функция $\varphi(u)$ неотрицательная
 и принимает нулевое значение при $x(1) = (0, 0)'$, то очевидным
 решением (возможно не единственным) будет точка $u^* = (0, 0)'$, $\varphi(u^*) = 0$.

Пусть $p = 0$, т. е. считаем управление постоянным на всем промежутке времени:
 $u = u^0 = \sigma^0$ (см. (\ref{6'})). Заметим, что у функции $\varphi(u)$
 имеется локальный минимум при $x(1) = (2, 2)'$, т. е. если взять управление
 (в данном примере легко вычислить его непосредственно с помощью формулы Коши)
  $u^0_{(0)}=\sigma^0_{(0)} \approx (0.2397, 9.0124)'$, $\varphi(u^0_{(0)}) = 1$.
   Намеренно возьмем эту точку (которая является точкой локального минимума функции
    $\overline\varphi (\sigma^p)$) как начальное приближение, чтобы показать,
    что алгоритм действительно находит глобальный минимум.

На первом шаге были получены следующие результаты вычислений:
$$j(0) = 2, \ a_{j(0)} (\sigma^0_{(0)}) \approx -0.01215, \ v_{j(0)} (\sigma^0_{(0)})  \approx (0.0029, 0.1095)',$$
 поэтому $$\sigma^0_{(1)} \approx \left(0.2397 + {\frac{0.0029}{-0.01215}},
 9.0124 + {\frac{0.1095}{-0.01215}}\right)',$$ т. е. $\sigma^0_{(1)} = (0, 0)'$,
 и в этом примере алгоритм привел к точке глобального минимума за один шаг.
%\newline

\textbf{Пример 2.} На отрезке времени $[0, 1]$ рассмотрим систему
$$
\dot{x}_1 = (2t+1) x_1 + 15 t x_2 + u_1,
$$
$$
\dot{x}_2 = t x_1 + x_2 + u_2
$$
с начальным условием
$x(0) = (1, 1)'$.

Пусть во множестве $U$ заданы границы $\underline{u}_1 =
\underline{u}_2 = -4.5$, $\overline{u}_1 = \overline{u}_2 = 4.5$.
Необходимо подобрать такое управление $u \in U$, которое минимизирует функционал
$$\varphi(u) = \psi(x(1, u)) = |x_1(1)| + |x_2(1)|. $$

Рассмотрим функцию $\overline \varphi(\sigma^p)$ (см. (\ref{22}))
со штрафным параметром $\lambda_1 = 1$. Как будет видно из вычислений,
такой величины штрафного параметра достаточно для точного удовлетворения
ограничениям $\sigma^p \in U^p$. Заметим, что в данном примере эта функция
субдифференцируема, отсюда ее гипердифференциал, вычисленный в любой точке,
состоит из единственной нулевой точки [12], поэтому $j(N) = 1$ для любого номера $N$.

Пусть сначала $p = 0$, т. е. считаем управление постоянным
на всем промежутке времени: $u = u^0 = \sigma^0$ (см. (\ref{6'})).
Возьмем точку $\sigma^p_{(0)} = (0, 0)'$ в качестве начального приближения управления.

На первом шаге были получены такие результаты вычислений:
$$j(0) = 1, \ a_{j(0)} (\sigma^0_{(0)}) \approx -9.20088,
\ v_{j(0)} (\sigma^0_{(0)})  \approx (9.2512, 26.1818)',$$ поэтому

$$\sigma^0_{(1)} \approx \left(0 + {\frac{9.2512}{-9.20088}},
  0 + {\frac{26.1818}{-9.20088}}\right)' \approx (-1.0055, -2.8456)';$$
на втором шаге --- следующие результаты вычислений:
$$j(1) =1, \ a_{j(1)} (\sigma^0_{(1)}) \approx -4.2497, \ v_{j(1)} (\sigma^0_{(1)})
\approx (0.6327, 0.8)',$$ поэтому\pagebreak

$$\sigma^0_{(2)}
\approx \left(-1.0055 + {\frac{0.6327}{-4.2497}},  -2.8456 + {\frac{0.8}{-4.2497}}\right)'
\approx (-1.1539, -3.0338)';$$
на третьем шаге ---
$$j(2) =1, \ a_{j(2)} (\sigma^0_{(2)}) \approx -0.08465, \
v_{j(2)} (\sigma^0_{(2)})  \approx (0.2833, -0.1018)',$$
поэтому
 $$\sigma^0_{(3)} \approx \left(-1.1539 + {\frac{0.2833}{-0.08465}},
-3.0338 + {\frac{-0.1018}{-0.08465}}\right)' \approx (-4.5, -1.8314)',$$
и, поскольку на следующей итерации получим $M_3 = \{1\} \setminus \{1\} =
\emptyset$ (так как $a_{j(3)} (\sigma^0_{(3)}) =~0 $, то  алгоритм завершает свою работу),
тогда найденная точка $\sigma^0_{(3)} = (-4.5, -1.8314)'$ является точкой глобального
минимума в примере.

Однако видно, что $\overline\varphi(\sigma^0_{(3)}) \approx 0.0899$,
а это отличается от нулевого значения данного функционала, которое, возможно,
удастся достичь с помощью управлений $\sigma^p \in U^p$ для б\'ольших значений
параметра $p$ (см. (\ref{7'})).

Возьмем теперь $p = 1$, тогда по определению (см. (\ref{6'})) на
интервале $[0, 0.5)$ управлением будет вектор $\sigma^{1,1} \in
R^2$, а на интервале $[0.5, 1]$ --- вектор $\sigma^{1,2} \in R^2$.
Возьмем в~качестве начального приближения управление, полученное
при $p=0$, т. е. по\-ложим \linebreak $\sigma^{1,1}_{(0)} = (-4.5,
-1.8314)'$, $\sigma^{1,2}_{(0)} = (-4.5, -1.8314)'$, или, более
кратко, %\linebreak
$\sigma^{1}_{(0)} = (-4.5,$ $ -1.8314, -4.5, -1.8314)'$.

На первом шаге были получены следующие результаты вычислений:
$$j(0) = 1, \ a_{j(0)} (\sigma^1_{(0)}) \approx -0.08089, \ v_{j(0)} (\sigma^1_{(0)})
\approx (0, 0.0047, 0 , -0.0236)',$$ поэтому $$\sigma^1_{(1)} \!
\approx \! \left(\!-4.5 + {\frac{0}{-0.08089}}, -1.8314 +
{\frac{0.0047}{-0.08089}},
 -4.5 + {\frac{0}{-0.08089}}, -1.8314 + {\frac{-0.0236}{-0.08089}}\right)\!',$$
 т. е.  $\sigma^1_{(1)} = (-4.5, -1.8843, -4.5, -1.5337)'$
и, поскольку при таком управлении имеем
$\overline\varphi(\sigma^1_{(1)}) = 0$, то алгоритм приводит к
точке глобального минимума в этом примере.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\newpage
\input{05/lit-ra}

%\newpage
\input{05/ref-s}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{\footnotesize

%\thispagestyle{empty}
%
\vskip 3mm
%
\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
\fancyfoot[LO]{\footnotesize{\rm{Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~17.~Вып.~\issuenum}}
\hfill}%
\fancyfoot[RE]{\hfill\footnotesize{\rm{Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~17.~Вып.~\issuenum}}}%
% для оформления нижнего колонтитула
\cfoot{} %
%
}
