
%\begin{center}
%{\footnotesize
%\begin{tabular}{lcr}
%$\issueyear$   & ВЕСТНИК\,САНКТ-ПЕТЕРБУРГСКОГО\,УНИВЕРСИТЕТА  &  Том\,13.\,\,Вып.\,$\issuenum$ \\
%\multicolumn{3}{c}{ПРИКЛАДНАЯ МАТЕМАТИКА.
%ИНФОРМАТИКА. ПРОЦЕССЫ УПРАВЛЕНИЯ}\\
%\end{tabular}
%\end{center}
%}
{\footnotesize \noindent$\issueyear$\mbox{~~~~~~~~~~}
ВЕСТНИК\,САНКТ-ПЕТЕРБУРГСКОГО\,УНИВЕРСИТЕТА
Т.\,13.\,\,Вып.\,$\issuenum$\linebreak %
\mbox{~~~~~~~~~~}ПРИКЛАДНАЯ МАТЕМАТИКА. ИНФОРМАТИКА. ПРОЦЕССЫ
УПРАВЛЕНИЯ %
}

%\ \\ \vskip 0.8mm\hrule \\ \hrule \\ \ \\

\vskip 0.5mm

\hline\vskip .5mm

\hline

\vspace{1.2cm} \noindent {\large ИНФОРМАТИКА} \vspace{1.0cm}

\noindent{\footnotesize УДК 519.237.8}

\vskip3mm

\noindent{\it К.~Ю.~Староверова, В.~М.~Буре}

\vskip3mm

\noindent{\bf МЕРА РАЗЛИЧИЯ ВРЕМЕННЫХ РЯДОВ, ОСНОВАННАЯ\\
НА ИХ ХАРАКТЕРИСТИКАХ}

\efootnote{

\vspace{-3mm}\parindent=7mm


%{\copyright} Н. А. Валиотти, 2014

{\it Староверова Ксения Юрьевна}~--- студент;
ksenygnirps@gmail.com

{\it Буре Владимир Мансурович}~--- доктор технических наук,
профессор; vlb310154@gmail.com



\vskip 2.0mm

\textit{Staroverova Kseniya Yurievna}~--- student;
ksenygnirps@gmail.com

\textit{Bure Vladimir Mansurovich}~--- doctor of technical
sciences, professor; vlb310154@gmail.com

{\copyright} Санкт-Петербургский государственный университет,
\issueyear%\\
%$^{*}$ Работа выполнена при финансовой поддержке
%Санкт-Петербургского государственного университета (грант
%№~9.38.673.2013).
}

\vskip3mm

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
%\fancyfoot[LO]{{\footnotesize\emph{\doivyp09 } }\hfill\thepage}%
\fancyfoot[LO]{{\footnotesize\rm{\doivyp/spbu10.\issueyear.\issuenum05 } }\hfill\thepage}%
%\fancyfoot[RE]{\thepage\hfill{\footnotesize\emph{\doivyp09 } } }%
\fancyfoot[RE]{\thepage\hfill{\footnotesize\rm{\doivyp/spbu10.\issueyear.\issuenum05}}}%
%\fancyfoot[LO]{\hfill{\fontsize{10.5}{10.5}\selectfont \thepage}}%
%\fancyfoot[RE]{{\fontsize{10.5}{10.5}\selectfont \thepage}\hfill}%
%\lhead{} %верхний колонтитул слева
%%\rhead{} % верхний колонтитул справа
% для оформления нижнего колонтитула
\cfoot{} %
%\lfoot{} %
%\rfoot{\thepage} %



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{\footnotesize

\noindentСанкт-Петербургский государственный университет,
Российская Федерация, \\ 199034, Санкт-Петербург, Университетская
наб., 7--9



\vskip3mm

\begin{list}{}{\leftmargin=7mm \rightmargin=7mm \listparindent=5mm}

\item Кластеризация временных рядов~--- актуальная задача
современного анализа данных. Она требует разработки мер различия,
учитывающих зависимость объектов от времени. В~этой области уже
была проделана большая работа, многие методы для нахождения
расстояния между временными рядами основаны на сокращении
размерности. Однако слабым местом на данный момент остается
кластеризация коротких временных рядов, которые широко
используются в~таких областях как экономика, социология,
демография и~др. Поэтому предлагается новый метод, который строит
матрицу расстояний только по характеристикам ряда. В~статье
описаны современные меры различия временных рядов; предложенная
нами мера различия, основанная на характеристиках, и~показаны
результаты экспериментов применения этого метода на двух наборах
искусственных данных в~сравнении с~другими методами. Библиогр.
12~назв. Ил.~2. Табл.~1.

{\it Ключевые слова}: кластеризация, мера различия временных
рядов, классификация.

\end{list}

}

%\newpage
\vskip2.0mm

\begin{list}{}{\leftmargin=7mm \rightmargin=7mm \listparindent=5mm}

\noindent{\it  K.~Yu.~Staroverova, V.~M.~Bure}

\vskip2mm\noindent{\bf CHARACTERISTICS BASED DISSIMILARITY
MEASURE\\ FOR TIME SERIES}

\vskip1.5mm



{\footnotesize

\noindent St.~Petersburg State University, 7--9, Universitetskaya
nab.,\\ St.~Petersburg, 199034, Russian Federation

\vskip2mm


\item It is necessary to invent dissimilarity measures which take
into account the temporal nature of a time series. Such measures can
be utilized for classification and clustering of time series. Great
work has been conducted on this problem, but most measures use dimensionality
reduction techniques. Such methods give accurate results for big data, but
demonstrate a weakness now in short time series clustering. Many fields
such as economics, demography, sociology, and others are presented by short
time series. That is why a new method based on time series characteristics
is introduced here. It is based on time series characteristics which are
split into three groups: constant, dynamic and behavioural. A researcher
can control the influence of the characteristics of each group as a result.
Besides, we present a brief description of up-to-date dissimilarity measures
from the R environment. The results of experiments on two synthetic data sets
and comparison of our measure and other up-to-date methods are then presented.
Refs~12. Figs~2. Table~1.

\textit{Keywords}: clustering, time series similarity measure,
classification.


}

\end{list}

\vskip 2.5mm



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section*{Введение.}
В современном мире для решения многих задач используются методы
машинного обучения. К~таким задачам относятся кластеризация
и~классификация данных. Большую роль при проведении кластеризации
и классификации объектов играет выбор меры сходства или различия
объектов для построения матрицы расстояний, так как неточно
подобранная мера повлечет за собой неточные результаты решения
задачи. Несмотря на то, что область анализа данных и~машинного
обучения развивается довольно стремительно, мы столкнулись
с~трудностью при исследовании неоднородности показателя
заболеваемости в~Санкт-Петерурге за последние 16 лет. Основная
проблема состояла в~подборе меры различия временных рядов, которую
можно было бы использовать для кластеризации районов
Санкт-Петербурга. Особенность, которую нужно учитывать при выборе
меры различия временных рядов, состоит в~том, что данные зависят
от времени. Иногда постановка задачи позволяет эту особенность
игнорировать и~рассматривать временной ряд как вектор, однако чаще
требуется сформировать группы, внутри которых объекты будут
схожими именно в~динамике.

В области кластеризации временных рядов была проделана большая
работа: описано применение алгоритма динамической трансформации
шкалы в~кластерном анализе [1,\:2]; этот же алгоритм, но с~помощью
теории скрытых марковских моделей предложен в~[3]; использование
коэффициентов автокорреляции, спектральных характеристик,
вейвлет-коэффициентов отмечено в~работах [4,\:5], более полный
обзор существующих методов представлен в~статье [6].

Существующие меры различия дают хорошие результаты при работе
с~длинными рядами и~зачастую даже применяют различные приемы по
сокращению размерности, но при кластеризации коротких временных
рядов такие меры могут давать недостаточно точные оценки близости
объектов, что приводит к~увеличению количества ошибок
кластеризации. Нами предложена мера различия временных рядов~---
<<мера различия, основанная на характеристиках>> (МРОХ), или
``characteristics based dissimilarity measure'' (CBDM), которая
учитывает различие между статистическими характеристиками объектов
кластеризации или классификации. Эксперименты на искусственных
наборах данных показали, что выбор МРОХ для кластеризации
временных рядов оправдан, так как количество ошибок кластеризации
оказалось меньше, чем при использовании многих других наиболее
известных мер различия, время работы алгоритма оказалось также
меньше. Построение матрицы МРОХ-расстояний реализовано на языке R,
в этом же пакете проведен сравнительный анализ данного метода
с~другими с~помощью библиотек ``cluster'' и~``TSclust''.

\section*{Обзор методов     библиотеки ``TSclust'' пакета R.} Библиотека представляет широкий выбор мер различия для кластерного анализа временных рядов и~несколько наборов искусственных и~реальных данных [7], поэтому она выбрана для проведения экспериментов и~сравнительного анализа существующих мер с~МРОХ. Построение матрицы расстояний производится при помощи функции $diss(SERIES, METHOD, \dots)$, где $SERIES$~--- это матрица, список или датафрейм с~набором временных рядов, а $METHOD$~--- строка с~названием меры различия.

Существует условное разделение методов на 3 группы.%\\

\emph{\textbf{Свободные от предположений о модели}} методы строят
расстояние непосредственно между наблюдениями двух рядов или
некоторыми их характеристиками.
\begin{enumerate}\begin{enumerate}
\itemsep0em
\item[] {\it EUCL}: евклидово расстояние, широко применяется при кластеризации, но не всегда может быть использовано, если объектом является временной ряд, в~силу того, что зависимость наблюдений от времени игнорируется.
\item [1.] {\it ACF}: расстояние между коэффициентами автокорреляции рядов.
\item [2.] {\it PACF}: расстояние между частичными коэффициентами автокоррелиции рядов.
\item [3.] {\it COR}: вычисляет корреляцию Пирсона между наблюдениями объектов.
\item [4.] {\it CORT}: мера, учитывающая различие между наблюдениями, которое может быть представлено любым традиционным методом (расстояние Евклида, Минковского, Фреше, Манхеттенское), и~разное поведение рядов.
\item [5.] {\it FRECHET}: расстояние Фреше, учитывает зависимость данных от времени, однако не принимает во внимание поведение временных рядов или характер их изменчивости.
\item [6.] {\it DTWARP}: алгоритм динамической трансформации шкалы, широко приме\-няется при классификации и~кластеризации речи, так как инвариантен относительно масштабирования и~сдвига по временной оси, имеет тот же недостаток, что и~предыдущий метод, кроме того, использование этого метода на любых данных неоправдано, так как иногда реальные различия в~поведении могут быть не учтены или значительно уменьшены после преобразований временной оси.
\item [7.] {\it PER}: расстояние между периодограммами.
\item [8.] {\it INT.PER}: перед вычислением расстояния имеет преимущества интегрирование периодограмм. Это расстояние может быть нормировано, в~таком случае большую роль играет форма кривой временного ряда.
\item [9.] {\it SPEC.GLK}: различие между двумя рядами оценивается в~терминах значения статистики равенства логарифма спектров, для проверки гипотезы исполь\-зует\-ся обобщенный критерий отношения правдоподобия [8].
\item [10.] {\it SPEC.ISD}: вычисляется как интеграл от квадратов разностей между непараметрическими оценками логарифма спектра.
\item [11.] {\it SPEC.LLR}: представлено отношением локальных линейных спектральных оценок.
\end{enumerate}\end{enumerate}
%\mbox{}%

\emph{\textbf{Методы, основанные на предположениях о модели}}, строятся на приближении временных рядов моделями ARIMA. % (?) не нравится мне эта формулировка
\begin{enumerate}\begin{enumerate}
\itemsep0em
\item [1.] {\it AR.MAH}\:: строится статистика, отражающая значимость различий процесов, для этого используются коэффициенты авторегрессии, дисперсия белого шума, матрицы ковариаций рядов. Статистика распределена как $\chi^2$, нулевая гипотеза говорит о абсолютном сходстве процессов.
\item [2.] {\it AR.LPC.CEPS}\:: расстояние между ЛПК-кепстральными коэффициентами, т.\:е. кепстральными коэффициентами сигнала, которые вычисляются через коэффициенты авторегрессии.
\item [3.] {\it AR.PIC}\:: так как считается, что любой стационарный процесс можно аппроксимировать моделью $\textrm{AR}(\infty)$, этот метод находит евклидово расстояние между коэффициентами модели, подобранной по критериям AIC или BIC.
\end{enumerate}\end{enumerate}
%\mbox{}%

\emph{\textbf{Методы, основанные на оценке сложности временного ряда,}} отли\-чают\-ся от предыдущих тем, что они не учитывают временные %хорошо бы поставить ударение
характеристики и~особенности процессов, не выдвигают предположения
о модели, которой можно аппроксимировать процесс, зато оценивают
уровень информации, содержащейся в~каждом временном ряде.

\begin{enumerate}\begin{enumerate}
\itemsep0em
\item [1.] {\it CDM}: мера, основанная на различии физического размера сжатых временных рядов. Допускается выбор одного из трех алгоритмов сжатия: ``gzip'', ``bzip2'',\linebreak\newpage\noindent ``xz''. Возможно использование символьного представления процесса, например SAX-методов.
\item [2.] {\it NCD}: отличается от предыдущего метода только формулой вычисления расстояния, авторы [9] называют данное расстояние <<нормализованным>>.
\item [3.] {\it CID}: скорректированное евклидово расстояние. Корректировка происходит путем домножения на коэффициент, определяющий отношение сложностей двух рядов.
\item [4.] {\it MINDIST.SAX}: сначала происходит нормализация временного ряда, потом сокращение размерности алгоритмом PAA (кусочно-агрегирующая аппроксимация), после~--- преобразование алгоритмом SAX в~символьный ряд и~вычисление расстояния путем нахождения минимума.
\item [5.] {\it PDC}: сначала выполняется перестановка наблюдений в~восходящем порядке, после чего строится код, отражающий распределение упорядоченных наблюдений на первоначальном ряде, этот код используется для оценки сложности процесса. Расстояние между двумя рядами вычисляется как различие между построенными кодами.
\end{enumerate}\end{enumerate}

Важно отметить, что каждый метод обладает своей спецификой.
Во-первых, выбор одной из трех групп должен быть не случайным
и~соответствовать целям исследования, во-вторых, выбор меры также
должен быть обусловлен спецификой задачи. Например, если
необходимо производить кластеризацию длинных рядов ежесекундно,
при этом визуализировать данные, а точностью можно пренебречь, то
стоит отдать предпочтение более простым методам, таким как
вычисление евклидова расстояния или коэффициентов корреляции
Пирсона, и~наоборот, если проводится исследование, в~котором важна
точность результатов, то выбирать нужно более сложные методы,
например динамическое преобразование шкалы, методы, основанные на
спектре процесса, преобразованиях вейвлетами.

\section*{Описание метода МРОХ.} Создание этого метода началось с~формулировки недостатка существующих методов: многие из них не предназначены
для работы с~короткими рядами. Вопрос кластеризации временных
рядов малой размерности яв\-ляет\-ся актуальным, так как
статистика по многим экономическим, социальным, демографическим
и~другим показателям собирается нечасто~--- один раз в~год,
квартал или месяц и~доступна за небольшие периоды в~несколько лет.
Именно поэтому перед нами \mbox{стоял} вопрос: каким образом можно
представить информацию о временном ряде, кроме уже существующих
способов, так, чтобы она являлась достаточно точным описанием
и~для коротких временных рядов.

Метод основан на вычислении характеристик временного ряда, которые
делятся на три группы: не зависящие от времени, описывающие
динамику и~определяющие изменчивость. Для каждой рассчитывается
величина, отражающая различие временных рядов по характеристикам
из конкретной группы, а затем строится линейная их комбинация.

Перед вычислением характеристик, {\it не зависящих от времени},
преобразуем временные ряды, сохраняя различие между объектами
в~плоскости, но отображая значения наблюдений в~отрезок $[0, 1]$,
т.~е., если $M = [n \times m]$~--- это матрица $n$ временных рядов
длиной $m$, тогда преобразование определяется формулой
\begin{equation*}
\overline{ M }= \frac{M - \min{M}}{M - \max{M}}.
\end{equation*}
После этого по матрице $\overline{ M }$ для каждого временного
ряда (строки) вычисляем\linebreak\newpage\noindent матрицу
характеристик $C = [n \times 5]$: столбцы $C_{*,1}$~--- средних
значений каждого ряда, $C_{*,2}$~--- стандартных отклонений,
$C_{*,3}$~--- медиан, $C_{*,4}$~--- минимумов, $C_{*,5}$~---
максимумов. Здесь не учитывается зависимость данных от времени.

Для вычисления {\it различий в~динамике} для каждого временного
ряда строим четыре вектора, характеризующих его поведение. Перед
этим выполним преобразование матрицы $M$, но в~этот раз таким
образом, чтобы максимальному значению каждого ряда соответствовала
1, а минимальному~--- 0:
\begin{equation} \label{eq: 1_Normalization}
\widetilde{M}_{k,*} = \frac{M_{k,*} -
\min{M_{k,*}}}{\max{M_{k,*}}-\min{M_{k,*}}},
\end{equation}
где $M_{k,*}$ означает строку матрицы $M$ с~номером $k$. Определим
первые разности ряда с~лагом $l$
\begin{equation} \label{eq: 2_FD}
\widetilde{FD}_{k,t}(l) = \widetilde{M}_{k,t+l} -
\widetilde{M}_{k,t},
\end{equation}
где $k = \overline{1, n};\ t = \overline{1, m - l}$. Для описания
динамики временного ряда будем использовать первые разности
с~лагом 1
\begin{equation*}
\widetilde{FD}_{k,t}=\widetilde{FD}_{k,t}(1).
\end{equation*}
Нормализация (\ref{eq: 1_Normalization}) позволяет не обращать
внимание на разбросанность наблюдений в~пространстве и~исследовать
только поведение ряда. Построим первую матрицу, каждая строка
которой отражает динамику процесса, а именно, показывает участки
неубывания
\[
    D_{k,t}^1 =
    \begin{cases}
    1, ~ \textrm{если } \widetilde{FD}_{k,t} \geq 0, \\
    0, ~\textrm{иначе},
    \end{cases}
\]
где $k = \overline{1, n};\ t = \overline{1, m-1}$. Вторая матрица
показывает, как временной ряд флуктуирует около среднего значения:
\[
    D_{k,t}^2 =
    \begin{cases}
    1, ~ \textrm{если } \widetilde{M}_{k,t} \geq \textrm{E}(\widetilde{M}_{k,*}), \\
    0,~ \textrm{иначе},
    \end{cases}
\]
где $k = \overline{1, n};\ t = \overline{1, m}$. Третья
и~четвертая матрицы показывают б\'{о}льшие отклонения от среднего
значения, чем стандартное отклонение:
\[
    D_{k,t}^3 =
    \begin{cases}
    1,~  \textrm{если } \widetilde{M}_{k,t} \geq \textrm{E}(\widetilde{M}_{k,*}) + \textrm{Var}(\widetilde{M}_{k,*}), \\
    0,~ \textrm{иначе},
    \end{cases}
\]
\[
D_{k,t}^4 =
    \begin{cases}
    1,~ \textrm{если } \widetilde{M}_{k,t} \leq \textrm{E}(\widetilde{M}_{k,*}) - \textrm{Var}(\widetilde{M}_{k,*}), \\
    0,~ \textrm{иначе},
    \end{cases}
\]
где $k = \overline{1, n};\ t = \overline{1, m}$;
$\textrm{E}(\widetilde{M}_{k,*})$~--- среднее значение временного
ряда $k$; $\textrm{Var}(\widetilde{M}_{k,*})$~--- его дисперсия.

Характеристики, отвечающие за {\it изменчивость}, включают в~себя
15 величин, которые вычисляются для первых разностей ряда с~лагом
1 и~2, их можно представить в~виде матрицы $V = [n \times 15]$.
Определим среднюю скорость роста $V_{*,1}$, спада $V_{*,2}$
и~изменения ряда $V_{*,3}$. Пуcть $l = 1$, если количество
участков возрастания и~убывания ряда\newpage

\begin{equation} \label{eq:1_Variability}
m_k^{g}(l) = \sum_{t=1}^{m-l} \textrm{I}\{\widetilde{FD}_{k,t}(l)
> 0\},
\end{equation}
\begin{equation}
m_k^{d}(l) = \sum_{t=1}^{m-l} \textrm{I}\{\widetilde{FD}_{k,t}(l)
< 0\},
\end{equation}
где $I$~--- это индикатор (принимает значение 1, когда верно
выражение в~скобках, иначе~--- 0), тогда компоненты столбцов
$V_{*,1},\ V_{*,2},\ V_{*,3}$ задаются как
\begin{equation}
V_{k,1}(l) = \frac{1}{m_k^g(l)} \sum_{t=1}^{m-l}
\widetilde{FD}_{k,t}(l)\:\textrm{I}\{\widetilde{FD}_{k,t}(l) >
0\},
\end{equation}
\begin{equation}
V_{k,2}(l) = \frac{1}{m_k^d(l)} \sum_{t=1}^{m-l}
\widetilde{FD}_{k,t}(l)\:\textrm{I}\{\widetilde{FD}_{k,t}(l) <
0\},
\end{equation}
\begin{equation} \label{eq:5_Variability}
V_{k,3} = \textrm{E}(\widetilde{FD}_{k,*}(l)),
\end{equation}
где $k = \overline{1, n}$. Вычислим первые разности с~лагом $l =
2$ по формуле (\ref{eq: 2_FD}), тогда компоненты столбцов
$V_{*,4},\ V_{*,5},\ V_{*,6}$ можно вычислить для
$\widetilde{FD}_{k,t}(2)$ по формулам
(\ref{eq:1_Variability})--(\ref{eq:5_Variability}).

Следующие характеристики показывают величину наибольшего роста
и~наибольшего спада, процесс их вычисления приведен в~виде
алгоритма:

\bigskip
\noindent \rule{\textwidth}{0.3pt}
{\it Вход:} $FD$~--- матрица первых разностей, где строка с~номером $k$ соответствует первой разности временного ряда $k$; \\
{\it Выход:} для каждого ряда с~номером $k$ пара значений $\{Grouth[\:k\:], Decline[\:k\:]\}$; \\

\noindent
$n$ $\leftarrow$ количество строк $FD$\\
$m$ $\leftarrow$ количество столбцов $FD$ \\
{\bf Для} $i$ {\bf от} 1 {\bf до} $n$ \\
\hspace*{0.5cm} $Grouth[\:i\:]$ $\leftarrow$ 0 \\
\hspace*{0.5cm} $Decline[\:i\:]$ $\leftarrow$ 0 \\
\hspace*{0.5cm} $Sum$ $\leftarrow$ $FD[\:i,\:1\:]$ \\
\hspace*{0.5cm} {\bf Для} $j$ {\bf от} 2 {\bf до} $m$ \\
\hspace*{1cm} {\bf Если} $(FD[\:i,\:j\:] \cdot FD[\:i-1,\:j\:]) < 0$ {\bf И} $Sum > Grouth[\:i\:]$\\
\hspace*{1.5cm} {\bf То} $Grouth[\:i\:] \leftarrow Sum$ \\
\hspace*{2.1cm} $Sum \leftarrow FD[\:i,\:j\:]$ \\
\hspace*{1cm} {\bf Если} $(FD[\:i,\:j\:] \cdot FD[\:i-1,\:j\:]) < 0$ {\bf И} $Sum < Decline[\:i\:]$\\
\hspace*{1.5cm} {\bf То} $Decline[\:i\:] \leftarrow Sum$ \\
\hspace*{2.1cm} $Sum \leftarrow FD[\:i,\:j\:]$\\
\hspace*{1cm} {\bf Если} $(FD[\:i,\:j\:] \cdot FD[\:i-1,\:j\:]) > 0$ \\
\hspace*{1.5cm} {\bf То} $Sum[\:i\:] \leftarrow Sum + FD[\:i,\:j\:]$ \\
\noindent \rule{\textwidth}{0.3pt}

\bigskip
Столбцы $V_{*,7},\ V_{*,8}$ рассчитываются по описанному выше
алгоритму для первых разностей ряда с~лагом 1, а столбцы
$V_{*,9},\ V_{*,10}$~--- для первых разностей ряда с~лагом
2.\linebreak\newpage\noindent Последние 5 столбцов матрицы $V$
соответствуют минимальному значению, квартилям и~максимальному
значению первых разностей с~лагом 1.

Перед тем как определить расстояние между временными рядами,
введем функцию, которая оценивает расстояние между
характеристиками динамики. Пусть $M_{k}$~--- это строка матрицы
$M$ с~номером $k$, т.\:е. временной ряд, тогда
\begin{equation*}
\textrm{DIST}_{Dyn}(M_{k_1}, M_{k_2}) =
\frac{1}{4}\left(\frac{1}{m-1} \sum_{t=1}^{m-1} D^i_{k_1,t}\oplus
D^i_{k_2,t} + \sum_{i=2}^4 \frac{1}{m} \sum_{t=1}^m
D^i_{k_1,t}\oplus D^i_{k_2,t}\right),
\end{equation*}
где $D^i_{k_1,t}\oplus D^i_{k_2,t}$~--- покомпонентное сложение по
модулю 2. Расстояние между временными рядами складывается из трех
величин: различие между характеристиками, не зависящими от
времени, динамики и~изменчивости:
\begin{equation} \label{eq: Dist}
\begin{aligned}
\textrm{DIST}_{CBM}(M_{k_1}, M_{k_2}) & = {}  \alpha\: \sqrt{\sum_{i = 1}^5(C_{k_1,i} - C_{k_2,i})^2} + \beta\: \textrm{DIST}_{Dyn}(M_{k_1}, M_{k_2})~ + \\
& + (1-\alpha-\beta)\: \sqrt{\sum_{i = 1}^{15}(V_{k_1,i} -
V_{k_2,i})^2}.
\end{aligned}
\end{equation}
Влияние каждой величины регулируется с~помощью коэффициентов
$\alpha$ и~$\beta$, причем $(\alpha + \beta) \in [0, 1]$.
Расстояние, введенное в~формуле (\ref{eq: Dist}), является
метрикой.

\section*{Эксперимент.} Идея использовать характеристики временных
рядов для проведения кластеризации уже была описана в~[10], однако
удовлетворительных результатов получено не было. Нами проведен
эксперимент на том же наборе искусственных данных, который
содержит 600 временных рядов, сгенерированных по следующим моделям
$y(t),~ t = \overline{1, 60}$:



\begin{enumerate}\begin{enumerate}%[label=\arabic*), leftmargin=0pt, itemindent=3em]
\itemsep0em
\item [1)] нормальная модель: $y(t) = m + rs,$ где $m = 30, s = 2, r \in [-3, 3];$
\item [2)] циклическая модель: $y(t) = m + rs + a\sin{\frac{2\pi t}{T}},$ где $a, T \in [10, 15];$
\item [3)] модель с~восходящим трендом:  $y(t) = m + rs + gt,$ где $g \in [0.2, 0.5];$
\item [4)] модель с~нисходящим трендом:  $y(t) = m + rs - gt,$ где $g \in [0.2, 0.5];$
\item [5)] модель со сдвигом вверх:  $y(t) = m + rs + kx,$ где $x \in [7.5, 20], k = 0$ до момента $\hat{t}$ и~$k = 1$ после этого момента, $\hat{t} \in [20, 40];$
\item [6)] модель со сдвигом вниз:  $y(t) = m + rs - kx,$ где $x \in [7.5, 20], k = 0$ до момента $\hat{t}$ и~$k = 1$ после этого момента, $\hat{t} \in [20, 40].$
\end{enumerate}\end{enumerate}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%fig 1

%\captionsetup[subfigure]{labelfont=it}
%\captionsetup[figure]{labelfont=it}
%
%
%
%\begin{figure}[!ht]
%  \centering
%  \begin{tabular}[c]{cc}
%
%    \begin{subfigure}[b]{0.45\textwidth}
%      \caption{\it Нормальная модель}
%    \caption{а}
%      \includegraphics[width=\textwidth]{Figure1a}
%      \label{fig:F1a}
%    \end{subfigure}&
%
%    \begin{subfigure}[b]{0.45\textwidth}
%      \caption{\it Циклическая модель}
%    \caption{б}
%      \includegraphics[width=\textwidth]{Figure1b}
%      \label{fig:F1b}
%    \end{subfigure} \\
%
%    \begin{subfigure}[b]{0.45\textwidth}
%      \caption{\it Модель с~восходящим трендом}
%    \caption{в}
%     \includegraphics[width=\textwidth]{Figure1c}
%      \label{fig:F1c}
%    \end{subfigure}&
%
%    \begin{subfigure}[b]{0.45\textwidth}
%      \caption{\it Модель с~нисходящим трендом}
%    \caption{г}
%      \includegraphics[width=\textwidth]{Figure1d}
%      \label{fig:F1d}
%    \end{subfigure} \\
%
%    \begin{subfigure}[b]{0.45\textwidth}
%      \caption{\it Модель со сдвигом вверх}
%    \caption{д}
%     \includegraphics[width=\textwidth]{Figure1e}
%      \label{fig:F1e}
%    \end{subfigure}&
%
%    \begin{subfigure}[b]{0.45\textwidth}
%      \caption{\it Модель со сдвигом вниз}
%    \caption{е}
%      \includegraphics[width=\textwidth]{Figure1f}
%      \label{fig:F1f}
%    \end{subfigure}
%  \end{tabular}
%  \caption{Пример реализаций разных моделей. \\
%  По оси абсцисс~--- время, по оси ординат~--- значение временного ряда.\\
%  Модели: {\it а}~--- нормальная,  {\it б}~--- циклическая,  {\it в}~--- с~восходящим трендом,\\  {\it г}~--- с~нисходящим трендом,  {\it д}~--- со сдвигом вверх,  {\it е}~--- со сдвигом вниз.}
%\end{figure}



\begin{figure}[h!]
\centering
\includegraphics[scale=1]{05/fig1}
\vspace{3mm} \caption{Пример реализаций разных моделей }%\label{метка}
\vspace{0.5mm} \centering \footnotesize{По оси абсцисс~--- время,
по оси ординат~--- значение временного ряда. \\ \vspace{0.5mm}
Модели: {\it а}~--- нормальная,  {\it б}~--- циклическая,  {\it
в}~--- с~восходящим трендом,\\ \vspace{0.5mm} {\it г}~---
с~нисходящим трендом, {\it д}~--- со сдвигом вверх,  {\it е}~---
со сдвигом вниз.}
\end{figure}




Примеры временных рядов каждой модели представлены на рис.\:1,
{\it а---е}. Сравнивать метод МРОХ с~другими расстояниями можно по
проценту правильно кластеризованных объектов $P$. В~[10] этот
показатель составил $47.3\%$. При кластеризации методом МРОХ
с~коэффициентами $\alpha = 0.55,~\beta = 0.1$ эффективность
кластеризации $P=85.2\%.$ На рис.\:2,\:{\it а} показано, как
должны быть распределены объекты по кластерам, а на рис.\:2,\:{\it
б}~--- результаты, полученные рассматриваемым методом.






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%fig 2




%\captionsetup[subfigure]{labelfont=it}
%\begin{figure}[!ht]
%  \centering
%  \begin{tabular}[c]{cc}
%
%    \begin{subfigure}[b]{0.45\textwidth}
%    %  \caption{\it Теоретическая кластеризация}
%    \caption{а}
%      \includegraphics[width=\textwidth]{Figure2a}
%      \label{fig:F2a}
%    \end{subfigure}&
%
%    \begin{subfigure}[b]{0.45\textwidth}
%   %   \caption{\it Кластеризация методом МРОХ}
%       \caption{б}
%      \includegraphics[width=\textwidth]{Figure2b}
%      \label{fig:F2b}
%    \end{subfigure} \\
%
%    \multicolumn{2}{c}{
%     \begin{subfigure}[b]{0.45\textwidth}
%   %   \caption{\it Кластеризация методом ДТШ}
%       \caption{в}
%      \includegraphics[width=\textwidth]{Figure2c}
%      \label{fig:F2c}
%    \end{subfigure}}
%
%  \end{tabular}
%  \caption{ Распределение объектов по кластерам. \\
%  По оси абсцисс~--- номер объекта, по оси ординат~--- номер кластера.\\
%  Кластеризация: {\it а}~--- теоретическая,  {\it б}~--- методом МРОХ,  {\it в}~--- методом ДТШ.}
%  \label{fig:F1}
%\end{figure}


\begin{figure}[h!]
\centering
\includegraphics[scale=1]{05/fig2}
\vspace{2mm} \caption{Распределение объектов по кластерам
}%\label{fig:F1}
\vspace{0.5mm} \centering \footnotesize{По оси абсцисс~--- номер объекта, по оси ординат~--- номер кластера. \\
\vskip 0.5mm Кластеризация: {\it а}~--- теоретическая,  {\it
б}~--- методом МРОХ,  {\it в}~--- методом ДТШ.}
\end{figure}





Сравнение МРОХ с~методами пакета ``TSclust'' показало, что для
этого набора данных предлагаемый нами метод дает лучшие
результаты. Для большей части методов $P < 60\%$ и~только для
алгоритма динамической трансформации шкалы (ДТШ) $P = 84.7\%$,
однако время построения матрицы расстояний методом МРОХ составляет
16.04 с, а для ДТШ~--- 445.68 с. Распределение объектов по
кластерам показано на  рис.\:2,\:{\it в}.






Также можно сравнить индекс оценки силуэта кластеров, который
часто применяется для оценки качества кластеризации и~в~нашем
случае может говорить о некоторой устойчивости, так как высокий
индекс оценки силуэта свидетельствует о том, что расстояние между
объектами внутри кластера мало, а между элементами соседних
кластеров~--- велико [11]. Индекс оценки силуэта может изменяться
от 0 до 1, чем ближе значение к~1, тем лучше произведена
кластеризация. Как следует из таблицы, в~среднем индекс выше при
кластеризации методом МРОХ.

%\begin{table}
%\centering \caption*{\bf  Индекс оценки силуэтов для кластеризаций
%\\ методами МРОХ и~ДТШ } \label{table:1}


\vskip 3mm
\begin{center}
{\small

{\bf Индекс оценки силуэтов для кластеризаций\\
методами МРОХ и~ДТШ }

}

\vskip 4mm

{\footnotesize


\begin{tabular}{ |c|c|c|c|c|c|c| }
 \hline
 Метод & Кластер 1 & Кластер 2 & Кластер 3 & Кластер 4 & Кластер 5 & Кластер 6 \\
 \hline
 МРОХ & 0.39 & 0.56 & 0.13 & 0.42 & 0.50 & 0.13 \\
 \hline
 ДТШ & 0.58 & 0.22 & 0.14 & 0.12 & 0.28 & 0.25 \\
 \hline
\end{tabular}


}
\end{center}
\vskip 2mm





Второй эксперимент был проведен с~искусственными данными
библиотеки ``TSclust''. Набор содержит по 3 реализации длиной 200
каждой из таких моделей:
\begin{enumerate}\begin{enumerate}%[label=\arabic*), leftmargin=0pt, itemindent=3em]
\itemsep0em
\item [1)] $X_t = 0.6 X_{t-1} + \epsilon_t$;
\item [2)] $X_t = (0.3 - 0.2 \epsilon_{t-1}) X_{t-1} + 1 + \epsilon_t$;
\item [3)] $X_t = (0.9 \exp(-X^2_{t-1})-0.6)X_{t-1}+1+\epsilon_t$;
\item [4)] $X_t = (0.3 X_{t-1} +1) I(X_{t-1} \geq 0.2) - (0.3 X_{t-1}-1) I(X_{t-1}<0.2) + \epsilon_t$;
\item [5)] $X_t = 0.7 |X_{t-1}| (2+|X_{t-1}|)^{-1} + \epsilon_t$;
\item [6)] $X_t = 0.8 X_{t-1} - 0.8 X_{t-1} (1+\exp(-10 X_{t-1}))^{-1} +
\epsilon_t$.
\end{enumerate}\end{enumerate}
Эксперименты на этих данных уже проводились в~[12], наилучшие
результаты показали методы ``INT.PER'' $P = 88.9\%$ и~``SPEC.LLR''
$P = 83.3\%$. Примененный нами метод показывает результаты немного
хуже, чем предыдущие два, однако лучше, чем остальные: $P =
82.8\%$ при $\alpha = 0.3,\ \beta = 0.3.$\newpage

\section*{Заключение.}
Метод, основанный на вычислении характеристик, показал неплохие
результаты при проведении экспериментов, что позволяет
использовать его в~задачах кластерного анализа временных рядов.
Преимуществами являются простота и~скорость работы алгоритма.
Стоит также отметить, что данный метод учитывает и~динамику
временного ряда и~характер изменчивости, при этом предложенная
мера различия является метрикой. Сейчас недостаток алгоритма
заключается в~подборе параметров $\alpha$ и~$\beta$, поэтому
естественным развитием становится разработка критериев по выбору
этих коэффициентов. Однако постановка некоторых задач позволяет
понять, какие характеристики оказываются более важными для
кластеризации, в таком случае трудности с~подбором коэффициентов
не возникают.




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input{05/lit-ra}

%%%%%N DOI в~ссылке!!!!!!!!!!

\input{05/ref-s}

%%%%%N DOI в~ссылке!!!!!!!!!!

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


{\footnotesize



\vskip 3mm

%\thispagestyle{empty}



\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
\fancyfoot[LO]{\footnotesize{\rm{Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~13.~Вып.~\issuenum}}
\hfill}%
\fancyfoot[RE]{\hfill\footnotesize{\rm{Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~13.~Вып.~\issuenum}}}%
%\lhead{} %верхний колонтитул слева
%%\rhead{} % верхний колонтитул справа
% для оформления нижнего колонтитула
\cfoot{} %
%\lfoot{} %
%\rfoot{\thepage} %


\noindent Статья рекомендована к~печати проф. Л. А. Петросяном.

\vskip 1mm

\noindent Статья поступила в~редакцию 3 ноября 2016~г.

\vskip 1mm

\noindent Статья принята к~печати 19 января 2017~г.


}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\vskip 5mm

%{\footnotesize

%\noindent К\,о\,н\,т\,а\,к\,т\,н\,а\,я\,
%и\,н\,ф\,о\,р\,м\,а\,ц\,и\,я \nopagebreak \vskip 3mm

%{\it Балонин Николай Алексеевич}~-- доктор технических наук,
%профессор; e-mail: korbendfs@mail.ru

%{\it Сергеев Михаил Борисович}~-- доктор технических наук,
%профессор,  директор; e-mail: mbse@mail.ru

%\vskip 2mm

%\emph{Balonin Nikolaj Alekseevich}~-- doctor of technical
%sciences, professor; e-mail: korbendfs@mail.ru


%\emph{Sergeev Mikhail Borisovich}~-- doctor of technical sciences,
%director; e-mail: mbse@mail.ru


%}


%\thispagestyle{empty}
