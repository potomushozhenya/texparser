
\noindent{\small УДК 519.62/.642  \hfill {\footnotesize Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~15.~Вып.~\issuenum}\\
MSC 65L03, 65L06

}

\vskip2mm

\noindent{\bf Комбинированный функционально-непрерывный метод \\ для
дифференциальных уравнений с~запаздыванием%$^{*}$%
 }

\vskip2.5mm

\noindent{\it А.~С.~Еремин%$\,^1$%
%, И.~О. Фамилия%$\,^2$%

}

\efootnote{
%%
%\vspace{-3mm}\parindent=7mm
%%
%\vskip 0.1mm $^{*}$ Работа выполнена при
%финансовой поддержке Российского научного фонда (проект №
%?). (The work was jointly supported by a grant
%from the Russian Science Foundation (Project N ?))\par
%%
%%\vskip 2.0mm
%%
\indent{\copyright} Санкт-Петербургский государственный
университет, \issueyear%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
\fancyfoot[LO]{{\footnotesize\rm{\doivyp/spbu10.\issueyear.\issuenum02 } }\hfill\thepage}%
\fancyfoot[RE]{\thepage\hfill{\footnotesize\rm{\doivyp/spbu10.\issueyear.\issuenum02}}}%
% для оформления нижнего колонтитула
\cfoot{} %

\vskip2mm

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{\footnotesize

\noindent%
%$^1$~%
Санкт-Петербургский государственный университет, Российская
Федерация,

\noindent%
%\hskip2.45mm%
199034, Санкт-Петербург, Университетская~наб., 7--9

}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\vskip3mm

{\small \noindent \textbf{Для цитирования:} \textit{Еремин~А.~С.}
Комбинированный функ\-ци\-о\-наль\-но-не\-пре\-рыв\-ный метод для
дифференциальных уравнений с~запаздыванием~// Вестник
Санкт-Петербургского университета. Прикладная математика.
Информатика. Процессы управления. \issueyear. Т.~15.
Вып.~\issuenum.
С.~\pageref{p2}--\pageref{p2e}. %\\
\doivyp/\enskip%
\!\!\!spbu10.\issueyear.\issuenum02

\vskip3mm

{\leftskip=7mm\noindentВ работе предлагается комбинированный метод
решения дифференциальных уравнений с~дискретным запаздывающим
аргументом, представляющий собой вложенную пару: непрерывный
шестиэтапный и~функционально-непрерывный (этапно-непрерывный)
семиэтапный методы Рун\-ге---Кут\-ты четвертого порядка, которые
совместно позволяют организовать эффективное решение
дифференциальных уравнений с~дискретными за\-паз\-ды\-ва\-ния\-ми
(ДУЗА). Комбинированный метод остается полностью явным для любых
значений запаздываний. Выбор между шести- и~семиэтапным методами
происходит автоматически в~зависимости от попадания запаздывания
в~текущий шаг. Тем самым на каждом шаге выполняется лишь
необходимое число оценок правой части. В~этих методах также
реализовано повторное использование последнего этапа на новом
шаге, что дополнительно снижает вычислительные затраты на каждом
шаге. Представлены условия порядка и~доказательство их
разрешимости. Приводятся результаты
тестовых расчетов, демонстрирующие эффективность построенного метода.\\[1mm]
\textit{Ключевые слова}: запаздывание, ДУЗА, непрерывный метод,
функционально-непрерыв\-ный метод, этапно-непрерывный метод.

}

}

\vskip 4mm

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\textbf{1. Введение.} Рассмотрим дифференциальное уравнение
с~дискретным запаздывающим аргументом (ДУЗА)
\begin{equation}
  \dot{u}(t) = f\big(t, u(t), u(t-\tau)\big),\quad t\geq t_0,
  \label{dde1}
\end{equation}
с предысторией
\begin{equation}
  u(t) = \varphi(t),\quad t\leq t_0.
  \label{dde1ic}
\end{equation}
Величина $\tau$ отклонения аргумента функции $u(t-\tau)$
называется запаздыванием. В~общем случае функция правой части $f$
может зависеть от значения решения в~нескольких запаздывающих
значениях времени ($t-\tau_1$, $t-\tau_2$ и~т.\:д.). Однако
рассматриваемый в~рамках настоящей работы численный метод
формулируется для одного запаздывания, так что для упрощения
записи ограничимся формой~\eqref{dde1}. Формулировка метода легко
распространяется на случай нескольких запаздываний.

Математические модели, использующие ДУЗА, встречаются во многих
отраслях: биологии, популяционной динамике, медицине, иммунологии
и~эпидемиологии, экономике, нелинейной оптике, химии, механике,
в~задачах теории управления и~во многих других (см., например,
обобщающие монографии~%
%\cite{ErneuxBook, SmithBook}
[1, 2] и~литературу в~них).

Если запаздывание $\tau$ постоянно, то численное решение задачи
\eqref{dde1}, \eqref{dde1ic} может быть выполнено произвольным
известным методом решения обыкновенных дифферен\-циаль\-ных
уравнений (ОДУ) с~постоянным шагом, целое число раз укладывающимся
в~$\tau$. Особый интерес для решения численными методами
представляют уравнения с~запаздыванием общего вида: зависящим от
времени и/или самого решения в~текущий момент времени, т.~е. $\tau
= \tau(t,u(t))$. Для полноты описания приведем условия
существования
и~единственности решения в~этом случае~%
%\cite{BellZenn}
[3].

%\begin{theorem}
\textbf{Теорема 1.}\textit{ Рассмотрим уравнение \eqref{dde1}
с~запаздыванием общего вида $\tau = \tau(t,u(t))$ и~предысторией
\eqref{dde1ic}. Пусть $U$ и~$V$~--- окрестности $\varphi(t_0)$
и~$\varphi(t_0-\tau(t_0,\varphi(t_0)))$ соответственно. Если
функция $f(t,u,v)$ непрерывна по первому аргументу и~липшецева по
второму и~третьему в~$[t_0,t_0+h]\times U\times V$ для некоторого
$h>0$, и~если, кроме того, предыстория $\varphi(t)$ липшецева при
$t \leq t_0$, а~запаздывание $\tau(t,u) \geq 0$ непрерывно по $t$
и~липшецево по второму аргументу в~$[t_0,t_0+h]\times U$, то
задача \eqref{dde1}, \eqref{dde1ic} имеет единственное решение на
интервале $[t_0, t_0+\delta)$ для некоторого $\delta>0$, и~это
решение непрерывно зависит от начальных данных. }
%\end{theorem}

В такой ситуации требуется применять численные методы, дающие
приближение к~решению не только в~конечных точках совершаемых
шагов, но и~в~любой точке промежутка решения. Эти методы
называются непрерывными. Так называемому стандартному подходу
к~решению ДУЗА на примере непрерывных методов Рунге---Кутты
посвящeн п.~2.

В тех случаях, когда запаздывание становится слишком маленьким или
в некоторых точках исчезает, запаздывающий аргумент попадает
в~текущий шаг (ситуация, называемая \textit{перекрытием})
и~реализация любого классического метода решения ОДУ становится
полностью неявной. Само собой, применение изначально неявных
методов, например
полностью неявного метода Радо, лежащего в~основе программы RADAR~%
%\cite{GugHai2001}
[4]~--- одного из наиболее популярных кодов для численного решения
ДУЗА, практически не усложняется в~случае перекрытия. В~то же
время основное применение неявные методы находят в~случае жестких
задач, но большое число возникающих при моделировании систем
уравнений с~запаздываниями можно отнести к~нежестким. Их можно
с~успехом решать и~явными методами, скорость которых несравнимо
выше. Само собой, потеря явности даже на нескольких шагах
существенно снижает скорость работы методов, поэтому появились
методы, сохраняющие явную реализацию и~для малых значений
запаздывания. В~п.\;3 приводится их описание, а~в~п.\;4
формулируется теорема о~минимальном необходимом количестве
вычислений правой части в~зависимости от возникновения перекрытия
на этапах.

Поскольку метод Рунге---Кутты четвертого порядка в~случае
перекрытия тре\-бует семи этапов, а~без него~--- шести,
эффективная реализация метода решения задачи \eqref{dde1},
\eqref{dde1ic} должна в~зависимости от наличия перекрытия
выбирать, какой метод использовать. В~п.\;5 предложена вложенная
пара методов, один из которых имеет шесть этапов и~применяется
в~отсутствие перекрытия, а второй, семиэтапный, когда оно есть.
В~начале шага всегда предполагается, что перекрытия нет, и~расчет
на\-чи\-нает\-ся шестиэтапным методом. Вложенность проявляется
в~том, что при обнаружении перекрытия на любом из этапов все
выполненные ранее вычисления используются семиэтапным методом,
а~общее число вычислений правой части на шаге не пре\-вы\-шает
семи.

В п.\;6 приводится решение тестовых задач, подтверждающее заявленный порядок сходимости предложенного метода, а~также он сравнивается с~полностью семиэтапным методом, предложенным ранее в~%
%\cite{MasTorVer2005}
[5], по критерию <<затраты/точность>>.


% SECTION 2
\textbf{2. Стандартный подход на основе непрерывных методов.}
В простых слу\-чаях решение ДУЗА можно проводить с~помощью непрерывных численных методов для ОДУ. Их отличие от классических \textit{дискретных} методов, которые дают приближение к~решению на некоторой сетке, заключается в~том, что они дополнительно  содержат способ приближения решения в~произвольной точке отрезка решения. В~частности, в~многошаговых методах можно строить интерполяционный полином через точки сетки. В~одношаговых методах \textit{интерполянт} обычно делают локальным, т.\;е. опирающимся только на те же данные (оценки правой части уравнения) внутри шага, по которым находится приближение в~его конце. Например, неявные коллокационные методы (см.~%
%\cite{Hairer1, BellZenn}
[3, 6]) содержат такой интерполянт по определению. Другим
вариантом является построение локальных эрмитовых сплайнов по
значениям решения в~точках сетки и~их производных, что для явных
методов Рунге---Кутты доступно всегда, если в~задаче в~явной форме
выделена производная.

Рассмотрим более общий вариант непрерывного метода Рунге---Кутты
(НРК) применительно к~\eqref{dde1}. Предположим, что выполнено $n$
шагов численным методом и~решение приближено на отрезке $[t_0,
t_n]$ с~помощью интерполянта $\eta(t)$ ($\eta(t) \equiv
\varphi(t)$, $t\leq t_0$). Явный $s$-этапный НРК дает приближение
к решению уравнения \eqref{dde1} в~любой точке $(n+1)$-го шага
через доопределение интерполянта $\eta(t)$ по формуле
\begin{equation}
  u(t_n + \theta h) \approx \eta(t_n+\theta h) = \eta(t_n) + h\sum_{i=1}^sb_i(\theta)K_i,\quad \theta\in[0, 1],
  \label{crk_u}
\end{equation}
где
\begin{equation}
  K_i = f\Big(T_i, Y_i, \eta\big(T_i-\tau(T_i,Y_i)\big)\Big), \quad T_i = t_n + c_ih, \quad Y_i = \eta(t_n) + h\sum_{j=1}^{i-1}a_{ij}K_j.
  \label{crk_k}
\end{equation}



Коэффициенты метода, как правило, представляются в~виде так
называемой таблицы Бутчера
\begin{equation}
  \begin{array}{c|ccccc}
    0      & 0      & & & &  \\
    c_2    & a_{21} & & & &   \\%[3mm]
    c_3    & a_{31} & a_{32} & & &  \\%[3mm]
    \vdots & \vdots & \vdots & \ddots & & \\%[3mm]
    c_s    & a_{s1} & a_{s2} & \cdots & a_{s,s-1} & \\%[3mm]
    \hline&&&&&\\[-3mm]
      & b_1(\theta) & b_2(\theta) & \cdots & b_{s-1}(\theta) & b_s(\theta)
  \end{array}
\label{butcher_tab}
\end{equation}
%
В ней отмечено, что $b_i(\theta)$~--- это функциональные
коэффициенты, позволяющие по\-строить непрерывное приближение.


%\subsection{Дискретный и~равномерный порядки} %DONE
При описании непрерывного приближения необходимо рассмотреть
вопрос о~его точности. В~отличие от дискретных методов, в~которых
нас интересует погрешность в~точках сетки, для непрерывных методов
следует оценивать погрешность в~каждой точке интервала вычислений.

После выполнения $n$ шагов методом \eqref{crk_u}, \eqref{crk_k} на
следующем шаге решаем задачу
\begin{equation}
  \left\{\begin{aligned}
    \dot{u}(t) &= f\big(t, u(t), u(t-\tau)\big), &&t\geq t_n,\\
    u(t) &= \eta(t), &&t\leq t_n,
  \end{aligned}\right.
  \label{dde1_nsteps}
\end{equation}
где непрерывное приближение к~решению $\eta(t)$ уже определено
вплоть до $t_n$. Пусть $z_{n+1}(t)$~--- точное решение
задачи~\eqref{dde1_nsteps}. Рассмотрим отрезок от $t_n$ до
$t_{n+1} = t_n + h$, $h>0$.

Дадим несколько определений, которые потребуются в~дальнейшем.

%\begin{definition}
\textbf{Определение 1.}\textit{ Локальной погрешностью
(погрешностью на шаге) метода \eqref{crk_u}, \eqref{crk_k} при
решении задачи \eqref{dde1_nsteps} назовем величину
  $$
  e(t) = z_{n+1}(t) - \eta(t), \quad t\in[t_n, t_{n+1}].
  $$
}
%\end{definition}

%\begin{definition}
\textbf{Определение 2.}\textit{ Метод \eqref{crk_u}, \eqref{crk_k}
имеет дискретный локальный порядок $p$, если $p\geq1$~---
наибольшее целое число такое, что для любой правой части задачи
\eqref{dde1_nsteps} $f\in C^p$ и~достаточно малого шага $h$
найдется константа $C > 0$ такая, что
  $$
  \|e(t_{n+1})\| \leq Ch^{p+1}.
  $$
}
%\end{definition}

%\begin{definition}
\textbf{Определение 3.}\textit{ Метод \eqref{crk_u}, \eqref{crk_k}
имеет равномерный локальный порядок $q$, если $q\geq1$~---
наибольшее целое число такое, что для любой правой части задачи
\eqref{dde1_nsteps} $f\in C^q$ и~достаточно малого шага $h$
найдется константа $C' > 0$ такая, что
  $$
  \max_{t\in[t_n,t_{n+1}]}\|e(t)\| \leq C'h^{q+1}.
  $$
}
%\end{definition}


Отметим, что, в~силу определения, $p\geq q$, т.\;е. равномерный
порядок $q$ гарантирует и~дискретный порядок $q$. Обратное может
быть неверно. Нередко в~практически применяемых методах
непрерывное приближение имеет порядок, меньший, чем приближение
в~точках сетки. Например, использование упомянутой выше эрмитовой
интерполяции, если метод Рунге---Кутты имеет порядок не ниже
третьего, дает равномерный порядок три. В~пакете MATLAB
используется как раз такой вариант построения непрерывного
приближения для классического метода Рунге---Кутты дискретного
порядка четыре~%
%\cite{Shampine2005}
[7].

%\begin{definition}
\textbf{Определение 4.}\textit{ Глобальной погрешностью метода
\eqref{crk_u}, \eqref{crk_k} при решении задачи \eqref{dde1}
в~точке $t\geq t_0$ шагов назовем величину
  $$
  E(t) = u(t) - \eta(t).
  $$
}
%\end{definition}
\noindent Пусть на отрезке решения задачи $[t_0, t_f]$ сделано $N$
шагов длин $h_n$, $n=1,...,N$.

%\begin{definition}
\textbf{Определение 5.}\textit{ Метод \eqref{crk_u}, \eqref{crk_k}
имеет дискретный глобальный порядок $p$ (дискретный порядок
сходимости), если $p\geq1$~--- наибольшее целое число такое, что
для любой правой части $f$ задачи \eqref{dde1}, для которой на
каждом шаге $f\in C^p$, и~достаточно малого максимального шага $h
= \max_n h_n$, $n=1,...,N$, найдется константа $C > 0$ такая, что
  $$
  \max_{n=\overline{1,N}}\|E(t_{n})\| \leq C h^{p}.
  $$
}
%\end{definition}

%\begin{definition}
\textbf{Определение 6.}\textit{ Метод \eqref{crk_u}, \eqref{crk_k}
имеет равномерный глобальный порядок $q$ (равномерный порядок
сходимости), если $q\geq1$~--- наибольшее целое число такое, что
для любой правой части $f$ задачи \eqref{dde1}, для которой на
каждом шаге $f\in C^q$, и~достаточно малого максимального шага $h
= \max_n h_n$, $n=1,...,N$, найдется константа $C' > 0$ такая, что
  $$
  \max_{t\in[t_0,t_f]}\|E(t)\| \leq C' h^{q}.
  $$
}
%\end{definition}

% \subsection{Непрерывный метод Рунге\,---\,Кутты (РК) 4 порядка с~6 этапами}

В работе~%
%\cite{OwrZen1992}
[8] была изучена общая процедура построения явных непрерывных
методов Рунге---Кутты и~установлено, что для построения явного
метода равномерного порядка три требуются как минимум четыре
этапа, для четвертого~--- шесть, а~для пятого~--- восемь (если
речь не идет о~системах со структурными особенностями, в~которых
возможно снижение числа этапов, см., например,~%
%\cite{CMMP2010, OleKov2018, ICCSA2017, ICNAAM15}
[9--12]). Рассмотрим метод четвертого порядка с~шестью этапами:
{\small
\begin{equation}
  \begin{array}{c|cccccc}
    0    & 0 & & & & & \\
    \dfrac16  & \dfrac16  & & & & &  \\[3mm]
    \dfrac{11}{37} & \dfrac{44}{1369} & \dfrac{363}{1369} \\[3mm]
    \dfrac{11}{17} & \dfrac{3388}{4913} & -\dfrac{8349}{4913} & \dfrac{8140}{4913} \\[3mm]
    \dfrac{13}{15} & -\dfrac{36764}{408375} & \dfrac{767}{1125} & -\dfrac{32708}{136125} & \dfrac{210392}{408375} \\[3mm]
    1              & \dfrac{1697}{18876} & 0 & \dfrac{50653}{116160} & \dfrac{299693}{1626240} & \dfrac{3375}{11648} \\[3mm]
    \hline&&&&&\\[-1mm]
      & b_1(\theta) & 0 & b_3(\theta) & b_4(\theta) & b_5(\theta) & b_6(\theta)
  \end{array}
\label{metOZ46}
\end{equation}
$$
\begin{aligned}
  b_1(\theta) &= \theta - \dfrac{104217}{37466}\theta^2 + \dfrac{1806901}{618189}\theta^3 - \dfrac{866577}{824252}\theta^4,\\
  b_3(\theta) &= \dfrac{861101}{230560}\theta^2 - \dfrac{2178079}{380424}\theta^3 + \dfrac{12308679}{5072320}\theta^4,\\
  b_4(\theta) &= -\dfrac{63869}{293440}\theta^2 +\dfrac{6244423}{5325936}\theta^3 - \dfrac{7816583}{10144640}\theta^4,\\
  b_5(\theta) &= -\dfrac{1522125}{762944}\theta^2 + \dfrac{982125}{190736}\theta^3 - \dfrac{624375}{217984}\theta^4,
  \\
  b_6(\theta) &= \dfrac{165}{131}\theta^2 -\dfrac{461}{131}\theta^3 + \dfrac{296}{131}\theta^4.
\end{aligned}
$$
}

\noindentСледует обратить внимание на то, что в~представленном
методе приближение $Y_6$ на $(n+1)$-м шаге оказывается равным
$\eta(t_n+h)$. Действительно, $b_i(1) = a_{6i}$,
$i=\overline{1,6}$. Это возможно из-за того, что четвертый
дискретный порядок может быть по\-строен за четыре этапа. Таким
образом, для получения приближения в~конечной точке шага
используются пять первых этапов, а~шестой нужен только для
непрерывного четвертого приближения порядка. Очевидно, что в~таком
случае $Y_1$ на новом шаге совпадает с~$Y_6$ на предыдущем,
и~метод по своей реализации оказывается пятиэтапным. Такое
\textit{повторное использование} (англ. \textit{reuse}) иногда
называют FSAL (от англ. \textit{First Same as Last}~--- первый,
как последний)~%
%\cite{Hairer1}
[6]. Мы будем строить метод на основе этой идеи.

Для ОДУ известно, что если на каждом шаге метод демонстрирует дискретный локальный порядок $p$, то он сходится с~дискретным порядком $p$~%
%\cite{Hairer1}
[6]. При этом равномерный локальный порядок $q$ позволяет получить равномерный порядок сходимости $\max(p,q+1)$~%
%\cite{BellZenn}
[3]. Для ДУЗА, однако, глобальный порядок сходимости, как
равномерный, так и~дискретный, не превосходит $\max(p,q+1)$,
потому необходимо строить непрерывные методы с~равномерным
порядком не ниже $p-1$.

Это утверждение верно в~том случае, если решаемая на каждом шаге
начальная задача является достаточно гладкой, т.~е. если ее
решение на каждом шаге имеет\linebreak непрерывную производную
порядка~$p$. Для уравнений с~запаздывающим аргументом характерно
наличие точек
разрыва производных (см., например,~%
%\cite{BellZenn}
[3]), которые должны быть включены в~сетку по времени так,  чтобы
они не являлись внутренними точками ни на одном из шагов. Задача
обнаружения и~достаточно точного приближения точек разрыва
описана, например, в~%
%
%\cite{FelNev1984, ICNAAM14}
[13, 14] и~выходит за рамки настоящей работы, в~которой мы
рассматриваем локальное поведение конструируемого метода.

Отметим также, что предпочтительнее использовать методы с~полным
локальным равномерным порядком, т.~е. при $q=p$. В~этом случае
контроль длины шага (как через оценку погрешности, так и~через
оценку невязки) оказывается более удобным и~точным. Кроме того,
такие методы без потери порядка можно применять к~нейтральным
уравнениям (таким, где $\dot{u}(t)$ зависит и~от
$\dot{u}(t-\sigma)$ для некоторого запаздывания $\sigma$). В~связи
с этим далее строится метод равномерного порядка четыре.

\textbf{3. Функционально-непрерывные методы.}
% \subsection{Запаздывание общего вида, исчезающие запаздывания}
Упомянутый \textit{стандартный подход} на основе непрерывных
методов применим в~том случае, когда длина шага $h < \tau_0 =
\min{\tau(t,u(t))}$. Однако в~наиболее общем случае переменное
запаздывание $\tau$ может быть очень маленьким, что влечет за
собой слишком малую длину шага для сохранения порядка метода, или
вообще становится нулевым (так называемый случай
\textit{исчезающего запаздывания}). В~последнем случае при
практической реализации даже явные методы становятся полностью
неявными, так как из-за попадания запаздывания внутрь совершаемого
шага величины $Y_i$ в~\eqref{crk_k} зависят от интерполянта
$\eta(t)$, который строится по ним самим и~всем последующим.
Ситуацию, в~которой запаздывающее решение $u(t - \tau)$ необходимо
вычислить внутри текущего шага, будем называть
\textit{перекрытием} (англ. \textit{overlapping}).

%\subsection{ФНРК}
Еще в~начале 1970-х годов появилась работа, в~которой был
предложен способ сохранить полностью явную реализацию одношаговых
методов для уравнений с~произ\-воль\-ным запаздыванием~%
%\cite{Tavernini1971}
[15]. В~ней рассмотрено расширение НРК. В~%
%\cite{MasTorVer2005, ActaNumer2009}
[5, 16] методы такого типа получили название
\textit{функционально-непрерывных}, так как они
скон\-струи\-ро\-ва\-ны специально для решения функциональных
дифференциальных уравнений запаздывающего типа. В~них была
построена теория и~выведены условия равномерного и~дискретного
порядков для функционально-непрерывных методов Рунге---Кутты
(ФНРК). Следует отметить, что в~некоторых других статьях методы
с~подобными свойствами называются этапно-непрерывными
(англ.~\textit{continuous-stage methods}), что точнее описывает их
структуру (см. например,~%
%\cite{Miyatake2014}
[17]).

%\begin{remark}
\textbf{Замечание 1.} Вообще говоря, ФНРК разработаны для случая
функционально-диф\-фе\-рен\-ци\-аль\-ных уравнений (ФДУ), которые
являются более общими, чем уравнения с~дискретным
запаздыванием (см., например,~%
%
%\cite{HaleBook}
[18]). Численные методы для ФДУ, в~том числе обобщение методов
Рунге---Кутты, разрабатываются уже длительное время, в~частности
они широко представлены в~%
%\cite{KimPimBook}
[19]. Заметим, что метод, предложенный в~данной статье, содержит
в~себе часть, которая является полноценным методом ФНРК для
функционально-дифференциальных уравнений. Однако в~случае ФДУ
предполагается, что перекрытие происходит всегда, и~получить
какой-то\linebreak выигрыш в~числе этапов для общего случая ФДУ по
сравнению с~семиэтапным методом с~повторным использованием,
описанным в~%
%\cite{ANM2019}
[20], не получится. Именно сужение области применения ФНРК на
случай уравнений с~дискретным запаздыванием дает возможность
скомбинировать его с~НРК и~получить эффективный инструмент решения
ДУЗА. Для полноты изложения в~п.~4 приведем условия порядка НРК
и~ФНРК, которым удовлетворяют построенные нами методы.
%\end{remark}


Поскольку при совершении $(n+1)$-го шага интерполянт $\eta(t)$ еще
не определен для $t \geq t_n$, явная реализация метода типа
Рунге---Кутты требует для каждого этапа построения своего
интерполянта, использующего только уже явно доступную к~моменту
его применения информацию.

Как и~в~случае НРК \eqref{crk_u}, \eqref{crk_k}, предположим, что
$n$ шагов численным методом уже выполнено и~на отрезке $[t_0,
t_n]$ построен интерполянт $\eta(t)$. Как и~раньше, $\eta(t)
\equiv \varphi(t)$, $t\leq t_0$. На $(n+1)$-м шаге интерполянт
$\eta(t)$ доопределяется следующим образом:
\begin{equation}
  u(t_n + \theta h) \approx \eta(t_n+\theta h) = \eta(t_n) + h\sum_{i=1}^sb_i(\theta)K_i,\quad \theta\in[0, 1],
  \label{fcrk_u}
\end{equation}
где
\begin{equation}
  K_i = f\Big(T_i, Y_i, \eta_i\big(T_i-\tau(T_i,Y_i)\big)\Big), \quad T_i = t_n + c_ih, \quad
  Y_i = \eta(t_n) + h\sum_{j=1}^{i-1}a_{ij}K_j,
  \label{fcrk_k}
\end{equation}
а этапные интерполянты вычисляются как
\begin{equation}
  \eta_i(t_n+\theta h) = \eta(t_n) + h\sum_{i=1}^sa_{ij}(\theta)K_j, \quad \theta\in[0, c_i].
  \label{fcrk_eta}
\end{equation}

Помимо функциональных весовых коэффициентов $b_i(\theta)$ в~ФНРК
присутствуют функциональные этапные коэффициенты $a_{ij}(\theta)$.
При этом естественным является требование совпадения $Y_i$ со
значением интерполянта $\eta_i$ в~отсутствие запаздывания, т.\;е.
при $\theta = c_i$. Равенство $\eta_i(c_i) = Y_i$ позволяет
представить ФНРК с~помощью таблицы Бутчера (см.~(5)), лишь заменив
постоянные коэффициенты $a_{ij}$ на их непрерывные аналоги для
метода \eqref{fcrk_u}--\eqref{fcrk_eta}. Приведем коэффициенты
ФНРК четвeртого равномерного порядка из~%
%\cite{MasTorVer2005}
[5]: {\small
\begin{equation}
  \begin{array}{c|ccccccc}
    0    & 0 & & & & & & \\
    1    & \theta & & & & & &  \\[3mm]
    \dfrac12  & \theta  - \dfrac12\theta^2 & \dfrac12\theta^2 \\[3mm]
    1 & \theta  - \dfrac12\theta^2 & \dfrac12\theta^2 \\[3mm]
    \dfrac13  & \theta-\dfrac32\theta^2+\dfrac23\theta^3 & {0} & 2\theta^2-\dfrac43\theta^3 & -\dfrac12\theta^2+\dfrac23\theta^3\\[3mm]
    \dfrac23  & \theta-\dfrac32\theta^2+\dfrac23\theta^3 & {0} & 2\theta^2-\dfrac43\theta^3 & -\dfrac12\theta^2+\dfrac23\theta^3 \\[3mm]
    1  & \theta-\dfrac32\theta^2+\dfrac23\theta^3 & {0} & 2\theta^2-\dfrac43\theta^3 & -\dfrac12\theta^2+\dfrac23\theta^3 \\[3mm]
    \hline&&&&&&\\[-1mm]
      & b_1(\theta) & {0} & {0} & {0} & b_5(\theta) & b_6(\theta) & b_7(\theta)
  \end{array}
\label{metMTV47}
\end{equation}
$$
\begin{aligned}
  & b_1(\theta) = \theta - \dfrac{11}{4}\theta^2 + 3\theta^3 - \dfrac{9}{8}\theta^4,
  && b_5(\theta) = \dfrac{9}{2}\theta^2 - \dfrac{15}{2}\theta^3 + \dfrac{27}{8}\theta^4,
  \\
  & b_6(\theta) = -\dfrac{9}{4}\theta^2 - 6\theta^3 - \dfrac{27}{8}\theta^4,
  && b_7(\theta) = \dfrac{1}{2}\theta^2 - \dfrac{3}{2}\theta^3 + \dfrac{9}{8}\theta^4.
\end{aligned}
$$
}

Условия порядка ФНРК сложнее, чем для НРК (они приведены в~п.~4),
и~по\-строе\-ние метода четвертого непрерывного
порядка требует, как минимум, семи этапов~%
%\cite{Tavernini1971, MasTorVer2005}
[5, 15]. При этом этапные интерполянты, очевидно, не могут иметь
тот же порядок, что и~результирующий интерполянт, построенный по
полному числу этапов. Тем не менее, как и~в~случае НРК, для
сохранения дискретного глобального порядка $p$ достаточно
обеспечить локальный равномерный порядок $p-1$ и~локальный
дискретный~--- $p$. В~%
%\cite{Tavernini1971}
[15], в~частности, представлен метод дискретного порядка четыре
с~интерполянтом порядка три, требующий всего шести этапов.

Это позволяет реализовать идею повторного использования
и~построить метод четвертого равномерного порядка с~сохранением
последнего этапа с~прошлого шага и~лишь шестью новыми вычислениями
правой части на новом шаге~%
%\cite{ANM2019}
[20].

Далее приводятся условия четвертого порядка ФНРК и~доказывается
утверждение о~минимальном необходимом для него числе этапов.

\textbf{4. Условия порядка ФНРК.} Покажем, что условия четвертого
равномерного порядка ФНРК, выведенные в~%
%\cite{MasTorVer2005}
[5], в~случае отсутствия перекрытия на четвертом этапе можно
разрешить с~шестью этапами вместо семи для общего случая.

Согласно %
%\cite{MasTorVer2005}
[5], явный ФНРК \eqref{fcrk_u}--\eqref{fcrk_eta} обладает
четвертым локальным равномерным порядком, если его коэффициенты
удовлетворяют следующим равенствам:
\begin{align}
%\begin{equation}
  %\begin{aligned}
  \sum_{i=1}^sb_i(\alpha) = \alpha,&& \alpha\in[0,1], \label{ocquad1}\\
  \sum_{j=1}^sa_{ij}(\alpha) = \alpha,&& \alpha\in[0,c_i],&& i=1,...,s,\label{ocstage1}\\
  \sum_{i=1}^sb_i(\alpha)c_i = \frac{\alpha^2}{2},&& \alpha\in[0,1],\label{ocquad2}\\
  \sum_{i=1}^sb_i(\alpha)c_i^2 = \frac{\alpha^3}{3},&& \alpha\in[0,1],\label{ocquad3}\\
  \sum_{\substack{i=1\\c_i=c^*_m}}^sb_i(\alpha)\left(\sum_{j=1}^{i-1}a_{ij}(\beta)c_j - \frac{\beta^2}{2}\right)=0, &&\alpha\in[0,1], && \beta\in[0,c^*_m], && m=1,...,s^*,\label{ocstage2}\\
  \sum_{i=1}^sb_i(\alpha)c_i^3 = \frac{\alpha^4}{4},&& \alpha\in[0,1],\label{ocquad4}\\
  \sum_{\substack{i=1\\c_i=c^*_m}}^sb_i(\alpha)\left(\sum_{j=1}^{i-1}a_{ij}(\beta)c_j^2 - \frac{\beta^3}{3}\right)=0, &&\alpha\in[0,1], && \beta\in[0,c^*_m], && m=1,...,s^*,\label{ocstage3}
%   %\end{aligned}
%\end{equation}
\end{align}
и
\begin{equation}
\sum_{\substack{i=1\\c_i=c^*_m}}^sb_i(\alpha)\!\!\sum_{\substack{j=1\\c_j=c^*_l}}^{i-1}\!\!a_{ij}(\beta)\left(\sum_{k=1}^{j-1}a_{jk}(\gamma)c_k
- \frac{\gamma^2}{2}\right)=0,\  \alpha\in[0,1],\
\beta\in[0,c^*_m],\  \gamma\in[0,c^*_l], \label{ocstage32}
\end{equation}
для $m, l = 1,...,s^*$. Здесь $c_i^*$, $i=1,...,s^*$,~--- все
различные значения коэффициентов $c_i$. Условия четвертого
дискретного порядка такие же, кроме \eqref{ocquad4}, которое
достаточно удовлетворить при $\alpha=1$.

Условия \eqref{ocquad1}, \eqref{ocquad2}, \eqref{ocquad3}
и~\eqref{ocquad4} дают четвертый равномерный порядок для случая
чистой квадратурной формулы. Выполнение условия \eqref{ocstage1}
дает первый равномерный порядок для каждого этапа. Условия
\eqref{ocstage2} и~\eqref{ocstage3} означают, что равномерный
порядок приближения на этапах, используемых в~финальной сумме
\eqref{fcrk_u} (т.\;е. на тех,  для которых
$b_i(\alpha)\not\equiv0$), равен двум и~трeм соответственно.
Последнее равенство означает, что приближения $\eta_i$, для
которых должен быть обеспечен третий этапный порядок,\linebreak не
должны быть основаны на приближениях $K_j$, не обладающих вторым
порядком\linebreak (т.\;е. $a_{ij}(\beta) \equiv0$, если для
соответствующих $i$ и~$j$ не выполняется условие в~скобках).

В~%
%\cite{MasTorVer2005}
[5] доказывается, что ФНРК четвертого равномерного порядка может
быть построен как минимум за семь этапов, в~то время как четвертый
дискретный порядок достижим за шесть. Однако в~том случае, если мы
применяем метод к~дифференциальному уравнению с~дискретным
запаздыванием~\eqref{dde1}, можно сформулировать следующее
утверждение.

%\begin{theorem}\label{newtheorem}
\textbf{Теорема 2.}\textit{ При применении ФНРК
\eqref{fcrk_u}--\eqref{fcrk_eta} к~ДУЗА \eqref{dde1} в~том случае,
если нет перекрытия на четвертом этапе, можно построить метод
четвертого равномерного порядка с~шестью этапами. }
%\end{theorem}

%\noindent
Д\;о\;к\;а\;з\;а\;т\;е\;л\;ь\;с\;т\;в\;о. Наиболее общим случаем
является ситуация, когда все $c_i$, $i=1,...,6$, различны.
Действительно, условия \eqref{ocstage2}, \eqref{ocstage3}
и~\eqref{ocstage32} распадаются в~этом случае на независимые
равенства. Если выполняются они, очевидно, будут выполняться
и~равенства, включающие в~себя их суммы, которые возникают при
совпадении некоторых значений $c_i$ друг с~другом. Поэтому будем
считать, что все $c_i$ различны, $s^* = 6$, а~набор $c_i^* = c_i$,
$i=1,...,6$.

Поскольку рассматриваем явный метод, коэффициент $c_1 = 0$. Таким
образом, коэффициенты $a_{i1}$, $i=1,...,6$, не входят ни в~одно
уравнение, кроме группы условий \eqref{ocstage1}, которая может
быть решена за счет них при любых значениях других
коэф\-фи\-циен\-тов $a_{ij}$, $i=1,...,6$, $j=2,...,i-1$.
В~частности,
$$a_{21}(\beta) = \beta, \quad \beta\in[0, c_2].$$

Очевидно, что условие \eqref{ocstage2} при $m = 2$ влечет
$$
  b_2(\alpha) \equiv 0, \quad \alpha\in[0,1],
$$
так как в~скобках пропадает сумма. Совместное рассмотрение условий
\eqref{ocstage2} и~\eqref{ocstage3} при $m=3$ дает к~тому же
$$
  b_3(\alpha) \equiv 0, \quad \alpha\in[0,1],
$$
так как одновременное выполнение условий $a_{32}(\beta) =
\beta^2/2c_2$ и~$a_{32}(\beta) = \beta^3/2c_2^2$ при произвольном
$\beta$ невозможно.

Условия \eqref{ocquad1}, \eqref{ocquad2}, \eqref{ocquad3}
и~\eqref{ocquad4} разрешимы, если $c_1=0$, $c_4$, $c_5$ и~$c_6$
различны и~$b_1(\alpha)$, $b_4(\alpha)$, $b_5(\alpha)$
и~$b_6(\alpha)$ не нулевые.

Рассмотрим оставшиеся условия групп \eqref{ocstage2},
\eqref{ocstage3} и~\eqref{ocstage32} при $m=4, 5, 6$. В~силу
отсутствия перекрытия на четвертом этапе уравнения с~$m=4$ должны
быть удовлетворены только при значении $\beta = c_4$, чтобы нужный
порядок имело приближение $Y_4$. Приближение $\eta_4$ при этом
будет находиться по уже совершенным шагам (или предыстории)
и~потому будет иметь необходимый порядок точности.

Заметим, что условия \eqref{ocstage32} при $m=4, 5, 6$ и~$l=2$
могут быть выполнены только при условии
$$
a_{42}(c_4) = 0, \quad a_{52}(\beta)\equiv a_{62}(\beta)\equiv0.
$$

С учетом вышесказанного условия \eqref{ocstage2} примут вид
\begin{equation*}
  \begin{aligned}
    &a_{43}(c_4)c_3 = \frac{c_4^2}{2},\\
    &a_{53}(\beta)c_3 + a_{54}(\beta)c_4 = \frac{\beta^2}{2}, && \beta\in[0,c_5], \\
    &a_{63}(\beta)c_3 + a_{64}(\beta)c_4 + a_{65}(\beta)c_5 = \frac{\beta^2}{2}, && \beta\in[0,c_6],
    \end{aligned}
    \tag{\ref{ocstage2}$^\prime$}
    \label{ocstage2'}
\end{equation*}
условия \eqref{ocstage3}~---
\begin{equation*}
  \begin{aligned}
    &a_{43}(c_4)c_3^2 = \frac{c_4^3}{3},\\
    &a_{53}(\beta)c_3^2 + a_{54}(\beta)c_4^2 = \frac{\beta^3}{3}, && \beta\in[0,c_5], \\
    &a_{63}(\beta)c_3^2 + a_{64}(\beta)c_4^2 + a_{65}(\beta)c_5^2 = \frac{\beta^3}{3}, && \beta\in[0,c_6],
    \end{aligned}
    \tag{\ref{ocstage3}$^\prime$}
    \label{ocstage3'}
\end{equation*}
а условия \eqref{ocstage32}~---
\begin{equation*}
  \begin{aligned}
    &a_{43}(c_4)\left(a_{32}(\gamma)c_2 - \frac{\gamma^2}{2}\right) = 0, && &&\gamma\in[0,c_3],\\
    &a_{53}(\beta)\left(a_{32}(\gamma)c_2 - \frac{\gamma^2}{2}\right) = 0, && \beta\in[0,c_5], &&\gamma\in[0,c_3],\\
    &a_{63}(\beta)\left(a_{32}(\gamma)c_2 - \frac{\gamma^2}{2}\right) = 0, && \beta\in[0,c_6], &&\gamma\in[0,c_3],\\
    &a_{54}(\beta)\left(a_{43}(c_4)c_3 - \frac{c_4^2}{2}\right) = 0, && \beta\in[0,c_5],\\
    &a_{64}(\beta)\left(a_{43}(c_4)c_3 - \frac{c_4^2}{2}\right) = 0, && \beta\in[0,c_6],\\
    &a_{65}(\beta)\left(a_{53}(\gamma)c_3 + a_{54}(\gamma)c_4 - \frac{\gamma^2}{2}\right) = 0, && \beta\in[0,c_6], &&\gamma\in[0,c_5].\\
    \end{aligned}
    \tag{\ref{ocstage32}$^\prime$}
    \label{ocstage32'}
\end{equation*}

Одновременно все условия \eqref{ocstage2'}, \eqref{ocstage3'}
и~\eqref{ocstage32'} выполняются, если выполнены условия
\begin{equation}
  \begin{aligned}
    &a_{32}(\gamma)c_2 = \frac{\gamma^2}{2}, && \gamma\in[0,c_3],\\
    &a_{43}(c_4)c_3 = \frac{c_4^2}{2},\\
    &a_{43}(c_4)c_3^2 = \frac{c_4^3}{3},\\
    &a_{53}(\beta)c_3 + a_{54}(\beta)c_4 = \frac{\beta^2}{2}, && \beta\in[0,c_5], \\
    &a_{53}(\beta)c_3^2 + a_{54}(\beta)c_4^2 = \frac{\beta^3}{3}, && \beta\in[0,c_5], \\
    &a_{63}(\beta)c_3 + a_{64}(\beta)c_4 + a_{65}(\beta)c_5 = \frac{\beta^2}{2}, && \beta\in[0,c_6],\\
    &a_{63}(\beta)c_3^2 + a_{64}(\beta)c_4^2 + a_{65}(\beta)c_5^2 = \frac{\beta^3}{3}, && \beta\in[0,c_6].
    \end{aligned}\label{newlabel20}
\end{equation}
Очевидно, что линейные по $a_{ij}$ условия \eqref{newlabel20}
могут быть разрешены, если $c_3\neq c_4$. Таким образом, теорема
доказана.

%\begin{remark}
\textbf{Замечание 2.}  Доказательство теоремы дает конструктивный
алгоритм по\-строе\-ния метода ФНРК для задач без перекрытия на
четвертом этапе. Такие методы можно построить и~с~некоторыми
совпадающими абсциссами, главное, чтобы выполнялось $c_3\neq c_4$
и~в~наборе $c_1$, $c_4$, $c_5$, $c_6$ не было совпадений.
%\end{remark}

% Условия \eqref{ocstage2} примут вид
% \begin{equation*}
%   \begin{aligned}
%     b_4(\alpha)\left(a_{42}(c_4)c_2 + a_{43}(c_4)c_3 - \frac{c_4^3}{3}\right) = 0, && \alpha\in[0,1], && \beta\in[0,c_4].\\
%     b_5(\alpha)\left(\sum_{j=2}^{i-1}a_{ij}(\beta)c_j^2 - \frac{\beta^3}{3}\right)=0,&& \alpha\in[0,1], && \beta\in[0,c_i],&& i=1,2,3,5,6,\\
%   \end{aligned}
%   \tag{\ref{ocstage3}'}
%   \label{ocstage3'}
% \end{equation*}


%Условие \eqref{ocstage3} примет вид
% \begin{equation*}
%   \begin{aligned}
%     b_4(\alpha)\left(a_{42}(c_4)c_2^2 + a_{43}(c_4)c_3^2 - \frac{c_4^3}{3}\right) = 0, && \alpha\in[0,1], && \beta\in[0,c_4].\\
%     b_5(\alpha)\left(\sum_{j=2}^{i-1}a_{ij}(\beta)c_j^2 - \frac{\beta^3}{3}\right)=0,&& \alpha\in[0,1], && \beta\in[0,c_i],&& i=1,2,3,5,6,\\
%   \end{aligned}
%   \tag{\ref{ocstage3}'}
%   \label{ocstage3'}
% \end{equation*}


%\section{Комбинированный метод \label{sec_combined}}
\textbf{5. Комбинированный метод.} В~силу того, что трудоемкость
применения методов типа Рунге---Кутты определяется числом этапов,
которое определяет количество вычислений функции $f$ для явных
методов и~размерность систем алгебраических уравнений для неявных,
естественно желание минимизировать число этапов метода при
заданном порядке. Как было отмечено выше, явный НРК четвертого
равномерного порядка при применении FSAL требует пяти новых этапов
на шаге, а~ФНРК~--- шести. При этом следует отметить, что
в~задачах с~дискретным запаздыванием достаточно часто перекрытие
случается лишь на некотором числе шагов, когда запаздывание
становится достаточно малым (например, в~уравнении пантографа лишь
на нескольких первых шагах возникает перекрытие; при исчезающем
запаздывании перекрытие появляется вблизи тех точек, где
запаздывание равно нулю), большая же часть шагов не требует
этапной интерполяции. В~то же время потеря локального порядка на
шагах с~перекрытием, которая неизбежна при использовании
непрерывного метода без этапной интерполяции, может привести
к~недопустимой потере глобальной точности.

Таким образом, лучшим решением будет применение двух методов: НРК
с пятью этапами для шагов без перекрытия и~ФНРК с~шестью этапами
для шагов с~перекрытием. Очевидная проблема заключается в~том, что
обычно определить, появится перекрытие на новом шаге или нет,
заранее невозможно. А в~силу того, что на пограничных шагах
перекрытие возникает лишь для части этапов (например, легко
представить это в~случае монотонного запаздывания), часть
совершенных НРК вычислений может быть потеряна при обнаружении
запаздывания на поздних этапах.

Однако, если обеспечить совпадение некоторых этапов НРК и~ФНРК, то
при обнаружении перекрытия на более поздних этапах станет
возможным использовать уже выполненные вычисления.

Приведeм коэффициенты метода Рунге---Кутты четвeртого равномерного
порядка с~шестью этапами и~FSAL, в~котором все этапы, кроме
четвертого, снабжены интерполянтом и~позволяют обрабатывать случай
перекрытия (обозначим его cFCRK-I, от комбинированного ФНРК):
{\small
\begin{equation*}
  \begin{array}{c|cccccc}
    0    & 0 & & & &  & \\
    \dfrac25        & \theta \\[3mm]
    \dfrac{16}{51}  & \theta - \dfrac54\theta^2 & \dfrac54\theta^2 \\[3mm]
    \dfrac{8}{17}   & \dfrac{2}{17} & 0 & \dfrac{6}{17} \\[3mm]
    \dfrac{19}{20}  & \theta - \dfrac{85}{32}\theta^2+\dfrac{289}{128}\theta^3 &
                      {0} & \dfrac{153}{32}\theta^2-\dfrac{867}{128}\theta^3 & -\dfrac{17}{8}\theta^2+\dfrac{289}{64}\theta^3\\[3mm]
    1  & {a_{61}(\theta)} & {0} & {0} & {a_{64}(\theta)} & {a_{65}(\theta)} & {0}
         \\[3mm]
    \hline&&&&&&\\[-1mm]
      & {b_1(\theta)} & {0} & {0} & {b_4(\theta)} & {b_5(\theta)} & {b_6(\theta)}
  \end{array}
\end{equation*}

$$
\begin{aligned}
  &  a_{61}(\theta) = \theta-\dfrac{483}{304}\theta^2+\dfrac{85}{114}\theta^3,
  && a_{64}(\theta) = \dfrac{5491}{2608}\theta^2-\dfrac{1445}{978}\theta^3,
  && a_{65}(\theta) = -\dfrac{1600}{3097}\theta^2+\dfrac{6800}{9291}\theta^3,
  \end{aligned}
$$
$$
\begin{aligned}
  & b_1(\theta) = \theta - \dfrac{635}{304}\theta^2 + \dfrac{823}{456}\theta^3 - \dfrac{85}{152}\theta^4,
  && b_5(\theta) = -\dfrac{32000}{3097}\theta^2 + \dfrac{200000}{9291}\theta^3 - \dfrac{34000}{3097}\theta^4,
  \\
  & b_4(\theta) = \dfrac{93347}{23472}\theta^2 - \dfrac{63869}{11736}\theta^3 + \dfrac{24565}{11736}\theta^4,
  && b_6(\theta) = \dfrac{76}{9}\theta^2 - \dfrac{161}{9}\theta^3 +
  \dfrac{85}{9}\theta^4
\end{aligned}
$$
}

\noindent и~коэффициенты полного ФНРК равномерного порядка четыре
с семью этапами и~FSAL (cFCRK-II): {\small
\begin{equation*}
  \begin{array}{c|ccccccc}
    0    & 0 & & & & & & \\
    \dfrac25        & \theta \\[3mm]
    \dfrac{16}{51}  & \theta - \dfrac54\theta^2 & \dfrac54\theta^2 \\[3mm]
    \dfrac{8}{17}   & \theta - \dfrac54\theta^2 & \dfrac54\theta^2 \\[3mm]
    \dfrac{8}{17}   & \theta - \dfrac{85}{32}\theta^2+\dfrac{289}{128}\theta^3 &
                      \!\!\!\!{0} & \!\!\!\!\!\!\dfrac{153}{32}\theta^2-\dfrac{867}{128}\theta^3 & -\dfrac{17}{8}\theta^2+\dfrac{289}{64}\theta^3\\[3mm]
    \dfrac{19}{20}  & \theta - \dfrac{85}{32}\theta^2+\dfrac{289}{128}\theta^3 &
                     \!\! \!\!{0} & \!\!\!\!\!\!\dfrac{153}{32}\theta^2-\dfrac{867}{128}\theta^3 & 0 & \!\!\!\!\!\!-\dfrac{17}{8}\theta^2+\dfrac{289}{64}\theta^3\\[3mm]
    1  & {a_{71}(\theta)} & \!\!\!\!{0} & {0} & {0} & {a_{75}(\theta)} & \!\!\!\!\!\!{a_{76}(\theta)} & {0}
         \\[3mm]
    \hline&&&&&&\\[-1mm]
      & {b_1(\theta)} & \!\!\!\!{0} & {0} & {0} & {b_5(\theta)} & \!\!\!\!\!\!{b_6(\theta)} & {b_7(\theta)}
  \end{array}
\end{equation*}

$$
\begin{aligned}
  &  a_{71}(\theta) = \theta-\dfrac{483}{304}\theta^2+\dfrac{85}{114}\theta^3,
  && a_{75}(\theta) = \dfrac{5491}{2608}\theta^2-\dfrac{1445}{978}\theta^3,
  && a_{76}(\theta) = -\dfrac{1600}{3097}\theta^2+\dfrac{6800}{9291}\theta^3,
  \end{aligned}
$$
$$
\begin{aligned}
  & b_1(\theta) = \theta - \dfrac{635}{304}\theta^2 + \dfrac{823}{456}\theta^3 - \dfrac{85}{152}\theta^4,
  && b_6(\theta) = -\dfrac{32000}{3097}\theta^2 + \dfrac{200000}{9291}\theta^3 - \dfrac{34000}{3097}\theta^4,
  \\
  & b_5(\theta) = \dfrac{93347}{23472}\theta^2 - \dfrac{63869}{11736}\theta^3 + \dfrac{24565}{11736}\theta^4,
  && b_7(\theta) = \dfrac{76}{9}\theta^2 - \dfrac{161}{9}\theta^3 + \dfrac{85}{9}\theta^4.
\end{aligned}
$$
}

\vspace{3mm}\noindent Метод cFCRK-I построен согласно алгоритму из доказательства теоремы~2. Подробности построения cFCRK-II, который удовлетворяет полным условиям \eqref{ocquad1}--\eqref{ocstage32}, можно найти в~%
%\cite{MasTorVer2005, ANM2019}
[5, 20].

В случае, если на четвертом этапе появляется перекрытие, следует
применять cFCRK-II, если же нет~--- cFCRK-I. При этом в~силу того,
что первые три этапа этих методов совпадают, переход с~cFCRK-I на
cFCRK-II происходит без потери уже полученных результатов.

Фактически, метод cFCRK-II является тем же cFCRK-I
с~дополнительным четвертым этапом, который используется для
построения на пятом этапе приближения необходимого порядка, в~то
время как в~отсутствие перекрытия такое приближение получается уже
на четвертом этапе. Таким образом, оба метода имеют очень близкие
значения локальной погрешности и~могут применяться совместно.

Дополнительно отметим, что интерполянт третьего порядка,
использующийся на\linebreak предпоследнем этапе обоих методов,
может быть продлен до конца шага и~применяться для вычисления
приближения вложенным методом третьего порядка, что позволяет
получить оценку локальной погрешности, на основе которой можно
управлять длиной шага подобно тому, как это делается в~методах
Рунге---Кутты для~ОДУ.
%

% \begin{table}[!ht]\caption{Коэффициенты частичного ФНРК равномерного порядка 4 (cFCRK-I)\label{tab_pfcrk}}
%
% \end{table}

% \begin{table}[!ht]\caption{Коэффициенты ФНРК равномерного порядка 4 (cFCRK-II)\label{tab_fcrk}}
%
% \end{table}






%\section{Численное тестирование \label{sec_test}}
\textbf{6. Численное тестирование.} Для численного тестирования
порядка сходимости метода и~демонстрации необходимости
использования этапных интерполянтов, а~также для сравнения
вычислительных затрат предлагаемого комбинированного метода
с~семиэтапным методом из~%
%\cite{MasTorVer2005}
[5] рассмотрим две задачи.

%\begin{problem}
\textbf{Задача 1.} \textit{Она представляет собой начальную задачу
(запаздывающий аргумент никогда не становится отрицательным),
в~которой в~нулевой момент времени нет запаздывания, и~перекрытие
возникает на нескольких первых шагах\linebreak$($пример~1.2.6 из}~%
  %\cite{PaulReport}
  [21]):
  \begin{equation*}
  \left\{\begin{aligned}
    &\dot{u}(t) = u\left(\dfrac{t}{(1+2t)^2}\right)^{(1+2t)^2},\quad t\geq 0, \\
    &u(0) = 1.
  \end{aligned}\right.
  \label{eq:test1}
  \end{equation*}
  Аналитическим решением является функция
  $$
  u(t) = e^t, \quad t\geq0.
  $$
}%\end{problem}

Будем решать задачу с~постоянным шагом на отрезке $0\leq t\leq3$.
Число шагов обозначим через $N$. Покажем сравнение для трех
методов: НРК~\eqref{metOZ46} (обозначим его OZ), семиэтапного
ФНРК~\eqref{metMTV47} (MTV) и~метода cFCRK.

В табл.~1, 2 через $\max\|E(t)\|$ обозначена максимальная
глобальная погрешность численного решения на промежутке
$t\in[0,3]$; $p$~--- полученный порядок сходимости, т.~е. двоичный
логарифм отношения погрешностей на вдвое различающихся длинах
шагов (в пределе эта величина должна равняться теоретическому
порядку сходимости метода); $N_f$~--- число обращений к~функции
правой части $f$, определяющее итоговую трудоемкость метода.


\begin{table}[h!]
\begin{center}
{\small

{\it Таблица 1.} {\bf Результаты решения Задачи 1 методом OZ \\
в~зависимости от использования экстраполяции}%

}

\vskip 3mm

{\footnotesize

\begin{tabular}{|c|c|c|c|c|}
    \hline
    \multirow{2}{*}{$N$} & \multicolumn{2}{c|}{Без экстраполяции} & \multicolumn{2}{c|}{С экстраполяцией}\\\cline{2-5}
    & $\max\|E(t)\|$ & $p$ & $\max\|E(t)\|$ & $p$ \\\hline
    $8$&    $1.452374508$ &        & $3.813702286\cdot10^{-4}$    &      \\
    $16$&   $1.394858759$ & 0.06   & $1.317968198\cdot10^{-5}$    & 4.85 \\
    $32$&   $1.349344295$ & 0.05   & $2.481964536\cdot10^{-7}$    & 5.73 \\
    $64$&   $0.654110042$ & 1.04   & $4.468434511\cdot10^{-9}$    & 5.80 \\
    $128$&  $0.290127444$ & 1.17   & $8.613127989\cdot10^{-10}$   & 2.38 \\
    $256$&  $0.104284152$ & 1.48   & $4.323652547\cdot10^{-11}$   & 4.32 \\
    $512$&  $0.036355681$ & 1.52   & $2.692956969\cdot10^{-12}$   & 4.00 \\
    $1024$& $0.012659970$ & 1.52   & $1.847411113\cdot10^{-13}$   & 3.86 \\
    $2048$& $0.004452930$ & 1.51   & $2.842170943\cdot10^{-14}$   & 2.70 \\
    \hline
  \end{tabular}

}
\end{center}\vspace{-6mm}
\end{table}


\begin{table}[h!]
\begin{center}
{\small

{\it Таблица 2.} {\bf Результаты решения Задачи 1 методами MTV
и~cFCRK}%

}

\vskip 3mm

{\footnotesize

\begin{tabular}{|c|c|c|c|c|c|c|}
    \hline
    \multirow{2}{*}{$N$} & \multicolumn{3}{c|}{MTV} & \multicolumn{3}{c|}{cFCRK}\\\cline{2-7}
    & $\max\|E(t)\|$ & $p$ & $N_f$ & $\max\|E(t)\|$ & $p$ & $N_f$ \\\hline
    $8$&    $1.125584924\cdot10^{-4}$  &        & 57    & $4.652127631\cdot10^{-3}$    &      & 42   \\
    $16$&   $1.565238520\cdot10^{-5}$  & 2.84   & 113   & $6.052372897\cdot10^{-5}$    & 6.26 & 82   \\
    $32$&   $2.412819331\cdot10^{-6}$  & 2.69   & 225   & $4.762033306\cdot10^{-6}$    & 3.67 & 162  \\
    $64$&   $3.398839610\cdot10^{-7}$  & 2.82   & 449   & $5.764573281\cdot10^{-7}$    & 3.04 & 323  \\
    $128$&  $2.005178956\cdot10^{-8}$  & 4.08   & 897   & $2.203978511\cdot10^{-8}$    & 4.71 & 643  \\
    $256$&  $9.357421504\cdot10^{-10}$ & 4.42   & 1793  & $9.029577086\cdot10^{-10}$   & 4.61 & 1284 \\
    $512$&  $3.989697461\cdot10^{-11}$ & 4.55   & 3585  & $3.499778245\cdot10^{-11}$   & 4.69 & 2566 \\
    $1024$& $1.421085472\cdot10^{-12}$ & 4.81   & 7169  & $1.140421091\cdot10^{-12}$   & 4.94 & 5128 \\
    $2048$& $1.953992523\cdot10^{-14}$ & 6.18   & 14337 & $1.776356839\cdot10^{-14}$   & 6.00 & 10250\\
    \hline
  \end{tabular}

}
\end{center}\vspace{-3mm}
\end{table}

%\begin{remark}
%\vspace{2mm}
\textbf{Замечание 3.} Непрерывный метод OZ можно применить
к~решению задач с~перекрытием, если приближать решение внутри
совершаемого шага посредством экстраполяции решения с~предыдущего
шага (или истории на первом шаге). Для рассмотренных задач метод
демонстрирует сходимость с~порядком, близким к~четырeм (в пределе,
пока вычислительная погрешность не оказывает влияния, как
в~последних строках табл.~1). Однако следует понимать, что если
началом шага будет являться точка разрыва некоторой производной,
то экстраполяция с~предыдущего шага будет выполняться недостаточно
точно, и~порядок все же будет потерян. Это особенно характерно для
начальной точки, в~которой история почти всегда негладко
сое\-ди\-няет\-ся с~решением. В~случае Задачи 1, в~которой история
не задана вовсе, мы взяли в~качестве истории точное решение
и~использовали его значения для вычисления запаздывающего решения
на первом шаге~--- очевидно, практически неприменимый метод, тем
не менее на тестовом примере позволяющий продемонстрировать
недостаточность приближения решения внутри текущего шага начальным
значением на нем (случай <<Без экстраполяции>> в~табл.~1).
%\vspace{1mm}




%\end{remark}

Видно, что метод cFCRK требует существенно меньше вычислений
правой части, чем MTV, при практически сравнимой величине
глобальной погрешности. Метод OZ без экстраполяции демонстрирует
порядок сходимости полтора, а~не четыре. Порядок полтора возникает
из-за того, что на шагах с~перекрытием он падает до единицы, но
число таких шагов среди всех мало, а~именно, оно пропорционально
$1/\sqrt{N}$. Это
наблюдение было описано в~%
%\cite{MagpantayThesis}
[22] и~более детально объяснено Э.~Хамфрисом на конференции
<<Recent trends in delay differential equations: models, theory
and numerics>>, проходившей в~Кортоне в~Италии
в~2012~г.\!\footnote{\emph{Humphries A.\;R.} Singly diagonally
implicit Runge---Kutta methods for state-dependent DDEs with
overlapping // Recent trends in delay differential equations:
models, theory and numerics. June 4--8, 2012. Cortona, Italy,
2012. Unpublished.} (к сожалению, полноценная публикация до сих
пор
не вышла).%\cite{Humphries_Cortona}





% \begin{problem}
\textbf{Задача 2.}\textit{ Запаздывание является периодически
исчезающей функцией на всем промежутке решения}:
\begin{equation*}
  \left\{\begin{aligned}
    &\dot{u}(t) = -u(\alpha(t))u(t)e^{\alpha(t)}, && t\geq 0, \\
    &u(t)  = %\mathrm
    {e}^{-t}, && t\leq 0,
  \end{aligned}\right.
  \label{eq:test2}
\end{equation*}
\textit{где \,$\alpha(t) = t-\frac{1}{100}\cos(100\pi{}t)^2$.
Аналитическое
решение %
%$$
$
  u(t) = %\mathrm
  {e}^{-t}, ~~ t\geq0, %
  $
%$$
является гладким продолжением предыстории.
}%
%\end{problem}

Выберем промежуток решения $0\leq t\leq0.5$ и~проведем те же
расчеты, что и~для Задачи 1. Полученные данные (табл.~3, 4)
качественно совпадают с результатами для Задачи 1.

\begin{table}[h!]
\begin{center}
{\small

{\it Таблица 3.} {\bf Результаты решения Задачи 2 методом OZ \\
в~зависимости от использования экстраполяции}%

}

\vskip 3mm

{\footnotesize

\begin{tabular}{|c|c|c|c|c|}
    \hline
    \multirow{2}{*}{$N$} & \multicolumn{2}{c|}{Без экстраполяции} & \multicolumn{2}{c|}{С экстраполяцией}\\\cline{2-5}
    & $\max\|E(t)\|$ & $p$ & $\max\|E(t)\|$ & $p$ \\\hline
    $1$   &  $0.08268457982$ &        & $1.017116087\cdot10^{-4}$    &      \\
    $2$   &  $0.03251547193$ & 1.34   & $1.535256994\cdot10^{-5}$    & 2.73 \\
    $4$   &  $0.01480079960$ & 1.13   & $3.909773693\cdot10^{-7}$    & 5.30 \\
    $8$   &  $0.00657970202$ & 1.16   & $1.808724093\cdot10^{-8}$    & 4.43 \\
    $16$  &  $0.00266893155$ & 1.30   & $8.185840894\cdot10^{-10}$   & 4.47 \\
    $32$  &  $0.00097382734$ & 1.45   & $4.219324889\cdot10^{-11}$   & 4.28 \\
    $64$  &  $0.00030453601$ & 1.67   & $2.441713498\cdot10^{-12}$   & 4.11 \\
    $128$ &  $0.00010319090$ & 1.56   & $1.482147738\cdot10^{-13}$   & 4.04 \\
    $256$ &  $0.00003579997$ & 1.53   & $9.103828802\cdot10^{-15}$   & 4.03 \\
    \hline
  \end{tabular}

}
\end{center}\vspace{-3mm}
\end{table}

%\newpage

\begin{table}[h!]
\begin{center}
{\small

{\it Таблица 4.} {\bf Результаты решения Задачи 2 методами MTV
и~cFCRK}%

}

\vskip 3mm

{\footnotesize

\begin{tabular}{|c|c|c|c|c|c|c|}
    \hline
    \multirow{2}{*}{$N$} & \multicolumn{3}{c|}{MTV} & \multicolumn{3}{c|}{cFCRK}\\\cline{2-7}
    & $\max\|E(t)\|$ & $p$ & $N_f$ & $\max\|E(t)\|$ & $p$ & $N_f$ \\\hline
    $1$   &  $2.662228310\cdot10^{-3}$  &      & 8    & $8.446918382\cdot10^{-4}$    &      & 7    \\
    $2$   &  $1.229983383\cdot10^{-4}$  & 4.43 & 15   & $3.224687468\cdot10^{-5}$    & 4.71 & 13   \\
    $4$   &  $6.158101201\cdot10^{-6}$  & 4.32 & 29   & $1.446756357\cdot10^{-6}$    & 4.48 & 25   \\
    $8$   &  $2.974281966\cdot10^{-7}$  & 4.37 & 57   & $5.825843386\cdot10^{-8}$    & 4.63 & 49   \\
    $16$  &  $1.183688003\cdot10^{-8}$  & 4.65 & 113  & $2.143614064\cdot10^{-9}$    & 4.76 & 97   \\
    $32$  &  $4.980709178\cdot10^{-10}$ & 4.57 & 225  & $9.249112587\cdot10^{-11}$   & 4.53 & 183  \\
    $64$  &  $2.014843847\cdot10^{-11}$ & 4.62 & 449  & $3.962274953\cdot10^{-12}$   & 4.54 & 347  \\
    $128$ &  $1.050270981\cdot10^{-12}$ & 4.26 & 897  & $1.965094754\cdot10^{-13}$   & 4.33 & 677  \\
    $256$ &  $5.828670879\cdot10^{-14}$ & 4.17 & 1793 & $1.065814104\cdot10^{-14}$   & 4.20 & 1331 \\
    \hline
  \end{tabular}

}
\end{center}\vspace{-3mm}
\end{table}

%\section{Заключение \label{sec_conclusion}}
\textbf{7. Заключение.} Предложен метод, сочетающий в~себе
непрерывный метод Рунге---Кутты с~пятью новыми этапами
и~функционально-непрерывный метод с~шестью новыми этапами на шаге.
Используемое число этапов~--- минимальное для слу\-чаев без
и~с~перекрытием соответственно. Кроме того, за счет вложенности
двух предложенных схем все расчеты, выполненные для непрерывного
метода, используются и~функционально-непрерывным, переход на
который происходит в~случае обнаружения перекрытия на любом из
этапов. Это позволяет методу на шагах без перекрытия быть таким же
эффективным, как и~существующие непрерывные методы, а~на шагах
с~перекрытием~--- полностью обеспечивать заявленный четвертый
порядок точности.

Отметим, что непрерывное приближение предпоследнего этапа (у
каждого метода) может быть использовано для оценки локальной
погрешности и~управления длиной шага, но данный вопрос требует
дополнительной проработки и~его рассмотрение выходит за рамки
настоящей статьи.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\newpage
\input{02/lit-ra}

%\newpage
\input{02/ref-s}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

{\footnotesize

%\thispagestyle{empty}
%
\vskip 3mm
%
\thispagestyle{empty} %очищаем стиль страницы
\thispagestyle{fancy} %включаем пользовательский стиль
\renewcommand{\headrulewidth}{0pt}%
\fancyhead[LO]{}%
\fancyhead[RE]{}%
\fancyfoot[LO]{\footnotesize{\rm{Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~15.~Вып.~\issuenum}}
\hfill}%
\fancyfoot[RE]{\hfill\footnotesize{\rm{Вестник~СПбГУ.~Прикладная~математика.~Информатика...~\issueyear.~Т.~15.~Вып.~\issuenum}}}%
% для оформления нижнего колонтитула
\cfoot{} %
%
}
